return(t(m) %*% eig.cell)
}
plot.SVD <- function(m, comp.1=1, comp.2=2, groups=rep("blue", ncol(m)), title=""){
eig <- do.SVD(m, comp.1, comp.2)
proj <- project.SVD(m, eig)
xminv <- min(proj[,1]) # - .2 * abs(min(proj[,1]))
xmaxv <- max(proj[,1]) # + .2 * abs(max(proj[,1]))
yminv <- min(proj[,2]) # - .2 * abs(min(proj[,2]))
ymaxv <- max(proj[,2]) # + .2 * abs(max(proj[,2]))
plot(proj,pch=20,col="white",xlim=c(xminv,xmaxv),ylim=c(yminv,ymaxv),xaxt='n',yaxt='n',xlab="PC1",ylab="PC2",main=title)
points(proj, col=as.character(groups),pch=20) # , #pch=c(rep(15,3),rep(17,3),rep(19,3),rep(18,3),rep(20,2)), cex=2)
textxy(proj[,1],proj[,2],labs=colnames(m))
}
loadings.SVD <- function(m, comp=1, gene.ids = rownames(m)){
s <- svd(m)
l <- s$u[,comp]
names(l) <- gene.ids
l.s <- l[order(l)]
return(l.s)
}
plot.loadings.SVD <- function(m, comp=1, cutoff=0.1, gene.ids = rownames(m)){
l <- loadings.SVD(m, comp, gene.ids)
barplot(l[abs(l)>cutoff],las=2,main=paste("PC", comp, "cutoff", cutoff),cex.names=0.6)
}
plotPC <- function(matrix,a,b,desc,colors){
eig <- do.SVD(matrix, a, b)
proj <- project.SVD(matrix, eig)
xminv <- min(proj[,1]) - .2 * abs(min(proj[,1]))
xmaxv <- max(proj[,1]) + .2 * abs(max(proj[,1]))
yminv <- min(proj[,2]) - .2 * abs(min(proj[,2]))
ymaxv <- max(proj[,2]) + .2 * abs(max(proj[,2]))
plot(proj,pch=20,xlim=c(xminv,xmaxv),ylim=c(yminv,ymaxv),xaxt='n',yaxt='n',xlab=paste0("PC",a),ylab=paste("PC",b),col=colors,main=desc)
textxy(proj[,1],proj[,2],labs=rownames(proj))
}
f <- read.delim("published_rpkms.txt",sep=" ")
f <- read.delim("published_rpkms.txt",sep=" ")
f.nozero <- f[-which(rowSums(f[,])==0),]
pheatmap(cor(f.nozero, method="spearman"))
pheatmap(cor(f.nozero))
pseudo <- 1
fpkms.log <- log2(f.nozero + pseudo)
pheatmap(cor(fpkms.log))
f.nolow <- f.nozero[-which(rowMeans(f.nozero)<1),]
pheatmap(cor(log2(f.nolow+pseudo)))
library(reshape)
m <- melt(f.nolow)
colnames(m) <- c("sample_ID","RPKM")
meta <- data.frame(tissue=c("heart","brain","kidney","heart","brain","heart","brain","kidney","heart","brain","kidney"),study=c("HPA","HPA","HPA","AltIso","AltIso","GTex","GTex","GTex","Atlas","Atlas","Atlas"),prep=c(rep("poly-A",8),rep("rRNA-depl",3)),layout=c(rep("PE",3),rep("SE",2),rep("PE",3),rep("SE",3)))
rownames(meta) <- colnames(f)
tissue <- rep(meta$tissue, each=nrow(f))
study <- rep(meta$study, each=nrow(f))
prep <- rep(meta$prep, each=nrow(f))
layout <- rep(meta$layout, each=nrow(f))
data <- data.frame(m, tissue=tissue, study=study, prep=prep, layout=layout)
fit <- lm(RPKM ~ prep + layout + study + tissue, data=data)
a <- anova(fit)
maxval = 3200
barplot(a$"F value"[-5],names.arg=rownames(a)[-5],main="Anova F score, Raw RPKM",ylim=c(0,maxval))
m <- melt(f.nozero)
colnames(m) <- c("sample_ID","RPKM")
meta <- data.frame(tissue=c("heart","brain","kidney","heart","brain","heart","brain","kidney","heart","brain","kidney"),study=c("HPA","HPA","HPA","AltIso","AltIso","GTex","GTex","GTex","Atlas","Atlas","Atlas"),prep=c(rep("poly-A",8),rep("rRNA-depl",3)),layout=c(rep("PE",3),rep("SE",2),rep("PE",3),rep("SE",3)))
rownames(meta) <- colnames(f)
tissue <- rep(meta$tissue, each=nrow(f))
study <- rep(meta$study, each=nrow(f))
prep <- rep(meta$prep, each=nrow(f))
layout <- rep(meta$layout, each=nrow(f))
data <- data.frame(m, tissue=tissue, study=study, prep=prep, layout=layout)
rownames(meta) <- colnames(f.nozero)
tissue <- rep(meta$tissue, each=nrow(f.nozero))
study <- rep(meta$study, each=nrow(f.nozero))
prep <- rep(meta$prep, each=nrow(f.nozero))
layout <- rep(meta$layout, each=nrow(f.nozero))
data <- data.frame(m, tissue=tissue, study=study, prep=prep, layout=layout)
fit <- lm(RPKM ~ prep + layout + study + tissue, data=data)
a <- anova(fit)
maxval = 3200
barplot(a$"F value"[-5],names.arg=rownames(a)[-5],main="Anova F score, Raw RPKM",ylim=c(0,maxval))
colors <- c(1,2,3,1,2,1,2,3,1,2,3)
plotPC(f.nozero, 1, 2, "Published FPKM values \n SVD \n n=13333", colors=colors)
plotPC(f.nozero, 2, 3, "Published FPKM values \n SVD \n n=13333", colors=colors)
pseudo <- 1
fpkms.log <- log2(f.nozero + pseudo)
plotPC(fpkms.log, 1, 2, desc="Published FPKM values, log2 \n SVD \n n=13333", colors=colors)
pca_study_public <- read.delim("published_rpkms.txt",sep=" ")
head(pca_study_public)
dim(pca_study_public)
do.SVD = function(m, comp.1=1, comp.2=2){ # returns eig.cell
s <- svd(m)
ev <- s$d^2 / sum(s$d^2)
return(s$u[,c(comp.1, comp.2)])
}
pca <- do.SVD(pca_study_public[,2:11])
?svd
pca_study_public <- read.delim("published_rpkms.txt",sep=" ")
head(pca_study_public)
dim(pca_study_public)
do.SVD = function(m, comp.1=1, comp.2=2){ # returns eig.cell
s <- svd(m)
ev <- s$d^2 / sum(s$d^2)
return(s$u[,c(comp.1, comp.2)])
}
pca <- do.SVD(pca_study_public[,2:11])
head(pca)
addPercent <- function(x){
percent <- round(x * 100, digits = 1)
result <- paste(percent, "%", sep = "")
return(result)
}
addPercent(3)
do.SVD = function(m, comp.1=1, comp.2=2){ # returns eig.cell
s <- svd(m)
ev <- s$d^2 / sum(s$d^2)
return(s$u[,c(comp.1, comp.2)])
}
a<- do.SVD(pca_study_public)
head(a)
a <- svd(pca_study_public)
head(a)
head(a)
??base
str(s)
do.SVD = function(m, comp.1=1, comp.2=2){ # returns eig.cell
s <- svd(m)
ev <- s$d^2 / sum(s$d^2)
return(s$u[,c(comp.1, comp.2)])
}
m
s <- svd(m)
s <- svd(m)
?svd
s <- svd(m, comp.1=1, comp.2=2))
s <- svd(m, comp.1=1, comp.2=2)
a <- do.SVD(m)
s <- svd(pca_study_public)
str(s)
str(pca_study_public)
?str
sd(pca_study_public$HPA_heart)
sd(pca_study_public$HPA_heart)^2
f <- read.delim("published_rpkms.txt",sep=" ")
f.nozero <- f[-which(rowSums(f[,])==0),]
colors <- c(1,2,3,1,2,1,2,3,1,2,3)
plotPC(f.nozero, 1, 2, "Published FPKM values \n SVD \n n=13333", colors=colors)
pseudo <- 1
fpkms.log <- log2(f.nozero + pseudo)
plotPC(fpkms.log, 1, 2, desc="Published FPKM values, log2 \n SVD \n n=13333", colors=colors)
pte <- prcomp(t(fpkms.log[,]))
pdf("1c.pdf")
plot(p$x[, 1], p$x[, 2], pch = 20, cex=1.8, col = colors, xlab = paste("PC", 1), ylab = paste("PC", 2))
title(main="Published FPKM values \n prcomp \n n=13537",col.main="black")
legend("bottomleft",c("Heart","Brain","Kidney"), inset=.05, title="Tissues",fil=colors, horiz=TRUE,cex=0.8)
pseudo <- 1
pte <- p <- prcomp(t(fpkms.log[,]))
pte <- prcomp(t(fpkms.log[,]))
plot(pte$x[, 1], p$x[, 2], pch = 20, cex=1.8, col = colors, xlab = paste("PC", 1), ylab = paste("PC", 2))
title(main="Published FPKM values \n prcomp \n n=13537",col.main="black")
legend("bottomleft",c("Heart","Brain","Kidney"), inset=.05, title="Tissues",fil=colors, horiz=TRUE,cex=0.8)
plot(pte$x[, 1], p$x[, 2], pch = 20, cex=1.8, col = colors, xlab = paste("PC", 1), ylab = paste("PC", 2))
title(main="Published FPKM values \n prcomp \n n=13537",col.main="black")
legend("bottomleft",c("Heart","Brain","Kidney"), inset=.05, title="Tissues",fil=colors, horiz=TRUE,cex=0.8)
plot(pte$x[, 2], p$x[, 3], pch = 20, cex=1.8, col = colors, xlab = paste("PC", 1), ylab = paste("PC", 2))
title(main="Published FPKM values \n prcomp \n n=13537",col.main="black")
legend("bottomleft",c("Heart","Brain","Kidney"), inset=.05, title="Tissues",fil=colors, horiz=TRUE,cex=0.8)
plot(pte$x[, 1], pte$x[, 2], pch = 20, cex=1.8, col = colors, xlab = paste("PC", 1), ylab = paste("PC", 2))
title(main="Published FPKM values \n prcomp \n n=13537",col.main="black")
legend("bottomleft",c("Heart","Brain","Kidney"), inset=.05, title="Tissues",fil=colors, horiz=TRUE,cex=0.8)
pte <- prcomp(t(fpkms.log[,]))
head(pte)
plot(pte$x[, 1], pte$x[, 2], pch = 20, cex=1.8, col = colors, xlab = paste("PC", 1), ylab = paste("PC", 2))
title(main="Published FPKM values \n prcomp \n n=13537",col.main="black")
legend("bottomleft",c("Heart","Brain","Kidney"), inset=.05, title="Tissues",fil=colors, horiz=TRUE,cex=0.8)
str(pte)
f <- read.delim("/Users/fridadanielsson/Documents/Projekt/Publika_dataset/manuscript/PCA/data/published_rpkms.txt",sep=" ")
pheatmap(cor(f,method="spearman"),main="Published FPKM values \n n=13537",col.main="black")
pheatmap(cor(f,method="spearman"),main="Published FPKM values \n n=13537",col.main="black")
pca_study_public <- read.delim("published_rpkms.txt",sep=" ")
head(pca_study_public)
dim(pca_study_public)
filter <- apply(pca_study_public[,2:11], 1, function(row) all(row !=0 ))
pca_study_public_nonzero<-pca_study_public[filter,]
do.SVD = function(m, comp.1=1, comp.2=2){ # returns eig.cell
s <- svd(m)
ev <- s$d^2 / sum(s$d^2)
return(s$u[,c(comp.1, comp.2)])
}
a <- do.SVD(pca_study_public_nonzero)
head(a)
str()
str(a)
?svd
pca_study_public <- read.delim("published_rpkms.txt",sep=" ")
head(pca_study_public)
dim(pca_study_public)
#Filter not used,Zeros count values can be specific to tissues
filter <- apply(pca_study_public[,2:11], 1, function(row) all(row !=0 ))
pca_study_public_nonzero<-pca_study_public[filter,]
pca <- svd(pca_study_public[,2:11])
var.percent <- (pca$d^2 / sum(pca$d^2) ) *100
barplot(var.percent[1:5], xlab="PC", ylab="Percent Variance",names.arg=1:length(var.percent[1:5]), las=1,ylim=c(0,max(var.percent[1:5])), col="gray")
head(var.percent)
barplot(var.percent[1:5], xlab="PC", ylab="Percent Variance",names.arg=1:length(var.percent[1:5]), las=1,ylim=c(0,max(var.percent[1:5])+10), col="gray")
?prcomp
ate <- prcomp(pca_study_public)
head(ate$r)
pca <- prcomp(pca_study_public)
rot <- pca$r
x <- pca$x
plot(pca)
summary(pca)
pca <- svd(pca_study_public[,2:11])
var.percent <- (pca$d^2 / sum(pca$d^2) ) *100
barplot(var.percent[1:5], xlab="PC", ylab="Percent Variance",names.arg=1:length(var.percent[1:5]), las=1,ylim=c(0,max(var.percent[1:5])+10), col="gray")
screeplot(pca,type=c("lines"))
sampleinfo<-read.table("information_sample.txt",header=TRUE)
patientsample<-sampleinfo[,1:8]
head(sampleinfo)
sampleinfo<-read.table("information_sample.txt",header=TRUE)
patientsample<-sampleinfo[,1:8]
sampleinfo <- read.table("information_sample.txt",header=TRUE)
head(sampleinfo)
f <- read.delim("published_rpkms.txt",sep=" ")
f.nozero <- f[-which(rowSums(f[,])==0),]
pheatmap(cor(f.nozero, method="spearman"))
pheatmap(cor(f.nozero))
pseudo <- 1
fpkms.log <- log2(f.nozero + pseudo)
pheatmap(cor(fpkms.log))
library(pheatmap)
library(gplots)
library(ops)
library(calibrate)
pheatmap(cor(f.nozero, method="spearman"))
pheatmap(cor(f.nozero))
pseudo <- 1
fpkms.log <- log2(f.nozero + pseudo)
pheatmap(cor(fpkms.log))
f.nolow <- f.nozero[-which(rowMeans(f.nozero)<1),]
pheatmap(cor(log2(f.nolow+pseudo)))
library(reshape)
m <- melt(f.nozero)
colnames(m) <- c("sample_ID","RPKM")
meta <- data.frame(tissue=c("heart","brain","kidney","heart","brain","heart","brain","kidney","heart","brain","kidney"),study=c("HPA","HPA","HPA","AltIso","AltIso","GTex","GTex","GTex","Atlas","Atlas","Atlas"),prep=c(rep("poly-A",8),rep("rRNA-depl",3)),layout=c(rep("PE",3),rep("SE",2),rep("PE",3),rep("SE",3)))
rownames(meta) <- colnames(f.nozero)
tissue <- rep(meta$tissue, each=nrow(f.nozero))
study <- rep(meta$study, each=nrow(f.nozero))
prep <- rep(meta$prep, each=nrow(f.nozero))
layout <- rep(meta$layout, each=nrow(f.nozero))
data <- data.frame(m, tissue=tissue, study=study, prep=prep, layout=layout)
#subset <- data[sample(1:nrow(data), 1000),]
fit <- lm(RPKM ~ prep + layout + study + tissue, data=data)
a <- anova(fit)
maxval = 3200
barplot(a$"F value"[-5],names.arg=rownames(a)[-5],main="Anova F score, Raw RPKM",ylim=c(0,maxval))
library(VennDiagram)
HPA_b <- rownames(f[order(f$HPA_brain,decreasing=T),][1:100,])
HPA_h <- rownames(f[order(f$HPA_heart,decreasing=T),][1:100,])
HPA_k <- rownames(f[order(f$HPA_kidney,decreasing=T),][1:100,])
AltIso_b <- rownames(f[order(f$AltIso_brain,decreasing=T),][1:100,])
AltIso_h <- rownames(f[order(f$AltIso_heart,decreasing=T),][1:100,])
GTEx_b <- rownames(f[order(f$GTEx_brain,decreasing=T),][1:100,])
GTEx_h <- rownames(f[order(f$GTEx_heart,decreasing=T),][1:100,])
GTEx_k <- rownames(f[order(f$GTEx_kidney,decreasing=T),][1:100,])
Atlas_b <- rownames(f[order(f$Atlas_brain,decreasing=T),][1:100,])
Atlas_h <- rownames(f[order(f$Atlas_heart,decreasing=T),][1:100,])
Atlas_k <- rownames(f[order(f$Atlas_kidney,decreasing=T),][1:100,])
```
Let's start with the four brain samples:
```{r:venn brain}
b_Ids <- list(HPA_b,AltIso_b,GTEx_b,Atlas_b)
draw.quad.venn(100, 100, 100, 100,
length(intersect(HPA_b,AltIso_b)),
length(intersect(HPA_b,GTEx_b)),
length(intersect(HPA_b,Atlas_b)),
length(intersect(AltIso_b,GTEx_b)),
length(intersect(AltIso_b,Atlas_b)),
length(intersect(GTEx_b,Atlas_b)),
length(intersect(intersect(HPA_b,AltIso_b),GTEx_b)),
length(intersect(intersect(HPA_b,AltIso_b),Atlas_b)),
length(intersect(intersect(HPA_b,GTEx_b),Atlas_b)),
length(intersect(intersect(AltIso_b,GTEx_b),Atlas_b)),
length(intersect(intersect(HPA_b,AltIso_b),intersect(Atlas_b,GTEx_b))),
category = c("HPA","AltIso","GTEx","Atlas"), lwd = rep(0, 4), lty = rep("solid", 4),
fill = c("mistyrose","steelblue","lightgoldenrod","darkseagreen")
)
HPA_b <- rownames(f[order(f$HPA_brain,decreasing=T),][1:100,])
HPA_h <- rownames(f[order(f$HPA_heart,decreasing=T),][1:100,])
HPA_k <- rownames(f[order(f$HPA_kidney,decreasing=T),][1:100,])
AltIso_b <- rownames(f[order(f$AltIso_brain,decreasing=T),][1:100,])
AltIso_h <- rownames(f[order(f$AltIso_heart,decreasing=T),][1:100,])
GTEx_b <- rownames(f[order(f$GTEx_brain,decreasing=T),][1:100,])
GTEx_h <- rownames(f[order(f$GTEx_heart,decreasing=T),][1:100,])
GTEx_k <- rownames(f[order(f$GTEx_kidney,decreasing=T),][1:100,])
Atlas_b <- rownames(f[order(f$Atlas_brain,decreasing=T),][1:100,])
Atlas_h <- rownames(f[order(f$Atlas_heart,decreasing=T),][1:100,])
Atlas_k <- rownames(f[order(f$Atlas_kidney,decreasing=T),][1:100,])
draw.quad.venn(100, 100, 100, 100,
length(intersect(HPA_b,AltIso_b)),
length(intersect(HPA_b,GTEx_b)),
length(intersect(HPA_b,Atlas_b)),
length(intersect(AltIso_b,GTEx_b)),
length(intersect(AltIso_b,Atlas_b)),
length(intersect(GTEx_b,Atlas_b)),
length(intersect(intersect(HPA_b,AltIso_b),GTEx_b)),
length(intersect(intersect(HPA_b,AltIso_b),Atlas_b)),
length(intersect(intersect(HPA_b,GTEx_b),Atlas_b)),
length(intersect(intersect(AltIso_b,GTEx_b),Atlas_b)),
length(intersect(intersect(HPA_b,AltIso_b),intersect(Atlas_b,GTEx_b))),
category = c("HPA","AltIso","GTEx","Atlas"), lwd = rep(0, 4), lty = rep("solid", 4),
fill = c("mistyrose","steelblue","lightgoldenrod","darkseagreen")
)
)
)
>
rm(list = ls(all = TRUE))
pca_study_public <- read.delim("published_rpkms.txt",sep=" ")
filter <- apply(pca_study_public[,2:11], 1, function(row) all(row !=0 ))
pca_study_public_nonzero<-pca_study_public[filter,]
pca <- svd(pca_study_public[,2:11])
var.percent <- (pca$d^2 / sum(pca$d^2) ) *100
barplot(var.percent[1:5], xlab="PC", ylab="Percent Variance",names.arg=1:length(var.percent[1:5]), las=1,ylim=c(0,max(var.percent[1:5])+10), col="gray")
sampleinfo <- read.table("information_sample.txt",header=TRUE)
head(sampleinfo)
sampleinfo
f <- read.delim("published_rpkms.txt",sep=" ")
head(f)
f <- read.delim("published_rpkms.txt",sep=" ")
f.nozero <- f[-which(rowSums(f[,])==0),]
pheatmap(cor(f.nozero, method="spearman"))
library(pheatmap)
library(gplots)
library(ops)
library(calibrate)
do.SVD = function(m, comp.1=1, comp.2=2){ # returns eig.cell
s <- svd(m)
ev <- s$d^2 / sum(s$d^2)
return(s$u[,c(comp.1, comp.2)])
}
project.SVD <- function(m, eig.cell){
return(t(m) %*% eig.cell)
}
plot.SVD <- function(m, comp.1=1, comp.2=2, groups=rep("blue", ncol(m)), title=""){
eig <- do.SVD(m, comp.1, comp.2)
proj <- project.SVD(m, eig)
xminv <- min(proj[,1]) # - .2 * abs(min(proj[,1]))
xmaxv <- max(proj[,1]) # + .2 * abs(max(proj[,1]))
yminv <- min(proj[,2]) # - .2 * abs(min(proj[,2]))
ymaxv <- max(proj[,2]) # + .2 * abs(max(proj[,2]))
plot(proj,pch=20,col="white",xlim=c(xminv,xmaxv),ylim=c(yminv,ymaxv),xaxt='n',yaxt='n',xlab="PC1",ylab="PC2",main=title)
points(proj, col=as.character(groups),pch=20) # , #pch=c(rep(15,3),rep(17,3),rep(19,3),rep(18,3),rep(20,2)), cex=2)
textxy(proj[,1],proj[,2],labs=colnames(m))
}
loadings.SVD <- function(m, comp=1, gene.ids = rownames(m)){
s <- svd(m)
l <- s$u[,comp]
names(l) <- gene.ids
l.s <- l[order(l)]
return(l.s)
}
plot.loadings.SVD <- function(m, comp=1, cutoff=0.1, gene.ids = rownames(m)){
l <- loadings.SVD(m, comp, gene.ids)
barplot(l[abs(l)>cutoff],las=2,main=paste("PC", comp, "cutoff", cutoff),cex.names=0.6)
}
plotPC <- function(matrix,a,b,desc,colors){
eig <- do.SVD(matrix, a, b)
proj <- project.SVD(matrix, eig)
xminv <- min(proj[,1]) - .2 * abs(min(proj[,1]))
xmaxv <- max(proj[,1]) + .2 * abs(max(proj[,1]))
yminv <- min(proj[,2]) - .2 * abs(min(proj[,2]))
ymaxv <- max(proj[,2]) + .2 * abs(max(proj[,2]))
plot(proj,pch=20,xlim=c(xminv,xmaxv),ylim=c(yminv,ymaxv),xaxt='n',yaxt='n',xlab=paste0("PC",a),ylab=paste("PC",b),col=colors,main=desc)
textxy(proj[,1],proj[,2],labs=rownames(proj))
}
f <- read.delim("published_rpkms.txt",sep=" ")
f.nozero <- f[-which(rowSums(f[,])==0),]
pheatmap(cor(f.nozero, method="spearman"))
pheatmap(cor(f.nozero))
pheatmap(cor(f.nozero))
pseudo <- 1
fpkms.log <- log2(f.nozero + pseudo)
pheatmap(cor(fpkms.log))
f.nolow <- f.nozero[-which(rowMeans(f.nozero)<1),]
pheatmap(cor(log2(f.nolow+pseudo)))
pheatmap(cor(log2(f.nolow+pseudo)))
library(reshape)
m <- melt(f.nozero)
colnames(m) <- c("sample_ID","RPKM")
meta <- data.frame(tissue=c("heart","brain","kidney","heart","brain","heart","brain","kidney","heart","brain","kidney"),study=c("HPA","HPA","HPA","AltIso","AltIso","GTex","GTex","GTex","Atlas","Atlas","Atlas"),prep=c(rep("poly-A",8),rep("rRNA-depl",3)),layout=c(rep("PE",3),rep("SE",2),rep("PE",3),rep("SE",3)))
rownames(meta) <- colnames(f.nozero)
tissue <- rep(meta$tissue, each=nrow(f.nozero))
study <- rep(meta$study, each=nrow(f.nozero))
prep <- rep(meta$prep, each=nrow(f.nozero))
layout <- rep(meta$layout, each=nrow(f.nozero))
data <- data.frame(m, tissue=tissue, study=study, prep=prep, layout=layout)
fit <- lm(RPKM ~ prep + layout + study + tissue, data=data)
a <- anova(fit)
barplot(a$"F value"[-5],names.arg=rownames(a)[-5],main="Anova F score, Raw RPKM",ylim=c(0,maxval))
maxval = 3200
barplot(a$"F value"[-5],names.arg=rownames(a)[-5],main="Anova F score, Raw RPKM",ylim=c(0,maxval))
maxval = 3000
barplot(a$"F value"[-5],names.arg=rownames(a)[-5],main="Anova F score, Raw RPKM",ylim=c(0,maxval))
colors <- c(1,2,3,1,2,1,2,3,1,2,3)
plotPC(f.nozero, 1, 2, "Published FPKM values \n SVD \n n=13333", colors=colors)
plotPC(f.nozero, 2, 3, "Published FPKM values \n SVD \n n=13333", colors=colors)
colors <- c(1,2,3,1,2,1,2,3,1,2,3)
par(mfrow=c(4,4))
for (i in 1:6){
for(j in 1:6){
if (i<j){
plotPC(f.nozero,i,j,desc="",colors=colors)
}
}
}
pseudo <- 1
fpkms.log <- log2(f.nozero + pseudo)
plotPC(fpkms.log, 1, 2, desc="Published FPKM values, log2 \n SVD \n n=13333", colors=colors)
plotPC(fpkms.log, 1, 2, desc="Published FPKM values, log2 \n SVD \n n=13333", colors=colors)
plotPC(fpkms.log, 2, 3, desc="Published FPKM values, log2 \n SVD \n n=13333", colors=colors)
colors <- c(1,2,3,1,2,1,2,3,1,2,3)
p <- prcomp(t(fpkms.log))
par(mfrow=c(4,4))
for (i in 1:6){
for(j in 1:6){
if (i<j){
plot(p$x[,i],p$x[,j],pch=20,col=colors,xlab=paste("PC", i),ylab=paste("PC", j))
}
}
}
library(VennDiagram)
HPA_b <- rownames(f[order(f$HPA_brain,decreasing=T),][1:100,])
HPA_h <- rownames(f[order(f$HPA_heart,decreasing=T),][1:100,])
HPA_k <- rownames(f[order(f$HPA_kidney,decreasing=T),][1:100,])
AltIso_b <- rownames(f[order(f$AltIso_brain,decreasing=T),][1:100,])
AltIso_h <- rownames(f[order(f$AltIso_heart,decreasing=T),][1:100,])
GTEx_b <- rownames(f[order(f$GTEx_brain,decreasing=T),][1:100,])
GTEx_h <- rownames(f[order(f$GTEx_heart,decreasing=T),][1:100,])
GTEx_k <- rownames(f[order(f$GTEx_kidney,decreasing=T),][1:100,])
Atlas_b <- rownames(f[order(f$Atlas_brain,decreasing=T),][1:100,])
Atlas_h <- rownames(f[order(f$Atlas_heart,decreasing=T),][1:100,])
Atlas_k <- rownames(f[order(f$Atlas_kidney,decreasing=T),][1:100,])
```
Let's start with the four brain samples:
```{r:venn brain}
draw.quad.venn(100, 100, 100, 100,
length(intersect(HPA_b,AltIso_b)),
length(intersect(HPA_b,GTEx_b)),
length(intersect(HPA_b,Atlas_b)),
length(intersect(AltIso_b,GTEx_b)),
length(intersect(AltIso_b,Atlas_b)),
length(intersect(GTEx_b,Atlas_b)),
length(intersect(intersect(HPA_b,AltIso_b),GTEx_b)),
length(intersect(intersect(HPA_b,AltIso_b),Atlas_b)),
length(intersect(intersect(HPA_b,GTEx_b),Atlas_b)),
length(intersect(intersect(AltIso_b,GTEx_b),Atlas_b)),
length(intersect(intersect(HPA_b,AltIso_b),intersect(Atlas_b,GTEx_b))),
category = c("HPA","AltIso","GTEx","Atlas"), lwd = rep(0, 4), lty = rep("solid", 4),
fill = c("mistyrose","steelblue","lightgoldenrod","darkseagreen")
)
sjdh
ds
d
d
d
d
?h
s
```{r:venn brain}
library(pheatmap)
library(gplots)
library(ops)
library(calibrate)
do.SVD = function(m, comp.1=1, comp.2=2){ # returns eig.cell
s <- svd(m)
ev <- s$d^2 / sum(s$d^2)
return(s$u[,c(comp.1, comp.2)])
}
project.SVD <- function(m, eig.cell){
return(t(m) %*% eig.cell)
}
plot.SVD <- function(m, comp.1=1, comp.2=2, groups=rep("blue", ncol(m)), title=""){
eig <- do.SVD(m, comp.1, comp.2)
proj <- project.SVD(m, eig)
xminv <- min(proj[,1]) # - .2 * abs(min(proj[,1]))
xmaxv <- max(proj[,1]) # + .2 * abs(max(proj[,1]))
yminv <- min(proj[,2]) # - .2 * abs(min(proj[,2]))
ymaxv <- max(proj[,2]) # + .2 * abs(max(proj[,2]))
plot(proj,pch=20,col="white",xlim=c(xminv,xmaxv),ylim=c(yminv,ymaxv),xaxt='n',yaxt='n',xlab="PC1",ylab="PC2",main=title)
points(proj, col=as.character(groups),pch=20) # , #pch=c(rep(15,3),rep(17,3),rep(19,3),rep(18,3),rep(20,2)), cex=2)
textxy(proj[,1],proj[,2],labs=colnames(m))
}
loadings.SVD <- function(m, comp=1, gene.ids = rownames(m)){
s <- svd(m)
l <- s$u[,comp]
names(l) <- gene.ids
l.s <- l[order(l)]
return(l.s)
}
plot.loadings.SVD <- function(m, comp=1, cutoff=0.1, gene.ids = rownames(m)){
l <- loadings.SVD(m, comp, gene.ids)
barplot(l[abs(l)>cutoff],las=2,main=paste("PC", comp, "cutoff", cutoff),cex.names=0.6)
}
plotPC <- function(matrix,a,b,desc,colors){
eig <- do.SVD(matrix, a, b)
proj <- project.SVD(matrix, eig)
xminv <- min(proj[,1]) - .2 * abs(min(proj[,1]))
xmaxv <- max(proj[,1]) + .2 * abs(max(proj[,1]))
yminv <- min(proj[,2]) - .2 * abs(min(proj[,2]))
ymaxv <- max(proj[,2]) + .2 * abs(max(proj[,2]))
plot(proj,pch=20,xlim=c(xminv,xmaxv),ylim=c(yminv,ymaxv),xaxt='n',yaxt='n',xlab=paste0("PC",a),ylab=paste("PC",b),col=colors,main=desc)
textxy(proj[,1],proj[,2],labs=rownames(proj))
f <- read.delim("published_rpkms.txt",sep=" ")
f.nozero <- f[-which(rowSums(f[,])==0),]
jhkjhkhf
