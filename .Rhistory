load.pc1 <- p.log$rotation[,1][order(p.log$rotation[,1])]
extreme.pc1 <- c(tail(load.pc1), head(load.pc1))
extreme.pc1.ensg <- names(extreme.pc1)
extreme.pc1.symbols <- getBM(attributes=c("ensembl_gene_id", "hgnc_symbol"),
filters = "ensembl_gene_id",
values=extreme.pc1.ensg,
mart=ensembl)
barplot(extreme.pc1, names.arg=extreme.pc1.symbols[,2], las=2, main="Genes w highest absolute loadings in PC1 (log2RPKM)")
load.pc2 <- p.log$rotation[,2][order(p.log$rotation[,2])]
extreme.pc2 <- c(tail(load.pc2), head(load.pc2))
extreme.pc2.ensg <- names(extreme.pc2)
extreme.pc2.symbols <- getBM(attributes=c("ensembl_gene_id", "hgnc_symbol"),
filters = "ensembl_gene_id",
values=extreme.pc2.ensg,
mart=ensembl)
barplot(extreme.pc2, names.arg=extreme.pc2.symbols[,2], las=2, main="Genes w highest absolute loadings in PC2 (log2RPKM)")
load.pc3 <- p.log$rotation[,3][order(p$rotation[,3])]
extreme.pc3 <- c(tail(load.pc3), head(load.pc3))
extreme.pc3.ensg <- names(extreme.pc3)
extreme.pc3.symbols <- getBM(attributes=c("ensembl_gene_id", "hgnc_symbol"),
filters = "ensembl_gene_id",
values=extreme.pc3.ensg,
mart=ensembl)
barplot(extreme.pc3, names.arg=extreme.pc3.symbols[,2], las=2, main="Genes w highest absolute loadings in PC3 (log2RPKM)")
head(published.log)
p.log <- prcomp(t(published.log))
plot(p.log$x[,1],p.log$x[,2],pch=20,col=colors,xlab=paste("PC1"),ylab=paste("PC2"),main="log2 Published FPKM values \n n=13323")
textxy(p.log$x[,1],p.log$x[,2],labs=rownames(p.log$x))
load.pc1 <- p.log$rotation[,1][order(p.log$rotation[,1])]
extreme.pc1 <- c(tail(load.pc1), head(load.pc1))
extreme.pc1.ensg <- names(extreme.pc1)
extreme.pc1.symbols <- getBM(attributes=c("ensembl_gene_id", "hgnc_symbol"),
filters = "ensembl_gene_id",
values=extreme.pc1.ensg,
mart=ensembl)
barplot(extreme.pc1, names.arg=extreme.pc1.symbols[,2], las=2, main="Genes w highest absolute loadings in PC1 (log2RPKM)")
cufflinks <- read.delim("fpkm_table_tophat.txt")
sampleinfo_cufflinks <- read.delim("sample_info_reprocessed.txt")
sampleinfo_cufflinks
library(pheatmap)
library(reshape)
library(gplots)
library(ops)
library(calibrate)
library(biomaRt)
library(sva)
published <- read.delim("published_rpkms.txt",sep=" ")
sampleinfo_published <- read.table("sample_info_published.txt",header=TRUE)
published.nozero <- published[-which(rowSums(published[,])<=0.01),]
pheatmap(cor(published.nozero, method="spearman"))
colors <- c(1, 2, 3, 1, 2, 1, 2, 3, 1, 2, 3)
p <- prcomp(t(published.nozero))
plot(p$x[,1],p$x[,2],pch=20,col=colors,xlab=paste("PC1"),ylab=paste("PC2"),main="Published FPKM values \n n=13323")
textxy(p$x[,1],p$x[,2],labs=rownames(p$x))
plot(p$x[,2],p$x[,3],pch=20,col=colors,xlab=paste("PC2"),ylab=paste("PC3"),main="Published FPKM values \n n=13323")
textxy(p$x[,2],p$x[,3],labs=rownames(p$x))
load.pc1 <- p$rotation[,1][order(p$rotation[,1])]
extreme.pc1 <- c(tail(load.pc1), head(load.pc1))
extreme.pc1.ensg <- names(extreme.pc1)
ensembl = useMart("ensembl", dataset = "hsapiens_gene_ensembl") #select the ensembl database
extreme.pc1.symbols <- getBM(attributes=c("ensembl_gene_id", "hgnc_symbol"),
filters = "ensembl_gene_id",
values=extreme.pc1.ensg,
mart=ensembl)
barplot(extreme.pc1, names.arg=extreme.pc1.symbols[,2], las=2, main="Genes w highest absolute loadings in PC1 (raw RPKM)")
pseudo <- 1
published.log <- log2(published.nozero + pseudo)
pheatmap(cor(published.log),method="spearman")
colors <- c(1, 2, 3, 1, 2, 1, 2, 3, 1, 2, 3)
p.log <- prcomp(t(published.log))
plot(p.log$x[,1],p.log$x[,2],pch=20,col=colors,xlab=paste("PC1"),ylab=paste("PC2"),main="log2 Published FPKM values \n n=13323")
textxy(p.log$x[,1],p.log$x[,2],labs=rownames(p.log$x))
plot(p.log$x[,2],p.log$x[,3],pch=20,col=colors,xlab=paste("PC2"),ylab=paste("PC3"),main="log2 Published FPKM values \n n=13323")
textxy(p.log$x[,2],p.log$x[,3],labs=rownames(p.log$x))
load.pc1 <- p.log$rotation[,1][order(p.log$rotation[,1])]
extreme.pc1 <- c(tail(load.pc1), head(load.pc1))
extreme.pc1.ensg <- names(extreme.pc1)
extreme.pc1.symbols <- getBM(attributes=c("ensembl_gene_id", "hgnc_symbol"),
filters = "ensembl_gene_id",
values=extreme.pc1.ensg,
mart=ensembl)
barplot(extreme.pc1, names.arg=extreme.pc1.symbols[,2], las=2, main="Genes w highest absolute loadings in PC1 (log2RPKM)")
load.pc2 <- p.log$rotation[,2][order(p.log$rotation[,2])]
extreme.pc2 <- c(tail(load.pc2), head(load.pc2))
extreme.pc2.ensg <- names(extreme.pc2)
extreme.pc2.symbols <- getBM(attributes=c("ensembl_gene_id", "hgnc_symbol"),
filters = "ensembl_gene_id",
values=extreme.pc2.ensg,
mart=ensembl)
barplot(extreme.pc2, names.arg=extreme.pc2.symbols[,2], las=2, main="Genes w highest absolute loadings in PC2 (log2RPKM)")
load.pc3 <- p.log$rotation[,3][order(p$rotation[,3])]
extreme.pc3 <- c(tail(load.pc3), head(load.pc3))
extreme.pc3.ensg <- names(extreme.pc3)
extreme.pc3.symbols <- getBM(attributes=c("ensembl_gene_id", "hgnc_symbol"),
filters = "ensembl_gene_id",
values=extreme.pc3.ensg,
mart=ensembl)
barplot(extreme.pc3, names.arg=extreme.pc3.symbols[,2], las=2, main="Genes w highest absolute loadings in PC3 (log2RPKM)")
load.pc1 <- abs(p.log$rotation[,1])[order(abs(p.log$rotation[,1]),decreasing=TRUE)]
top.pc1 <- names(load.pc1[1:500])
pheatmap(cor(published[top.pc1,]),method="spearman")
load.pc2 <- abs(p.log$rotation[,2])[order(abs(p.log$rotation[,2]),decreasing=TRUE)]
top.pc2 <- names(load.pc2[1:500])
pheatmap(cor(published[top.pc2,]),method="spearman")
load.pc1 <- abs(p.log$rotation[,1])[order(abs(p.log$rotation[,1]),decreasing=TRUE)]
top.pc1 <- names(load.pc1[1:500])
pheatmap(cor(published[top.pc1,]),method="spearman")
load.pc2 <- abs(p.log$rotation[,2])[order(abs(p.log$rotation[,2]),decreasing=TRUE)]
top.pc2 <- names(load.pc2[1:500])
pheatmap(cor(published[top.pc2,]),method="spearman")
load.pc3 <- abs(p.log$rotation[,3])[order(abs(p.log$rotation[,3]),decreasing=TRUE)]
top.pc3 <- names(load.pc3[1:500])
pheatmap(cor(published[top.pc3,]),method="spearman")
load.pc1 <- abs(p.log$rotation[,1])[order(abs(p.log$rotation[,1]),decreasing=TRUE)]
top.pc1 <- names(load.pc1[1:500])
pheatmap(cor(published[top.pc1,]),method="spearman")
load.pc2 <- abs(p.log$rotation[,2])[order(abs(p.log$rotation[,2]),decreasing=TRUE)]
top.pc2 <- names(load.pc2[1:500])
pheatmap(cor(published[top.pc2,]),method="spearman")
load.pc3 <- abs(p.log$rotation[,3])[order(abs(p.log$rotation[,3]),decreasing=TRUE)]
top.pc3 <- names(load.pc3[1:500])
pheatmap(cor(published[top.pc3,]),method="spearman")
load.pc2 <- abs(p.log$rotation[,2])[order(abs(p.log$rotation[,2]),decreasing=TRUE)]
top.pc2 <- names(load.pc2[1:500])
pheatmap(cor(published[top.pc2,]),method="spearman")
load.pc3 <- abs(p.log$rotation[,3])[order(abs(p.log$rotation[,3]),decreasing=TRUE)]
top.pc3 <- names(load.pc3[1:500])
pheatmap(cor(published[top.pc3,]),method="spearman")
load.pc1 <- abs(p.log$rotation[,1])[order(abs(p.log$rotation[,1]),decreasing=TRUE)]
top.pc1 <- names(load.pc1[1:500])
pheatmap(cor(published[top.pc1,]),method="spearman")
load.pc1 <- abs(p.log$rotation[,1])[order(abs(p.log$rotation[,1]),decreasing=TRUE)]
top.pc1 <- names(load.pc1[1:500])
pheatmap(cor(published[top.pc1,]),method="spearman")
pheatmap(cor(published.log),method="spearman")
load.pc1 <- abs(p.log$rotation[,1])[order(abs(p.log$rotation[,1]),decreasing=TRUE)]
top.pc1 <- names(load.pc1[1:500])
pheatmap(cor(published[top.pc1,]),method="spearman")
cufflinks <- read.delim("fpkm_table_tophat.txt")
sampleinfo_cufflinks <- read.delim("sample_info_reprocessed.txt")
gene_ids <- as.vector(cufflinks[,1])
ensembl = useMart("ensembl", dataset = "hsapiens_gene_ensembl") #select the ensembl database
gene_type <- getBM(attributes=c("ensembl_gene_id", "gene_biotype"),
filters = "ensembl_gene_id",
values=gene_ids,
mart=ensembl)
pc <- subset(gene_type[,1],gene_type[,2]=="protein_coding")
cufflinks_pc <- cufflinks[match(pc,cufflinks[,1]),]
cufflinks_pc_nozero <- cufflinks_pc[-which(rowSums(cufflinks_pc[,3:16])<=0.01),]
gene_ids <- as.vector(cufflinks_pc_nozero[,1])
ensembl = useMart("ensembl", dataset = "hsapiens_gene_ensembl") #select the ensembl database
gene_type <- getBM(attributes=c("ensembl_gene_id", "chromosome_name"),
filters = "ensembl_gene_id",
values=gene_ids,
mart=ensembl)
mt <- subset(gene_type[,1],gene_type[,2]=="MT")
cufflinks_nomt <- cufflinks_pc_nozero[-match(mt,cufflinks_pc_nozero[,1]),]
pheatmap(cor(cufflinks_pc_nozero[,3:16], method="spearman"))
colors <- c(2,1,3,2,1,3,2,1,3,2,1,3,2,1)
cufflinks_fpkms <- cufflinks_pc_nozero[,3:16]
rownames(cufflinks_fpkms) <- cufflinks_pc_nozero[,1]
p.cufflinks <- prcomp(t(cufflinks_fpkms))
plot(p.cufflinks$x[,1],p.cufflinks$x[,2],pch=20,col=colors,xlab=paste("PC1"),ylab=paste("PC2"),main="Reprocessed FPKM values \n n=19475")
textxy(p.cufflinks$x[,1],p.cufflinks$x[,2],labs=rownames(p.cufflinks$x))
plot(p.cufflinks$x[,2],p.cufflinks$x[,2],pch=20,col=colors,xlab=paste("PC2"),ylab=paste("PC3"),main="Reprocessed FPKM values \n n=19475")
textxy(p.cufflinks$x[,2],p.cufflinks$x[,3],labs=rownames(p.cufflinks$x))
load.pc1 <- p.cufflinks$rotation[,1][order(p.cufflinks$rotation[,1])]
extreme.pc1 <- c(tail(load.pc1), head(load.pc1))
extreme.pc1.ensg <- names(extreme.pc1)
extreme.pc1.symbols <- getBM(attributes=c("ensembl_gene_id", "hgnc_symbol"),
filters = "ensembl_gene_id",
values=extreme.pc1.ensg,
mart=ensembl)
load.pc1 <- p.cufflinks$rotation[,1][order(p.cufflinks$rotation[,1])]
extreme.pc1 <- c(tail(load.pc1), head(load.pc1))
extreme.pc1.ensg <- names(extreme.pc1)
extreme.pc1.symbols <- getBM(attributes=c("ensembl_gene_id", "hgnc_symbol"),
filters = "ensembl_gene_id",
values=extreme.pc1.ensg,
mart=ensembl)
barplot(extreme.pc1, names.arg=extreme.pc1.symbols[,2], las=2, main="Genes w highest absolute loadings in PC1 (raw Cufflinks    FPKM)")
load.pc2 <- p.cufflinks$rotation[,2][order(p.cufflinks$rotation[,2])]
extreme.pc2 <- c(tail(load.pc2), head(load.pc2))
extreme.pc2.ensg <- names(extreme.pc2)
extreme.pc2.symbols <- getBM(attributes=c("ensembl_gene_id", "hgnc_symbol"),
filters = "ensembl_gene_id",
values=extreme.pc2.ensg,
mart=ensembl)
barplot(extreme.pc2, names.arg=extreme.pc2.symbols[,2], las=2, main="Genes w highest absolute loadings in PC2 (raw Cufflinks    FPKM)")
load.pc3 <- p.cufflinks$rotation[,3][order(p.cufflinks$rotation[,3])]
extreme.pc3 <- c(tail(load.pc3), head(load.pc3))
extreme.pc3.ensg <- names(extreme.pc3)
extreme.pc3.symbols <- getBM(attributes=c("ensembl_gene_id", "hgnc_symbol"),
filters = "ensembl_gene_id",
values=extreme.pc3.ensg,
mart=ensembl)
barplot(extreme.pc3, names.arg=extreme.pc3.symbols[,2], las=2, main="Genes w highest absolute loadings in PC3 (raw Cufflinks    FPKM)")
load.pc1 <- p.cufflinks$rotation[,1][order(p.cufflinks$rotation[,1])]
extreme.pc1 <- c(tail(load.pc1), head(load.pc1))
extreme.pc1.ensg <- names(extreme.pc1)
extreme.pc1.symbols <- getBM(attributes=c("ensembl_gene_id", "hgnc_symbol"),
filters = "ensembl_gene_id",
values=extreme.pc1.ensg,
mart=ensembl)
barplot(extreme.pc1, names.arg=extreme.pc1.symbols[,2], las=2, main="Genes w highest absolute loadings in PC1 (raw Cufflinks    FPKM)")
cufflinks_fpkms_nomt <- cufflinks_nomt[,3:16]
rownames(cufflinks_fpkms_nomt) <- cufflinks_nomt[,1]
p.cufflinks.nomt <- prcomp(t(cufflinks_fpkms_nomt))
plot(p.cufflinks.nomt$x[,1],p.cufflinks.nomt$x[,2],pch=20,col=colors,xlab=paste("PC1"),ylab=paste("PC2"),main="Reprocessed FPKM values no mito \n n=19475")
textxy(p.cufflinks.nomt$x[,1],p.cufflinks.nomt$x[,2],labs=rownames(p.cufflinks.nomt$x))
plot(p.cufflinks.nomt$x[,2],p.cufflinks.nomt$x[,3],pch=20,col=colors,xlab=paste("PC2"),ylab=paste("PC3"),main="Reprocessed FPKM values no mito \n n=19475")
textxy(p.cufflinks.nomt$x[,2],p.cufflinks.nomt$x[,3],labs=rownames(p.cufflinks.nomt$x))
load.pc1 <- p.cufflinks.nomt$rotation[,1][order(p.cufflinks.nomt$rotation[,1])]
extreme.pc1 <- c(tail(load.pc1), head(load.pc1))
extreme.pc1.ensg <- names(extreme.pc1)
extreme.pc1.symbols <- getBM(attributes=c("ensembl_gene_id", "hgnc_symbol"),
filters = "ensembl_gene_id",
values=extreme.pc1.ensg,
mart=ensembl)
barplot(extreme.pc1, names.arg=extreme.pc1.symbols[,2], las=2, main="Genes w highest absolute loadings in PC1 (Cufflinks FPKM without mito genes)")
load.pc2 <- p.cufflinks.nomt$rotation[,2][order(p.cufflinks.nomt$rotation[,2])]
extreme.pc2 <- c(tail(load.pc2), head(load.pc2))
extreme.pc2.ensg <- names(extreme.pc2)
extreme.pc2.symbols <- getBM(attributes=c("ensembl_gene_id", "hgnc_symbol"),
filters = "ensembl_gene_id",
values=extreme.pc2.ensg,
mart=ensembl)
barplot(extreme.pc2, names.arg=extreme.pc2.symbols[,2], las=2, main="Genes w highest absolute loadings in PC2 (Cufflinks FPKM without mito genes)")
load.pc3 <- p.cufflinks.nomt$rotation[,3][order(p.cufflinks.nomt$rotation[,3])]
extreme.pc3 <- c(tail(load.pc3), head(load.pc3))
extreme.pc3.ensg <- names(extreme.pc3)
extreme.pc3.symbols <- getBM(attributes=c("ensembl_gene_id", "hgnc_symbol"),
filters = "ensembl_gene_id",
values=extreme.pc3.ensg,
mart=ensembl)
barplot(extreme.pc3, names.arg=extreme.pc3.symbols[,2], las=2, main="Genes w highest absolute loadings in PC3 (Cufflinks FPKM without mito genes)")
pseudo <- 1
cufflinks_log <- log2(cufflinks_pc_nozero[,3:16] + pseudo)
rownames(cufflinks_log) <- cufflinks_pc_nozero[,1]
pheatmap(cor(cufflinks_log) ,method="spearman")
load.pc1 <- p.log.cufflinks$rotation[,1][order(p.log.cufflinks$rotation[,1])]
extreme.pc1 <- c(tail(load.pc1), head(load.pc1))
extreme.pc1.ensg <- names(extreme.pc1)
extreme.pc1.symbols <- getBM(attributes=c("ensembl_gene_id", "hgnc_symbol"),
filters = "ensembl_gene_id",
values=extreme.pc1.ensg,
mart=ensembl)
barplot(extreme.pc1, names.arg=extreme.pc1.symbols[,2], las=2, main="Genes w highest absolute loadings in PC1 (log2Cufflinks FPKM)")
load.pc2 <- p.log.cufflinks$rotation[,2][order(p.log.cufflinks$rotation[,2])]
extreme.pc2 <- c(tail(load.pc2), head(load.pc2))
extreme.pc2.ensg <- names(extreme.pc2)
extreme.pc2.symbols <- getBM(attributes=c("ensembl_gene_id", "hgnc_symbol"),
filters = "ensembl_gene_id",
values=extreme.pc2.ensg,
mart=ensembl)
barplot(extreme.pc2, names.arg=extreme.pc2.symbols[,2], las=2, main="Genes w highest absolute loadings in PC2 (log2Cufflinks FPKM)")
load.pc3 <- p.log.cufflinks$rotation[,3][order(p.log.cufflinks$rotation[,3])]
extreme.pc3 <- c(tail(load.pc3), head(load.pc3))
extreme.pc3.ensg <- names(extreme.pc3)
extreme.pc3.symbols <- getBM(attributes=c("ensembl_gene_id", "hgnc_symbol"),
filters = "ensembl_gene_id",
values=extreme.pc3.ensg,
mart=ensembl)
barplot(extreme.pc3, names.arg=extreme.pc3.symbols[,2], las=2, main="Genes w highest absolute loadings in PC3 (log2Cufflinks FPKM)")
colors <- c(2,1,3,2,1,3,2,1,3,2,1,3,2,1)
cufflinks_fpkms <- cufflinks_pc_nozero[,3:16]
rownames(cufflinks_fpkms) <- cufflinks_pc_nozero[,1]
p.cufflinks <- prcomp(t(cufflinks_fpkms))
plot(p.cufflinks$x[,1],p.cufflinks$x[,2],pch=20,col=colors,xlab=paste("PC1"),ylab=paste("PC2"),main="Reprocessed FPKM values \n n=19475")
textxy(p.cufflinks$x[,1],p.cufflinks$x[,2],labs=rownames(p.cufflinks$x))
cufflinks <- read.delim("fpkm_table_tophat.txt")
sampleinfo_cufflinks <- read.delim("sample_info_reprocessed.txt")
gene_ids <- as.vector(cufflinks[,1])
ensembl = useMart("ensembl", dataset = "hsapiens_gene_ensembl") #select the ensembl database
gene_type <- getBM(attributes=c("ensembl_gene_id", "gene_biotype"),
filters = "ensembl_gene_id",
values=gene_ids,
mart=ensembl)
pc <- subset(gene_type[,1],gene_type[,2]=="protein_coding")
cufflinks_pc <- cufflinks[match(pc,cufflinks[,1]),]
cufflinks_pc_nozero <- cufflinks_pc[-which(rowSums(cufflinks_pc[,3:16])<=0.01),]
gene_ids <- as.vector(cufflinks_pc_nozero[,1])
pheatmap(cor(cufflinks_pc_nozero[,3:16], method="spearman"))
pheatmap(cor(cufflinks_pc_nozero[,3:16], method="spearman"))
colors <- c(2,1,3,2,1,3,2,1,3,2,1,3,2,1)
cufflinks_fpkms <- cufflinks_pc_nozero[,3:16]
rownames(cufflinks_fpkms) <- cufflinks_pc_nozero[,1]
p.cufflinks <- prcomp(t(cufflinks_fpkms))
plot(p.cufflinks$x[,1],p.cufflinks$x[,2],pch=20,col=colors,xlab=paste("PC1"),ylab=paste("PC2"),main="Reprocessed FPKM values \n n=19475")
textxy(p.cufflinks$x[,1],p.cufflinks$x[,2],labs=rownames(p.cufflinks$x))
plot(p.cufflinks$x[,2],p.cufflinks$x[,2],pch=20,col=colors,xlab=paste("PC2"),ylab=paste("PC3"),main="Reprocessed FPKM values \n n=19475")
textxy(p.cufflinks$x[,2],p.cufflinks$x[,3],labs=rownames(p.cufflinks$x))
load.pc1 <- p.cufflinks$rotation[,1][order(p.cufflinks$rotation[,1])]
extreme.pc1 <- c(tail(load.pc1), head(load.pc1))
extreme.pc1.ensg <- names(extreme.pc1)
extreme.pc1.symbols <- getBM(attributes=c("ensembl_gene_id", "hgnc_symbol"),
filters = "ensembl_gene_id",
values=extreme.pc1.ensg,
mart=ensembl)
barplot(extreme.pc1, names.arg=extreme.pc1.symbols[,2], las=2, main="Genes w highest absolute loadings in PC1 (raw Cufflinks    FPKM)")
o <- melt(cufflinks_pc_nozero)
colnames(o) <- c("ENSG","Gene","sample_ID","Cuff_FPKM")
meta <- data.frame(tissue=c("brain","heart","kidney","brain","heart","kidney","brain","heart","kidney","brain","heart","kidney","brain","heart"),study=c("EoGE","EoGE","EoGE","Atlas","Atlas","Atlas","BodyMap","BodyMap","BodyMap","HPA","HPA","HPA","AltIso","AltIso"),prep=c(rep("poly-A",3),rep("rRNA-depl",3),rep("poly-A",8)),layout=c(rep("PE",3),rep("SE",3),rep("PE",6),rep("SE",2)))
rownames(meta) <- colnames(f_pc_nozero)[3:16]
tissue <- rep(meta$tissue, each=nrow(cufflinks_pc_nozero))
study <- rep(meta$study, each=nrow(cufflinks_pc_nozero))
prep <- rep(meta$prep, each=nrow(cufflinks_pc_nozero))
layout <- rep(meta$layout, each=nrow(cufflinks_pc_nozero))
data <- data.frame(o, tissue=tissue, study=study, prep=prep, layout=layout)
#subset <- data[sample(1:nrow(data), 1000),]
fit <- lm(Cuff_FPKM ~ prep + layout + study + tissue, data=data)
d <- anova(fit)
maxval = 3000
barplot(d$"F value"[-5],names.arg=rownames(d)[-5],main="Anova F score, Cufflinks FPKM",ylim=c(0,maxval))
maxval = 300
barplot(d$"F value"[-5],names.arg=rownames(d)[-5],main="Anova F score, Cufflinks FPKM",ylim=c(0,maxval))
maxval = 3000
barplot(d$"F value"[-5],names.arg=rownames(d)[-5],main="Anova F score, Cufflinks FPKM",ylim=c(0,maxval))
maxval = 300
barplot(d$"F value"[-5],names.arg=rownames(d)[-5],main="Anova F score, Cufflinks FPKM",ylim=c(0,maxval))
maxval = 3000
barplot(d$"F value"[-5],names.arg=rownames(d)[-5],main="Anova F score, Cufflinks FPKM",ylim=c(0,maxval))
maxval = 300
barplot(d$"F value"[-5],names.arg=rownames(d)[-5],main="Anova F score, Cufflinks FPKM",ylim=c(0,maxval))
maxval = 3000
barplot(d$"F value"[-5],names.arg=rownames(d)[-5],main="Anova F score, Cufflinks FPKM",ylim=c(0,maxval))
pseudo <- 1
cufflinks_log <- log2(cufflinks_pc_nozero[,3:16] + pseudo)
rownames(cufflinks_log) <- cufflinks_pc_nozero[,1]
pheatmap(cor(cufflinks_log) ,method="spearman")
colors <- c(2,1,3,2,1,3,2,1,3,2,1,3,2,1)
p.log.cufflinks <- prcomp(t(cufflinks_log))
plot(p.log.cufflinks$x[,1],p.log.cufflinks$x[,2],pch=20,col=colors,xlab=paste("PC1"),ylab=paste("PC2"),main="log2 reprocessed cufflinks FPKM values \n n=19475")
textxy(p.log.cufflinks$x[,1],p.log.cufflinks$x[,2],labs=rownames(p.log.cufflinks$x))
plot(p.log.cufflinks$x[,2],p.log.cufflinks$x[,3],pch=20,col=colors,xlab=paste("PC2"),ylab=paste("PC3"),main="log2 reprocessed cufflinks FPKM values \n n=19475")
textxy(p.log.cufflinks$x[,2],p.log.cufflinks$x[,3],labs=rownames(p.log.cufflinks$x))
load.pc1 <- p.log.cufflinks$rotation[,1][order(p.log.cufflinks$rotation[,1])]
extreme.pc1 <- c(tail(load.pc1), head(load.pc1))
extreme.pc1.ensg <- names(extreme.pc1)
extreme.pc1.symbols <- getBM(attributes=c("ensembl_gene_id", "hgnc_symbol"),
filters = "ensembl_gene_id",
values=extreme.pc1.ensg,
mart=ensembl)
barplot(extreme.pc1, names.arg=extreme.pc1.symbols[,2], las=2, main="Genes w highest absolute loadings in PC1 (log2Cufflinks FPKM)")
cufflinks_values <- cufflinks_pc_nozero[,3:16]
rownames(cufflinks_values) <- cufflinks_pc_nozero[,1]
load.pc1 <- abs(p.log.cufflinks$rotation[,1])[order(abs(p.log.cufflinks$rotation[,1]),decreasing=TRUE)]
top.pc1 <- names(load.pc1[1:500])
pheatmap(cor(cufflinks_values[top.pc1,]),method="spearman")
cufflinks_values <- cufflinks_pc_nozero[,3:16]
rownames(cufflinks_values) <- cufflinks_pc_nozero[,1]
load.pc1 <- abs(p.log.cufflinks$rotation[,1])[order(abs(p.log.cufflinks$rotation[,1]),decreasing=TRUE)]
top.pc1 <- names(load.pc1[1:500])
pheatmap(cor(cufflinks_values[top.pc1,]),method="spearman")
load.pc2 <- abs(p.log.cufflinks$rotation[,2])[order(abs(p.log.cufflinks$rotation[,2]),decreasing=TRUE)]
top.pc2 <- names(load.pc2[1:500])
pheatmap(cor(cufflinks_values[top.pc2,]),method="spearman")
load.pc3 <- abs(p.log.cufflinks$rotation[,3])[order(abs(p.log.cufflinks$rotation[,3]),decreasing=TRUE)]
top.pc3 <- names(load.pc3[1:500])
pheatmap(cor(cufflinks_values[top.pc3,]),method="spearman")
n <- melt(cufflinks.log[,])
colnames(n) <- c("sample_ID","FPKM")
meta <- sampleinfo_cufflinks[,c("Study","Tissue","Preparation","NumberRaw","Numbermapped","Readtype")]
rownames(meta) <- colnames(cufflinks.log[,3:16])
tissue <- rep(meta$Tissue, each=nrow(cufflinks.log))
study <- rep(meta$Study, each=nrow(cufflinks.log))
prep <- rep(meta$Preparation, each=nrow(cufflinks.log))
layout <- rep(meta$Readtype, each=nrow(cufflinks.log))
raw <- rep(meta$NumberRaw, each=nrow(cufflinks.log))
mapped <- rep(meta$Numbermapped, each=nrow(cufflinks.log))
data <- data.frame(n, tissue=tissue, study=study, prep=prep, layout=layout,nraw=raw,nmapped=mapped)
subset <- data[sample(1:nrow(data), 1000),]
fit <- lm(FPKM ~ study + nraw + layout + prep + tissue, data=data)
b <- anova(fit)
maxval = 3000
barplot(b$"F value"[-7],names.arg=rownames(b)[-7],main="Anova F score, Cufflinks FPKM",ylim=c(0,maxval))
print(b)
meta <- data.frame(study=c(rep("EoGE",3),rep("Atlas",3),rep("BodyMap",3),rep("HPA",3),rep("AltIso",2)),tissue=c("Brain","Heart","Kidney","Brain","Heart","Kidney","Brain","Heart","Kidney","Brain","Heart","Kidney","Brain","Heart"),prep=c(rep("poly-A",3),rep("rRNA-depl",3),rep("poly-A",8)),layout=c(rep("PE",3),rep("SE",3),rep("PE",6),rep("SE",2)))
batch <- meta$study
design <- model.matrix(~as.factor(tissue),data=meta)
combat.cufflinks <- ComBat(dat=cufflinks.log,batch=batch,mod=design,numCovs=NULL,par.prior=TRUE)
rownames(combat.cufflinks) <- cufflinks.log[,1]
colors <- c(2,1,3,2,1,3,2,1,3,2,1,3,2,1)
p.log.cufflinks <- prcomp(t(cufflinks_log))
plot(p.log.cufflinks$x[,1],p.log.cufflinks$x[,2],pch=20,col=colors,xlab=paste("PC1"),ylab=paste("PC2"),main="log2 reprocessed cufflinks FPKM values \n n=19475")
textxy(p.log.cufflinks$x[,1],p.log.cufflinks$x[,2],labs=rownames(p.log.cufflinks$x))
plot(p.cufflinks.nomt$x[,1],p.cufflinks.nomt$x[,2],pch=20,col=colors,xlab=paste("PC1"),ylab=paste("PC2"),main="Reprocessed FPKM values no mito \n n=19475")
textxy(p.cufflinks.nomt$x[,1],p.cufflinks.nomt$x[,2],labs=rownames(p.cufflinks.nomt$x))
plot(p.cufflinks.nomt$x[,2],p.cufflinks.nomt$x[,3],pch=20,col=colors,xlab=paste("PC2"),ylab=paste("PC3"),main="Reprocessed FPKM values no mito \n n=19475")
textxy(p.cufflinks.nomt$x[,2],p.cufflinks.nomt$x[,3],labs=rownames(p.cufflinks.nomt$x))
plot(p.cufflinks.nomt$x[,1],p.cufflinks.nomt$x[,2],pch=20,col=colors,xlab=paste("PC1"),ylab=paste("PC2"),main="Reprocessed FPKM values no mito \n n=19475")
textxy(p.cufflinks.nomt$x[,1],p.cufflinks.nomt$x[,2],labs=rownames(p.cufflinks.nomt$x))
plot(p.cufflinks.nomt$x[,2],p.cufflinks.nomt$x[,3],pch=20,col=colors,xlab=paste("PC2"),ylab=paste("PC3"),main="Reprocessed FPKM values no mito \n n=19475")
textxy(p.cufflinks.nomt$x[,2],p.cufflinks.nomt$x[,3],labs=rownames(p.cufflinks.nomt$x))
plot(p.cufflinks.nomt$x[,1],p.cufflinks.nomt$x[,2],pch=20,col=colors,xlab=paste("PC1"),ylab=paste("PC2"),main="Reprocessed FPKM values no mito \n n=19475")
textxy(p.cufflinks.nomt$x[,1],p.cufflinks.nomt$x[,2],labs=rownames(p.cufflinks.nomt$x))
pheatmap(cor(cufflinks_pc_nozero[,3:16], method="spearman"))
cufflinks_values <- cufflinks_pc_nozero[,3:16]
rownames(cufflinks_values) <- cufflinks_pc_nozero[,1]
load.pc1 <- abs(p.log.cufflinks$rotation[,1])[order(abs(p.log.cufflinks$rotation[,1]),decreasing=TRUE)]
top.pc1 <- names(load.pc1[1:500])
pheatmap(cor(cufflinks_values[top.pc1,]),method="spearman")
load.pc2 <- abs(p.log.cufflinks$rotation[,2])[order(abs(p.log.cufflinks$rotation[,2]),decreasing=TRUE)]
top.pc2 <- names(load.pc2[1:500])
pheatmap(cor(cufflinks_values[top.pc2,]),method="spearman")
load.pc3 <- abs(p.log.cufflinks$rotation[,3])[order(abs(p.log.cufflinks$rotation[,3]),decreasing=TRUE)]
top.pc3 <- names(load.pc3[1:500])
pheatmap(cor(cufflinks_values[top.pc3,]),method="spearman")
n <- melt(cufflinks.log[,])
colnames(n) <- c("sample_ID","FPKM")
meta <- sampleinfo_cufflinks[,c("Study","Tissue","Preparation","NumberRaw","Numbermapped","Readtype")]
rownames(meta) <- colnames(cufflinks.log[,3:16])
tissue <- rep(meta$Tissue, each=nrow(cufflinks.log))
study <- rep(meta$Study, each=nrow(cufflinks.log))
prep <- rep(meta$Preparation, each=nrow(cufflinks.log))
layout <- rep(meta$Readtype, each=nrow(cufflinks.log))
raw <- rep(meta$NumberRaw, each=nrow(cufflinks.log))
mapped <- rep(meta$Numbermapped, each=nrow(cufflinks.log))
data <- data.frame(n, tissue=tissue, study=study, prep=prep, layout=layout,nraw=raw,nmapped=mapped)
subset <- data[sample(1:nrow(data), 1000),]
fit <- lm(FPKM ~ study + nraw + layout + prep + tissue, data=data)
b <- anova(fit)
maxval = 3000
barplot(b$"F value"[-7],names.arg=rownames(b)[-7],main="Anova F score, Cufflinks FPKM",ylim=c(0,maxval))
print(b)
meta <- data.frame(study=c(rep("EoGE",3),rep("Atlas",3),rep("BodyMap",3),rep("HPA",3),rep("AltIso",2)),tissue=c("Brain","Heart","Kidney","Brain","Heart","Kidney","Brain","Heart","Kidney","Brain","Heart","Kidney","Brain","Heart"),prep=c(rep("poly-A",3),rep("rRNA-depl",3),rep("poly-A",8)),layout=c(rep("PE",3),rep("SE",3),rep("PE",6),rep("SE",2)))
batch <- meta$study
design <- model.matrix(~as.factor(tissue),data=meta)
combat.cufflinks <- ComBat(dat=cufflinks.log,batch=batch,mod=design,numCovs=NULL,par.prior=TRUE)
rownames(combat.cufflinks) <- cufflinks.log[,1]
write.table(combat, file="reprocessed_rpkms_combat_log2.txt", quote=F)
n <- melt(cufflinks_log[,])
colnames(n) <- c("sample_ID","FPKM")
meta <- sampleinfo_cufflinks[,c("Study","Tissue","Preparation","NumberRaw","Numbermapped","Readtype")]
rownames(meta) <- colnames(cufflinks.log[,3:16])
tissue <- rep(meta$Tissue, each=nrow(cufflinks.log))
study <- rep(meta$Study, each=nrow(cufflinks.log))
prep <- rep(meta$Preparation, each=nrow(cufflinks.log))
layout <- rep(meta$Readtype, each=nrow(cufflinks.log))
raw <- rep(meta$NumberRaw, each=nrow(cufflinks.log))
mapped <- rep(meta$Numbermapped, each=nrow(cufflinks.log))
data <- data.frame(n, tissue=tissue, study=study, prep=prep, layout=layout,nraw=raw,nmapped=mapped)
rownames(meta) <- colnames(cufflinks_log[,3:16])
head(cufflinks_log)
n <- melt(cufflinks_log[,])
colnames(n) <- c("sample_ID","FPKM")
meta <- sampleinfo_cufflinks[,c("Study","Tissue","Preparation","NumberRaw","Numbermapped","Readtype")]
rownames(meta) <- colnames(cufflinks_log[,])
tissue <- rep(meta$Tissue, each=nrow(cufflinks_log))
study <- rep(meta$Study, each=nrow(cufflinks_log))
prep <- rep(meta$Preparation, each=nrow(cufflinks_log))
layout <- rep(meta$Readtype, each=nrow(cufflinks_log))
raw <- rep(meta$NumberRaw, each=nrow(cufflinks_log))
mapped <- rep(meta$Numbermapped, each=nrow(cufflinks_log))
data <- data.frame(n, tissue=tissue, study=study, prep=prep, layout=layout,nraw=raw,nmapped=mapped)
subset <- data[sample(1:nrow(data), 1000),]
fit <- lm(FPKM ~ study + nraw + layout + prep + tissue, data=data)
b <- anova(fit)
maxval = 3000
barplot(b$"F value"[-7],names.arg=rownames(b)[-7],main="Anova F score, Cufflinks FPKM",ylim=c(0,maxval))
o <- melt(cufflinks_pc_nozero)
colnames(o) <- c("ENSG","Gene","sample_ID","Cuff_FPKM")
meta <- data.frame(tissue=c("brain","heart","kidney","brain","heart","kidney","brain","heart","kidney","brain","heart","kidney","brain","heart"),study=c("EoGE","EoGE","EoGE","Atlas","Atlas","Atlas","BodyMap","BodyMap","BodyMap","HPA","HPA","HPA","AltIso","AltIso"),prep=c(rep("poly-A",3),rep("rRNA-depl",3),rep("poly-A",8)),layout=c(rep("PE",3),rep("SE",3),rep("PE",6),rep("SE",2)))
rownames(meta) <- colnames(f_pc_nozero)[3:16]
tissue <- rep(meta$tissue, each=nrow(cufflinks_pc_nozero))
study <- rep(meta$study, each=nrow(cufflinks_pc_nozero))
prep <- rep(meta$prep, each=nrow(cufflinks_pc_nozero))
layout <- rep(meta$layout, each=nrow(cufflinks_pc_nozero))
data <- data.frame(o, tissue=tissue, study=study, prep=prep, layout=layout)
#subset <- data[sample(1:nrow(data), 1000),]
fit <- lm(Cuff_FPKM ~ prep + layout + study + tissue, data=data)
d <- anova(fit)
maxval = 3000
barplot(d$"F value"[-5],names.arg=rownames(d)[-5],main="Anova F score, Cufflinks FPKM",ylim=c(0,maxval))
meta <- data.frame(study=c(rep("EoGE",3),rep("Atlas",3),rep("BodyMap",3),rep("HPA",3),rep("AltIso",2)),tissue=c("Brain","Heart","Kidney","Brain","Heart","Kidney","Brain","Heart","Kidney","Brain","Heart","Kidney","Brain","Heart"),prep=c(rep("poly-A",3),rep("rRNA-depl",3),rep("poly-A",8)),layout=c(rep("PE",3),rep("SE",3),rep("PE",6),rep("SE",2)))
batch <- meta$study
meta <- data.frame(study=c(rep("EoGE",3),rep("Atlas",3),rep("BodyMap",3),rep("HPA",3),rep("AltIso",2)),tissue=c("Brain","Heart","Kidney","Brain","Heart","Kidney","Brain","Heart","Kidney","Brain","Heart","Kidney","Brain","Heart"),prep=c(rep("poly-A",3),rep("rRNA-depl",3),rep("poly-A",8)),layout=c(rep("PE",3),rep("SE",3),rep("PE",6),rep("SE",2)))
batch <- meta$study
design <- model.matrix(~as.factor(tissue),data=meta)
combat.cufflinks <- ComBat(dat=cufflinks_log,batch=batch,mod=design,numCovs=NULL,par.prior=TRUE)
head(cufflinks_log)
rownames(combat.cufflinks) <- rownames(cufflinks_log)
pheatmap(cor(combat.cufflinks),method="spearman")
colors <- c(2,1,3,2,1,3,2,1,3,2,1,3,2,1)
p.combat.cufflinks <- prcomp(t(combat.cufflinks))
plot(p.combat.cufflinks$x[,1],p.combat.cufflinks$x[,2],pch=20,col=colors,xlab=paste("PC1"),ylab=paste("PC2"),main="Cufflinks FPKM values \n COMBAT \n n=19,475")
textxy(p.combat.cufflinks$x[,1],p.combat.cufflinks$x[,2],labs=rownames(p.combat.cufflinks$x))
load.pc1 <- p.combat.cufflinks$rotation[,1][order(p.combat.cufflinks$rotation[,1])]
extreme.pc1 <- c(tail(load.pc1), head(load.pc1))
extreme.pc1.ensg <- names(extreme.pc1)
extreme.pc1.symbols <- getBM(attributes=c("ensembl_gene_id", "hgnc_symbol"),
filters = "ensembl_gene_id",
values=extreme.pc1.ensg,
mart=ensembl)
barplot(extreme.pc1, names.arg=extreme.pc1.symbols[,2], las=2, main="Genes w highest absolute loadings in PC1 (COMBAT Cufflinks FPKM)")
counts <- read.delim("count_table.txt",row.names=1)
ensembl = useMart("ensembl", dataset = "hsapiens_gene_ensembl") #select the ensembl database
head(counts)
gene_type <- getBM(attributes=c("ensembl_gene_id", "gene_biotype"),
filters = "ensembl_gene_id",
values=rownames(counts),
mart=ensembl)
pc <- subset(gene_type[,1],gene_type[,2]=="protein_coding")
counts_pc <- counts[match(pc,rownames(counts)),]
View(counts_pc)
colnames(counts_pc)<-c("EoGE_brain","EoGE_heart","EoGE_kidney","Atlas_brain","Atlas_heart","Atlas_kidney","BodyMap_brain","BodyMap_heart","BodyMap_kidney","HPA_brain","HPA_heart","HPA_kidney","AltIso_brain","AltIso_heart")
counts_pc_nonzero <- counts_pc[-which(rowSums(counts_pc)<=0.01),]
cufflinks_values <- cufflinks_pc_nozero[,3:16]
head(cufflinks_fpkms)
View(cufflinks_fpkms_nomt)
cufflinks_values <- cufflinks_fpkms[,]
View(published.nozero)
