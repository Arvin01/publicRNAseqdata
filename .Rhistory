dev.off()
library(pheatmap)
library(reshape)
library(gplots)
library(ops)
library(calibrate)
library(biomaRt)
library(sva)
published <- read.delim("published_rpkms.txt",sep=" ")
sampleinfo_published <- read.table("sample_info_published.txt",header=TRUE)
published.nozero <- published[-which(rowSums(published[,])<=0.01),]
pheatmap(cor(published.nozero, method="spearman"))
colors <- c("indianred", "dodgerblue", "forestgreen",
"indianred", "dodgerblue",
"indianred", "dodgerblue", "forestgreen",
"indianred", "dodgerblue", "forestgreen")
p <- prcomp(t(published.nozero))
rownames(p$x) <- c(rep("HPA",3),rep("AltIso",2),rep("GTEx",3),rep("Atlas",3))
plot(p$x[,1],p$x[,2],pch=20,cex=1.5,col=colors,xlab=paste("PC1"),ylab=paste("PC2"),main="Published FPKM/RPKM values \n n=13,323")
legend("bottomright",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
m <- melt(published.nozero)
colnames(m) <- c("sample_ID","RPKM")
meta <- sampleinfo_published[,c("Study","Tissue","Preparation","NumberRaw","Numbermapped","Readtype")]
rownames(meta) <- colnames(published.nozero)
tissue <- rep(meta$Tissue, each=nrow(published.nozero))
study <- rep(meta$Study, each=nrow(published.nozero))
prep <- rep(meta$Preparation, each=nrow(published.nozero))
layout <- rep(meta$Readtype, each=nrow(published.nozero))
raw <- rep(meta$NumberRaw, each=nrow(published.nozero))
mapped <- rep(meta$Numbermapped, each=nrow(published.nozero))
data <- data.frame(m, tissue=tissue, study=study, prep=prep, layout=layout,nraw=raw,nmapped=mapped)
fit <- lm(RPKM ~ layout + prep + nraw + study + tissue, data=data)
a <- anova(fit)
maxval = 100
barplot(100*a$"Sum Sq"[1:5]/sum(a$"Sum Sq"[1:5]),names.arg=rownames(a[1:5,]),main="Anova, published FPKM/RPKM values",ylim=c(0,maxval))
pseudo <- 1
published.log <- log2(published.nozero + pseudo)
n <- melt(published.log)
colnames(n) <- c("sample_ID","RPKM")
meta <- sampleinfo_published[,c("Study","Tissue","Preparation","NumberRaw","Numbermapped","Readtype")]
rownames(meta) <- colnames(published.log)
tissue <- rep(meta$Tissue, each=nrow(published.log))
study <- rep(meta$Study, each=nrow(published.log))
prep <- rep(meta$Preparation, each=nrow(published.log))
layout <- rep(meta$Readtype, each=nrow(published.log))
raw <- rep(meta$NumberRaw, each=nrow(published.log))
mapped <- rep(meta$Numbermapped, each=nrow(published.log))
data <- data.frame(n, tissue=tissue, study=study, prep=prep, layout=layout,nraw=raw,nmapped=mapped)
fit <- lm(RPKM ~ layout + prep + nraw + study + tissue, data=data)
b <- anova(fit)
maxval = 100
pdf("/Users/fridadanielsson/Documents/Projekt/Publika_dataset/manuscript/figures/manuscript_figures/2e.pdf")
barplot(100*b$"Sum Sq"[1:5]/sum(b$"Sum Sq"[1:5]),names.arg=rownames(a[1:5,]),main="Anova, log2 published FPKM/RPKM values",ylim=c(0,maxval))
dev.off()
meta <- data.frame(study=c(rep("HPA",3),rep("AltIso",2),rep("GTex",3),rep("Atlas",3)),tissue=c("Heart","Brain","Kidney","Heart","Brain","Heart","Brain","Kidney","Heart","Brain","Kidney"))
batch <- meta$study
design <- model.matrix(~as.factor(tissue),data=meta)
combat <- ComBat(dat=published.log,batch=batch,mod=design,numCovs=NULL,par.prior=TRUE)
pdf("/Users/fridadanielsson/Documents/Projekt/Publika_dataset/manuscript/figures/manuscript_figures/3a.pdf")
pheatmap(cor(combat, method="spearman"))
dev.off()
colors <- c("indianred", "dodgerblue", "forestgreen",
"indianred", "dodgerblue",
"indianred", "dodgerblue", "forestgreen",
"indianred", "dodgerblue", "forestgreen")
p.combat <- prcomp(t(combat))
pdf("/Users/fridadanielsson/Documents/Projekt/Publika_dataset/manuscript/figures/manuscript_figures/3b.pdf")
plot(p.combat$x[,1],p.combat$x[,2],pch=20,col=colors,xlab=paste("PC1"),ylab=paste("PC2"),main="Published FPKM values \n COMBAT \n n=13,323")
legend("bottomright",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
dev.off()
o <- melt(combat)
colnames(o) <- c("sample_ID","combat")
meta <- sampleinfo_published[,c("Study","Tissue","Preparation","NumberRaw","Numbermapped","Readtype")]
rownames(meta) <- colnames(combat)
tissue <- rep(meta$Tissue, each=nrow(combat))
study <- rep(meta$Study, each=nrow(combat))
prep <- rep(meta$Preparation, each=nrow(combat))
layout <- rep(meta$Readtype, each=nrow(combat))
raw <- rep(meta$NumberRaw, each=nrow(combat))
mapped <- rep(meta$Numbermapped, each=nrow(combat))
data <- data.frame(o, tissue=tissue, study=study, prep=prep, layout=layout,nraw=raw,nmapped=mapped)
fit <- lm(combat ~ layout + prep + nraw + study + tissue, data=data)
c <- anova(fit)
maxval = 100
barplot(100*c$"Sum Sq"[1:5]/sum(c$"Sum Sq"[1:5]),names.arg=rownames(c[1:5,]),main="Anova Combat",ylim=c(0,maxval))
pdf("/Users/fridadanielsson/Documents/Projekt/Publika_dataset/manuscript/figures/manuscript_figures/3c.pdf")
barplot(100*c$"Sum Sq"[1:5]/sum(c$"Sum Sq"[1:5]),names.arg=rownames(c[1:5,]),main="Anova Combat",ylim=c(0,maxval))
dev.off()
cufflinks <- read.delim("fpkm_table_tophat.txt")
sampleinfo_cufflinks <- read.delim("sample_info_reprocessed.txt")
gene_ids <- as.vector(cufflinks[,1])
ensembl = useMart("ensembl", dataset = "hsapiens_gene_ensembl") #select the ensembl database
gene_type <- getBM(attributes=c("ensembl_gene_id", "gene_biotype"),
filters = "ensembl_gene_id",
values=gene_ids,
mart=ensembl)
pc <- subset(gene_type[,1],gene_type[,2]=="protein_coding")
cufflinks_pc <- cufflinks[match(pc,cufflinks[,1]),]
cufflinks_pc_nozero <- cufflinks_pc[-which(rowSums(cufflinks_pc[,3:16])<=0.01),]
pdf("/Users/fridadanielsson/Documents/Projekt/Publika_dataset/manuscript/figures/manuscript_figures/4a.pdf")
pheatmap(cor(cufflinks_pc_nozero[,3:16], method="spearman"))
dev.off()
pheatmap(cor(cufflinks_pc_nozero[,3:16], method="spearman"))
cufflinks_fpkms <- cufflinks_pc_nozero[,3:16]
rownames(cufflinks_fpkms) <- cufflinks_pc_nozero[,1]
p.cufflinks <- prcomp(t(cufflinks_fpkms))
colors <- c("dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred")
pdf("/Users/fridadanielsson/Documents/Projekt/Publika_dataset/manuscript/figures/manuscript_figures/4b.pdf")
plot(p.cufflinks$x[,1],p.cufflinks$x[,2],pch=20,col=colors,xlab=paste("PC1"),ylab=paste("PC2"),main="Reprocessed FPKM values \n n=19,475")
legend("bottomright",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
dev.off()
p <- melt(cufflinks_fpkms)
colnames(p) <- c("sample_ID","Cuff_FPKM")
meta <- sampleinfo_cufflinks[,c("Study","Tissue","Preparation","NumberRaw","Numbermapped","Readtype")]
rownames(meta) <- colnames(cufflinks_fpkms)
tissue <- rep(meta$Tissue, each=nrow(cufflinks_fpkms))
study <- rep(meta$Study, each=nrow(cufflinks_fpkms))
prep <- rep(meta$Preparation, each=nrow(cufflinks_fpkms))
layout <- rep(meta$Readtype, each=nrow(cufflinks_fpkms))
data <- data.frame(p, tissue=tissue, study=study, prep=prep, layout=layout)
fit <- lm(Cuff_FPKM ~ layout + prep + nraw + study + tissue, data=data)
d <- anova(fit)
maxval = 100
barplot(100*d$"Sum Sq"[1:5]/sum(d$"Sum Sq"[1:5]),names.arg=rownames(d[1:5,]),main="Anova, Cufflinks FPKM",ylim=c(0,maxval))
p <- melt(cufflinks_fpkms)
colnames(p) <- c("sample_ID","Cuff_FPKM")
meta <- sampleinfo_cufflinks[,c("Study","Tissue","Preparation","NumberRaw","Numbermapped","Readtype")]
rownames(meta) <- colnames(cufflinks_fpkms)
tissue <- rep(meta$Tissue, each=nrow(cufflinks_fpkms))
study <- rep(meta$Study, each=nrow(cufflinks_fpkms))
prep <- rep(meta$Preparation, each=nrow(cufflinks_fpkms))
layout <- rep(meta$Readtype, each=nrow(cufflinks_fpkms))
data <- data.frame(p, tissue=tissue, study=study, prep=prep, layout=layout)
fit <- lm(Cuff_FPKM ~ layout + prep + nraw + study + tissue, data=data)
d <- anova(fit)
maxval = 100
barplot(100*d$"Sum Sq"[1:5]/sum(d$"Sum Sq"[1:5]),names.arg=rownames(d[1:5,]),main="Anova, Cufflinks FPKM",ylim=c(0,maxval))
d
cufflinks <- read.delim("fpkm_table_tophat.txt")
sampleinfo_cufflinks <- read.delim("sample_info_reprocessed.txt")
gene_ids <- as.vector(cufflinks[,1])
ensembl = useMart("ensembl", dataset = "hsapiens_gene_ensembl") #select the ensembl database
gene_type <- getBM(attributes=c("ensembl_gene_id", "gene_biotype"),
filters = "ensembl_gene_id",
values=gene_ids,
mart=ensembl)
pc <- subset(gene_type[,1],gene_type[,2]=="protein_coding")
cufflinks_pc <- cufflinks[match(pc,cufflinks[,1]),]
cufflinks_fpkms <- cufflinks_pc_nozero[,3:16]
cufflinks_pc_nozero <- cufflinks_pc[-which(rowSums(cufflinks_pc[,3:16])<=0.01),]
cufflinks_fpkms <- cufflinks_pc_nozero[,3:16]
rownames(cufflinks_fpkms) <- cufflinks_pc_nozero[,1]
p <- melt(cufflinks_fpkms)
colnames(p) <- c("sample_ID","Cuff_FPKM")
meta <- sampleinfo_cufflinks[,c("Study","Tissue","Preparation","NumberRaw","Numbermapped","Readtype")]
rownames(meta) <- colnames(cufflinks_fpkms)
tissue <- rep(meta$Tissue, each=nrow(cufflinks_fpkms))
study <- rep(meta$Study, each=nrow(cufflinks_fpkms))
prep <- rep(meta$Preparation, each=nrow(cufflinks_fpkms))
layout <- rep(meta$Readtype, each=nrow(cufflinks_fpkms))
data <- data.frame(p, tissue=tissue, study=study, prep=prep, layout=layout)
fit <- lm(Cuff_FPKM ~ layout + prep + nraw + study + tissue, data=data)
d <- anova(fit)
maxval = 100
barplot(100*d$"Sum Sq"[1:5]/sum(d$"Sum Sq"[1:5]),names.arg=rownames(d[1:5,]),main="Anova, Cufflinks FPKM",ylim=c(0,maxval))
p <- melt(cufflinks_fpkms)
colnames(p) <- c("sample_ID","Cuff_FPKM")
sampleinfo_cufflinks
meta <- sampleinfo_cufflinks[,c("Study","Tissue","Preparation","NumberRaw","Numbermapped","Readtype")]
meta
rownames(meta) <- colnames(cufflinks_fpkms)
tissue <- rep(meta$Tissue, each=nrow(cufflinks_fpkms))
study <- rep(meta$Study, each=nrow(cufflinks_fpkms))
prep <- rep(meta$Preparation, each=nrow(cufflinks_fpkms))
layout <- rep(meta$Readtype, each=nrow(cufflinks_fpkms))
nraw <- rep(meta$NumberRaw, each=nrow(cufflinks_fpkms))
data <- data.frame(p, tissue=tissue, study=study, prep=prep, layout=layout,nraw=raw, nmapped=mapped)
data <- data.frame(p, tissue=tissue, study=study, prep=prep, layout=layout,nraw=raw)
data <- data.frame(p, tissue=tissue, study=study, prep=prep, layout=layout, nraw=nraw)
fit <- lm(Cuff_FPKM ~ layout + prep + nraw + study + tissue, data=data)
d <- anova(fit)
maxval = 100
barplot(100*d$"Sum Sq"[1:5]/sum(d$"Sum Sq"[1:5]),names.arg=rownames(d[1:5,]),main="Anova, Cufflinks FPKM",ylim=c(0,maxval))
?anova
p <- melt(cufflinks_fpkms)
colnames(p) <- c("sample_ID","Cuff_FPKM")
meta <- sampleinfo_cufflinks[,c("Study","Tissue","Preparation","NumberRaw","Numbermapped","Readtype")]
rownames(meta) <- colnames(cufflinks_fpkms)
tissue <- rep(meta$Tissue, each=nrow(cufflinks_fpkms))
study <- rep(meta$Study, each=nrow(cufflinks_fpkms))
prep <- rep(meta$Preparation, each=nrow(cufflinks_fpkms))
layout <- rep(meta$Readtype, each=nrow(cufflinks_fpkms))
nraw <- rep(meta$NumberRaw, each=nrow(cufflinks_fpkms))
data <- data.frame(p, tissue=tissue, study=study, prep=prep, layout=layout, nraw=nraw)
fit <- lm(Cuff_FPKM ~ layout + prep + nraw + study + tissue, data=data)
d <- anova(fit)
maxval = 100
barplot(100*d$"Sum Sq"[1:5]/sum(d$"Sum Sq"[1:5]),names.arg=rownames(d[1:5,]),main="Anova, Cufflinks FPKM",ylim=c(0,maxval))
p <- melt(cufflinks_fpkms)
colnames(p) <- c("sample_ID","Cuff_FPKM")
meta <- sampleinfo_cufflinks[,c("Study","Tissue","Preparation","NumberRaw","Numbermapped","Readtype")]
rownames(meta) <- colnames(cufflinks_fpkms)
tissue <- rep(meta$Tissue, each=nrow(cufflinks_fpkms))
study <- rep(meta$Study, each=nrow(cufflinks_fpkms))
prep <- rep(meta$Preparation, each=nrow(cufflinks_fpkms))
layout <- rep(meta$Readtype, each=nrow(cufflinks_fpkms))
nraw <- rep(meta$NumberRaw, each=nrow(cufflinks_fpkms))
data <- data.frame(p, tissue=tissue, study=study, prep=prep, layout=layout, nraw=nraw)
fit <- lm(Cuff_FPKM ~ layout + prep + nraw + study + tissue, data=data)
d <- anova(fit)
maxval = 100
pdf("/Users/fridadanielsson/Documents/Projekt/Publika_dataset/manuscript/figures/manuscript_figures/4c.pdf")
barplot(100*d$"Sum Sq"[1:5]/sum(d$"Sum Sq"[1:5]),names.arg=rownames(d[1:5,]),main="Anova, Cufflinks FPKM",ylim=c(0,maxval))
dev.off()
p <- prcomp(t(published.nozero))
published <- read.delim("published_rpkms.txt",sep=" ")
sampleinfo_published <- read.table("sample_info_published.txt",header=TRUE)
published.nozero <- published[-which(rowSums(published[,])<=0.01),]
pheatmap(cor(published.nozero, method="spearman"))
pheatmap(cor(published.nozero))
colors <- c("indianred", "dodgerblue", "forestgreen",
"indianred", "dodgerblue",
"indianred", "dodgerblue", "forestgreen",
"indianred", "dodgerblue", "forestgreen")
p <- prcomp(t(published.nozero))
rownames(p$x) <- c(rep("HPA",3),rep("AltIso",2),rep("GTEx",3),rep("Atlas",3))
print(p)
summary(p)
summary(p)[2,2]
head(p)
summary(p)
plot(p$x[,1],p$x[,2],pch=20,cex=1.5,col=colors,xlab=paste("PC1"),ylab=paste("PC2"),main="Published FPKM/RPKM values \n n=13,323")
legend("bottomright",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
plot(p$x[,1],p$x[,2],pch=20,cex=1.5,col=colors,xlab=paste("PC1 \n 58% of variance"),ylab=paste("PC2"),main="Published FPKM/RPKM values \n n=13,323")
plot(p$x[,1],p$x[,2],pch=20,cex=1.5,col=colors,xlab=paste("PC1 \n 58% of variance"),ylab=paste("PC2 \n 13% of variance"),main="Published FPKM/RPKM values \n n=13,323")
#Proportion of Variance    0.5771    0.1283
pdf("/Users/fridadanielsson/Documents/Projekt/Publika_dataset/manuscript/figures/manuscript_figures/1c.pdf")
plot(p$x[,1],p$x[,2],pch=20,cex=1.5,col=colors,xlab=paste("PC1 \n 58% of variance"),ylab=paste("PC2 \n 13% of variance"),main="Published FPKM/RPKM values \n n=13,323")
legend("bottomright",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
dev.off()
pdf("/Users/fridadanielsson/Documents/Projekt/Publika_dataset/manuscript/figures/manuscript_figures/1c.pdf")
plot(p$x[,1],p$x[,2],pch=20,cex=1.5,col=colors,xlab=paste("PC1 58% of variance"),ylab=paste("PC2 13% of variance"),main="Published FPKM/RPKM values \n n=13,323")
legend("bottomright",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
dev.off()
colors <- c("indianred", "dodgerblue", "forestgreen",
"indianred", "dodgerblue",
"indianred", "dodgerblue", "forestgreen",
"indianred", "dodgerblue", "forestgreen")
p.log <- prcomp(t(published.log))
pseudo <- 1
published.log <- log2(published.nozero + pseudo)
pheatmap(cor(published.log),method="spearman")
colors <- c("indianred", "dodgerblue", "forestgreen",
"indianred", "dodgerblue",
"indianred", "dodgerblue", "forestgreen",
"indianred", "dodgerblue", "forestgreen")
p.log <- prcomp(t(published.log))
summary(p.log)
colors <- c("indianred", "dodgerblue", "forestgreen",
"indianred", "dodgerblue",
"indianred", "dodgerblue", "forestgreen",
"indianred", "dodgerblue", "forestgreen")
p.log <- prcomp(t(published.log))
pdf("/Users/fridadanielsson/Documents/Projekt/Publika_dataset/manuscript/figures/manuscript_figures/2b.pdf")
plot(p.log$x[,1],p.log$x[,2],pch=20,col=colors,xlab=paste("PC1 31% of variance"),ylab=paste("PC2 27% of variance"),main="log2 Published FPKM/RPKM values \n n=13,323")
textxy(p.log$x[,1],p.log$x[,2])
legend("bottomright",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
dev.off()
pdf("/Users/fridadanielsson/Documents/Projekt/Publika_dataset/manuscript/figures/manuscript_figures/2c.pdf")
plot(p.log$x[,2],p.log$x[,3],pch=20,col=colors,xlab=paste("PC2 27% of variance"),ylab=paste("PC3 19% of variance"),main="log2 Published FPKM values \n n=13,323")
textxy(p.log$x[,2],p.log$x[,3])
legend("bottomright",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
dev.off()
meta <- data.frame(study=c(rep("HPA",3),rep("AltIso",2),rep("GTex",3),rep("Atlas",3)),tissue=c("Heart","Brain","Kidney","Heart","Brain","Heart","Brain","Kidney","Heart","Brain","Kidney"))
batch <- meta$study
design <- model.matrix(~as.factor(tissue),data=meta)
combat <- ComBat(dat=published.log,batch=batch,mod=design,numCovs=NULL,par.prior=TRUE)
colors <- c("indianred", "dodgerblue", "forestgreen",
"indianred", "dodgerblue",
"indianred", "dodgerblue", "forestgreen",
"indianred", "dodgerblue", "forestgreen")
p.combat <- prcomp(t(combat))
summary(p.combat)
pdf("/Users/fridadanielsson/Documents/Projekt/Publika_dataset/manuscript/figures/manuscript_figures/3b.pdf")
plot(p.combat$x[,1],p.combat$x[,2],pch=20,col=colors,xlab=paste("PC1 54% of variance"),ylab=paste("PC2 38% of variance"),main="Published FPKM values \n COMBAT \n n=13,323")
legend("bottomright",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
dev.off()
cufflinks_fpkms <- cufflinks_pc_nozero[,3:16]
rownames(cufflinks_fpkms) <- cufflinks_pc_nozero[,1]
p.cufflinks <- prcomp(t(cufflinks_fpkms))
summary(p.cufflinks)
8.680e-01*100
100*7.672e-02
plot(p.cufflinks$x[,1],p.cufflinks$x[,2],pch=20,col=colors,xlab=paste("PC1 87% of variance"),ylab=paste("PC2 7.7% of variance"),main="Reprocessed FPKM values \n n=19,475")
pdf("/Users/fridadanielsson/Documents/Projekt/Publika_dataset/manuscript/figures/manuscript_figures/4b.pdf")
plot(p.cufflinks$x[,1],p.cufflinks$x[,2],pch=20,col=colors,xlab=paste("PC1 87% of variance"),ylab=paste("PC2 7.7% of variance"),main="Reprocessed FPKM values \n n=19,475")
legend("bottomright",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
dev.off()
p <- melt(cufflinks_fpkms)
colnames(p) <- c("sample_ID","Cuff_FPKM")
meta <- sampleinfo_cufflinks[,c("Study","Tissue","Preparation","NumberRaw","Numbermapped","Readtype")]
rownames(meta) <- colnames(cufflinks_fpkms)
tissue <- rep(meta$Tissue, each=nrow(cufflinks_fpkms))
study <- rep(meta$Study, each=nrow(cufflinks_fpkms))
prep <- rep(meta$Preparation, each=nrow(cufflinks_fpkms))
layout <- rep(meta$Readtype, each=nrow(cufflinks_fpkms))
nraw <- rep(meta$NumberRaw, each=nrow(cufflinks_fpkms))
data <- data.frame(p, tissue=tissue, study=study, prep=prep, layout=layout, nraw=nraw)
fit <- lm(Cuff_FPKM ~ layout + prep + nraw + study + tissue, data=data)
d <- anova(fit)
maxval = 100
barplot(100*d$"Sum Sq"[1:5]/sum(d$"Sum Sq"[1:5]),names.arg=rownames(d[1:5,]),main="Anova, Cufflinks FPKM",ylim=c(0,maxval))
pseudo <- 1
cufflinks_log <- log2(cufflinks_fpkms + pseudo)
pheatmap(cor(cufflinks_log) ,method="spearman")
colors <- c("dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred")
p.log.cufflinks <- prcomp(t(cufflinks_log))
summary(p.log.cufflinks)
pdf("/Users/fridadanielsson/Documents/Projekt/Publika_dataset/manuscript/figures/manuscript_figures/4d.pdf")
plot(p.log.cufflinks$x[,1],p.log.cufflinks$x[,2],pch=20,col=colors,xlab=paste("PC1 33% of variance"),ylab=paste("PC2 25% of variance"),main="log2 reprocessed cufflinks FPKM values \n n=19,475")
legend("bottomright",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
dev.off()
pdf("/Users/fridadanielsson/Documents/Projekt/Publika_dataset/manuscript/figures/manuscript_figures/4e.pdf")
plot(p.log.cufflinks$x[,2],p.log.cufflinks$x[,3],pch=20,col=colors,xlab=paste("PC2 25% of variance"),ylab=paste("PC3 22% of variance"),main="log2 reprocessed cufflinks FPKM values \n n=19,475")
legend("bottomright",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
dev.off()
meta <- data.frame(study=c(rep("EoGE",3),rep("Atlas",3),rep("BodyMap",3),rep("HPA",3),rep("AltIso",2)),tissue=c("Brain","Heart","Kidney","Brain","Heart","Kidney","Brain","Heart","Kidney","Brain","Heart","Kidney","Brain","Heart"),prep=c(rep("poly-A",3),rep("rRNA-depl",3),rep("poly-A",8)),layout=c(rep("PE",3),rep("SE",3),rep("PE",6),rep("SE",2)))
batch <- meta$study
design <- model.matrix(~as.factor(tissue),data=meta)
combat.cufflinks <- ComBat(dat=cufflinks_log,batch=batch,mod=design,numCovs=NULL,par.prior=TRUE)
rownames(combat.cufflinks) <- rownames(cufflinks_log)
write.table(combat, file="reprocessed_rpkms_combat_log2.txt", quote=F)
pheatmap(cor(combat.cufflinks),method="spearman")
p.combat.cufflinks <- prcomp(t(combat.cufflinks))
summary(p.combat.cufflinks)
pdf("/Users/fridadanielsson/Documents/Projekt/Publika_dataset/manuscript/figures/manuscript_figures/4h.pdf")
plot(p.combat.cufflinks$x[,1],p.combat.cufflinks$x[,2],pch=20,col=colors,xlab=paste("PC1 54% of variance"),ylab=paste("PC2 37% of variance"),main="Cufflinks FPKM values \n COMBAT \n n=19,475")
legend("bottomright",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
dev.off()
pdf("/Users/fridadanielsson/Documents/Projekt/Publika_dataset/manuscript/figures/manuscript_figures/4i.pdf")
plot(p.combat.cufflinks$x[,2],p.combat.cufflinks$x[,3],pch=20,col=colors,xlab=paste("PC2 37% of variance"),ylab=paste("PC3 2% of variance"),main="Cufflinks FPKM values \n COMBAT \n n=19,475")
legend("bottomright",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
dev.off()
published <- read.delim("published_rpkms.txt",sep=" ")
sampleinfo_published <- read.table("sample_info_published.txt",header=TRUE)
published.nozero <- published[-which(rowSums(published[,])<=0.01),]
pseudo <- 1
published.log <- log2(published.nozero + pseudo)
colors <- c("indianred", "dodgerblue", "forestgreen",
"indianred", "dodgerblue",
"indianred", "dodgerblue", "forestgreen",
"indianred", "dodgerblue", "forestgreen")
p.log <- prcomp(t(published.log))
pdf("/Users/fridadanielsson/Documents/Projekt/Publika_dataset/manuscript/figures/manuscript_figures/2b.pdf")
plot(p.log$x[,1],p.log$x[,2],pch=20,col=colors,xlab=paste("PC1 31% of variance"),ylab=paste("PC2 27% of variance"),main="log2 Published FPKM/RPKM values \n n=13,323")
textxy(p.log$x[,1],p.log$x[,2])
legend("bottomright",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
dev.off()
pdf("/Users/fridadanielsson/Documents/Projekt/Publika_dataset/manuscript/figures/manuscript_figures/2c.pdf")
plot(p.log$x[,2],p.log$x[,3],pch=20,col=colors,xlab=paste("PC2 27% of variance"),ylab=paste("PC3 19% of variance"),main="log2 Published FPKM values \n n=13,323")
textxy(p.log$x[,2],p.log$x[,3])
legend("bottomright",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
dev.off()
pdf("/Users/fridadanielsson/Documents/Projekt/Publika_dataset/manuscript/figures/manuscript_figures/2b.pdf")
plot(p.log$x[,1],p.log$x[,2],pch=20,col=colors,xlab=paste("PC1 31% of variance"),ylab=paste("PC2 27% of variance"),main="log2 Published FPKM/RPKM values \n n=13,323")
legend("bottomright",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
dev.off()
pdf("/Users/fridadanielsson/Documents/Projekt/Publika_dataset/manuscript/figures/manuscript_figures/2c.pdf")
plot(p.log$x[,2],p.log$x[,3],pch=20,col=colors,xlab=paste("PC2 27% of variance"),ylab=paste("PC3 19% of variance"),main="log2 Published FPKM values \n n=13,323")
legend("bottomright",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
dev.off()
`
>
e
eee
efasdg
>
pdf("/Users/fridadanielsson/Documents/Projekt/Publika_dataset/manuscript/figures/manuscript_figures/2c.pdf")
plot(p.log$x[,2],p.log$x[,3],pch=20,col=colors,xlab=paste("PC2 27% of variance"),ylab=paste("PC3 19% of variance"),main="log2 Published FPKM values \n n=13,323")
legend("bottomright",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
dev.off()
cufflinks_fpkms <- cufflinks_pc_nozero[,3:16]
rownames(cufflinks_fpkms) <- cufflinks_pc_nozero[,1]
p.cufflinks <- prcomp(t(cufflinks_fpkms))
colors <- c("dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred")
pdf("/Users/fridadanielsson/Documents/Projekt/Publika_dataset/manuscript/figures/manuscript_figures/4b.pdf")
plot(p.cufflinks$x[,1],p.cufflinks$x[,2],pch=20,col=colors,xlab=paste("PC1 87% of variance"),ylab=paste("PC2 7.7% of variance"),main="Reprocessed FPKM values \n n=19,475")
legend("bottomright",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
dev.off()
pseudo <- 1
cufflinks_log <- log2(cufflinks_fpkms + pseudo)
pdf("/Users/fridadanielsson/Documents/Projekt/Publika_dataset/manuscript/figures/manuscript_figures/4d.pdf")
pheatmap(cor(cufflinks_log) ,method="spearman")
dev.off()
colors <- c("dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred")
p.log.cufflinks <- prcomp(t(cufflinks_log))
p.log.cufflinks <- prcomp(t(cufflinks_log))
pdf("/Users/fridadanielsson/Documents/Projekt/Publika_dataset/manuscript/figures/manuscript_figures/4e.pdf")
plot(p.log.cufflinks$x[,1],p.log.cufflinks$x[,2],pch=20,col=colors,xlab=paste("PC1 33% of variance"),ylab=paste("PC2 25% of variance"),main="log2 reprocessed cufflinks FPKM values \n n=19,475")
legend("bottomright",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
dev.off()
pdf("/Users/fridadanielsson/Documents/Projekt/Publika_dataset/manuscript/figures/manuscript_figures/4f.pdf")
plot(p.log.cufflinks$x[,2],p.log.cufflinks$x[,3],pch=20,col=colors,xlab=paste("PC2 25% of variance"),ylab=paste("PC3 22% of variance"),main="log2 reprocessed cufflinks FPKM values \n n=19,475")
legend("bottomright",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
dev.off()
pdf("/Users/fridadanielsson/Documents/Projekt/Publika_dataset/manuscript/figures/manuscript_figures/4d.pdf")
pheatmap(cor(cufflinks_log) ,method="spearman")
dev.off()
library(pheatmap)
library(reshape)
library(gplots)
library(ops)
library(calibrate)
library(biomaRt)
library(sva)
cufflinks <- read.delim("fpkm_table_tophat.txt")
sampleinfo_cufflinks <- read.delim("sample_info_reprocessed.txt")
gene_ids <- as.vector(cufflinks[,1])
ensembl = useMart("ensembl", dataset = "hsapiens_gene_ensembl") #select the ensembl database
gene_type <- getBM(attributes=c("ensembl_gene_id", "gene_biotype"),
filters = "ensembl_gene_id",
values=gene_ids,
mart=ensembl)
pc <- subset(gene_type[,1],gene_type[,2]=="protein_coding")
cufflinks_pc <- cufflinks[match(pc,cufflinks[,1]),]
cufflinks_pc_nozero <- cufflinks_pc[-which(rowSums(cufflinks_pc[,3:16])<=0.01),]
pdf("/Users/fridadanielsson/Documents/Projekt/Publika_dataset/manuscript/figures/manuscript_figures/4a.pdf")
pheatmap(cor(cufflinks_pc_nozero[,3:16], method="spearman"))
dev.off()
cufflinks_fpkms <- cufflinks_pc_nozero[,3:16]
rownames(cufflinks_fpkms) <- cufflinks_pc_nozero[,1]
p.cufflinks <- prcomp(t(cufflinks_fpkms))
colors <- c("dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred")
plot(p.cufflinks$x[,1],p.cufflinks$x[,2],pch=20,col=colors,xlab=paste("PC1 87% of variance"),ylab=paste("PC2 7.7% of variance"),main="Reprocessed FPKM values \n n=19,475")
legend("bottomright",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
pseudo <- 1
cufflinks_log <- log2(cufflinks_fpkms + pseudo)
pdf("/Users/fridadanielsson/Documents/Projekt/Publika_dataset/manuscript/figures/manuscript_figures/4d.pdf")
pheatmap(cor(cufflinks_log) ,method="spearman")
dev.off()
colors <- c("dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred")
p.log.cufflinks <- prcomp(t(cufflinks_log))
pdf("/Users/fridadanielsson/Documents/Projekt/Publika_dataset/manuscript/figures/manuscript_figures/4e.pdf")
plot(p.log.cufflinks$x[,1],p.log.cufflinks$x[,2],pch=20,col=colors,xlab=paste("PC1 33% of variance"),ylab=paste("PC2 25% of variance"),main="log2 reprocessed cufflinks FPKM values \n n=19,475")
legend("bottomright",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
dev.off()
pdf("/Users/fridadanielsson/Documents/Projekt/Publika_dataset/manuscript/figures/manuscript_figures/4f.pdf")
plot(p.log.cufflinks$x[,2],p.log.cufflinks$x[,3],pch=20,col=colors,xlab=paste("PC2 25% of variance"),ylab=paste("PC3 22% of variance"),main="log2 reprocessed cufflinks FPKM values \n n=19,475")
legend("bottomright",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
dev.off()
load.pc1 <- p.log.cufflinks$rotation[,1][order(p.log.cufflinks$rotation[,1])]
extreme.pc1 <- c(tail(load.pc1), head(load.pc1))
extreme.pc1.ensg <- names(extreme.pc1)
extreme.pc1.symbols <- getBM(attributes=c("ensembl_gene_id", "hgnc_symbol"),
filters = "ensembl_gene_id",
values=extreme.pc1.ensg,
mart=ensembl)
barplot(extreme.pc1, names.arg=extreme.pc1.symbols[,2], las=2, main="Genes w highest absolute loadings in PC1 (log2Cufflinks FPKM)")
cufflinks_values <- cufflinks_pc_nozero[,3:16]
rownames(cufflinks_values) <- cufflinks_pc_nozero[,1]
load.pc1 <- abs(p.log.cufflinks$rotation[,1])[order(abs(p.log.cufflinks$rotation[,1]),decreasing=TRUE)]
top.pc1 <- names(load.pc1[1:500])
pdf("/Users/fridadanielsson/Documents/Projekt/Publika_dataset/manuscript/figures/manuscript_figures/4g_1.pdf")
pheatmap(cor(cufflinks_values[top.pc1,]),method="spearman")
dev.off()
load.pc2 <- abs(p.log.cufflinks$rotation[,2])[order(abs(p.log.cufflinks$rotation[,2]),decreasing=TRUE)]
top.pc2 <- names(load.pc2[1:500])
pdf("/Users/fridadanielsson/Documents/Projekt/Publika_dataset/manuscript/figures/manuscript_figures/4g_2.pdf")
pheatmap(cor(cufflinks_values[top.pc2,]),method="spearman")
dev.off()
load.pc3 <- abs(p.log.cufflinks$rotation[,3])[order(abs(p.log.cufflinks$rotation[,3]),decreasing=TRUE)]
top.pc3 <- names(load.pc3[1:500])
pdf("/Users/fridadanielsson/Documents/Projekt/Publika_dataset/manuscript/figures/manuscript_figures/4g_3.pdf")
pheatmap(cor(cufflinks_values[top.pc3,]),method="spearman")
dev.off()
meta <- data.frame(study=c(rep("EoGE",3),rep("Atlas",3),rep("BodyMap",3),rep("HPA",3),rep("AltIso",2)),tissue=c("Brain","Heart","Kidney","Brain","Heart","Kidney","Brain","Heart","Kidney","Brain","Heart","Kidney","Brain","Heart"),prep=c(rep("poly-A",3),rep("rRNA-depl",3),rep("poly-A",8)),layout=c(rep("PE",3),rep("SE",3),rep("PE",6),rep("SE",2)))
batch <- meta$study
design <- model.matrix(~as.factor(tissue),data=meta)
combat.cufflinks <- ComBat(dat=cufflinks_log,batch=batch,mod=design,numCovs=NULL,par.prior=TRUE)
rownames(combat.cufflinks) <- rownames(cufflinks_log)
pdf("/Users/fridadanielsson/Documents/Projekt/Publika_dataset/manuscript/figures/manuscript_figures/4h.pdf")
pheatmap(cor(combat.cufflinks),method="spearman")
dev.off()
p.combat.cufflinks <- prcomp(t(combat.cufflinks))
pdf("/Users/fridadanielsson/Documents/Projekt/Publika_dataset/manuscript/figures/manuscript_figures/4i.pdf")
plot(p.combat.cufflinks$x[,1],p.combat.cufflinks$x[,2],pch=20,col=colors,xlab=paste("PC1 54% of variance"),ylab=paste("PC2 37% of variance"),main="Cufflinks FPKM values \n COMBAT \n n=19,475")
legend("bottomright",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
dev.off()
