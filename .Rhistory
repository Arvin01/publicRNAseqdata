maxval = 100
barplot(100*d$"Sum Sq"[1:5]/sum(d$"Sum Sq"[1:5]),names.arg=rownames(d[1:5,]),main="Anova, Cufflinks FPKM",ylim=c(0,maxval))
pseudo <- 1
cufflinks_log <- log2(cufflinks_fpkms + pseudo)
pheatmap(cor(cufflinks_log) ,method="spearman")
colors <- c("dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred")
p.log.cufflinks <- prcomp(t(cufflinks_log))
summary(p.log.cufflinks)
pdf("/Users/fridadanielsson/Documents/Projekt/Publika_dataset/manuscript/figures/manuscript_figures/4d.pdf")
plot(p.log.cufflinks$x[,1],p.log.cufflinks$x[,2],pch=20,col=colors,xlab=paste("PC1 33% of variance"),ylab=paste("PC2 25% of variance"),main="log2 reprocessed cufflinks FPKM values \n n=19,475")
legend("bottomright",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
dev.off()
pdf("/Users/fridadanielsson/Documents/Projekt/Publika_dataset/manuscript/figures/manuscript_figures/4e.pdf")
plot(p.log.cufflinks$x[,2],p.log.cufflinks$x[,3],pch=20,col=colors,xlab=paste("PC2 25% of variance"),ylab=paste("PC3 22% of variance"),main="log2 reprocessed cufflinks FPKM values \n n=19,475")
legend("bottomright",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
dev.off()
meta <- data.frame(study=c(rep("EoGE",3),rep("Atlas",3),rep("BodyMap",3),rep("HPA",3),rep("AltIso",2)),tissue=c("Brain","Heart","Kidney","Brain","Heart","Kidney","Brain","Heart","Kidney","Brain","Heart","Kidney","Brain","Heart"),prep=c(rep("poly-A",3),rep("rRNA-depl",3),rep("poly-A",8)),layout=c(rep("PE",3),rep("SE",3),rep("PE",6),rep("SE",2)))
batch <- meta$study
design <- model.matrix(~as.factor(tissue),data=meta)
combat.cufflinks <- ComBat(dat=cufflinks_log,batch=batch,mod=design,numCovs=NULL,par.prior=TRUE)
rownames(combat.cufflinks) <- rownames(cufflinks_log)
write.table(combat, file="reprocessed_rpkms_combat_log2.txt", quote=F)
pheatmap(cor(combat.cufflinks),method="spearman")
p.combat.cufflinks <- prcomp(t(combat.cufflinks))
summary(p.combat.cufflinks)
pdf("/Users/fridadanielsson/Documents/Projekt/Publika_dataset/manuscript/figures/manuscript_figures/4h.pdf")
plot(p.combat.cufflinks$x[,1],p.combat.cufflinks$x[,2],pch=20,col=colors,xlab=paste("PC1 54% of variance"),ylab=paste("PC2 37% of variance"),main="Cufflinks FPKM values \n COMBAT \n n=19,475")
legend("bottomright",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
dev.off()
pdf("/Users/fridadanielsson/Documents/Projekt/Publika_dataset/manuscript/figures/manuscript_figures/4i.pdf")
plot(p.combat.cufflinks$x[,2],p.combat.cufflinks$x[,3],pch=20,col=colors,xlab=paste("PC2 37% of variance"),ylab=paste("PC3 2% of variance"),main="Cufflinks FPKM values \n COMBAT \n n=19,475")
legend("bottomright",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
dev.off()
published <- read.delim("published_rpkms.txt",sep=" ")
sampleinfo_published <- read.table("sample_info_published.txt",header=TRUE)
published.nozero <- published[-which(rowSums(published[,])<=0.01),]
pseudo <- 1
published.log <- log2(published.nozero + pseudo)
colors <- c("indianred", "dodgerblue", "forestgreen",
"indianred", "dodgerblue",
"indianred", "dodgerblue", "forestgreen",
"indianred", "dodgerblue", "forestgreen")
p.log <- prcomp(t(published.log))
pdf("/Users/fridadanielsson/Documents/Projekt/Publika_dataset/manuscript/figures/manuscript_figures/2b.pdf")
plot(p.log$x[,1],p.log$x[,2],pch=20,col=colors,xlab=paste("PC1 31% of variance"),ylab=paste("PC2 27% of variance"),main="log2 Published FPKM/RPKM values \n n=13,323")
textxy(p.log$x[,1],p.log$x[,2])
legend("bottomright",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
dev.off()
pdf("/Users/fridadanielsson/Documents/Projekt/Publika_dataset/manuscript/figures/manuscript_figures/2c.pdf")
plot(p.log$x[,2],p.log$x[,3],pch=20,col=colors,xlab=paste("PC2 27% of variance"),ylab=paste("PC3 19% of variance"),main="log2 Published FPKM values \n n=13,323")
textxy(p.log$x[,2],p.log$x[,3])
legend("bottomright",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
dev.off()
pdf("/Users/fridadanielsson/Documents/Projekt/Publika_dataset/manuscript/figures/manuscript_figures/2b.pdf")
plot(p.log$x[,1],p.log$x[,2],pch=20,col=colors,xlab=paste("PC1 31% of variance"),ylab=paste("PC2 27% of variance"),main="log2 Published FPKM/RPKM values \n n=13,323")
legend("bottomright",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
dev.off()
pdf("/Users/fridadanielsson/Documents/Projekt/Publika_dataset/manuscript/figures/manuscript_figures/2c.pdf")
plot(p.log$x[,2],p.log$x[,3],pch=20,col=colors,xlab=paste("PC2 27% of variance"),ylab=paste("PC3 19% of variance"),main="log2 Published FPKM values \n n=13,323")
legend("bottomright",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
dev.off()
`
>
e
eee
efasdg
>
pdf("/Users/fridadanielsson/Documents/Projekt/Publika_dataset/manuscript/figures/manuscript_figures/2c.pdf")
plot(p.log$x[,2],p.log$x[,3],pch=20,col=colors,xlab=paste("PC2 27% of variance"),ylab=paste("PC3 19% of variance"),main="log2 Published FPKM values \n n=13,323")
legend("bottomright",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
dev.off()
cufflinks_fpkms <- cufflinks_pc_nozero[,3:16]
rownames(cufflinks_fpkms) <- cufflinks_pc_nozero[,1]
p.cufflinks <- prcomp(t(cufflinks_fpkms))
colors <- c("dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred")
pdf("/Users/fridadanielsson/Documents/Projekt/Publika_dataset/manuscript/figures/manuscript_figures/4b.pdf")
plot(p.cufflinks$x[,1],p.cufflinks$x[,2],pch=20,col=colors,xlab=paste("PC1 87% of variance"),ylab=paste("PC2 7.7% of variance"),main="Reprocessed FPKM values \n n=19,475")
legend("bottomright",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
dev.off()
pseudo <- 1
cufflinks_log <- log2(cufflinks_fpkms + pseudo)
pdf("/Users/fridadanielsson/Documents/Projekt/Publika_dataset/manuscript/figures/manuscript_figures/4d.pdf")
pheatmap(cor(cufflinks_log) ,method="spearman")
dev.off()
colors <- c("dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred")
p.log.cufflinks <- prcomp(t(cufflinks_log))
p.log.cufflinks <- prcomp(t(cufflinks_log))
pdf("/Users/fridadanielsson/Documents/Projekt/Publika_dataset/manuscript/figures/manuscript_figures/4e.pdf")
plot(p.log.cufflinks$x[,1],p.log.cufflinks$x[,2],pch=20,col=colors,xlab=paste("PC1 33% of variance"),ylab=paste("PC2 25% of variance"),main="log2 reprocessed cufflinks FPKM values \n n=19,475")
legend("bottomright",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
dev.off()
pdf("/Users/fridadanielsson/Documents/Projekt/Publika_dataset/manuscript/figures/manuscript_figures/4f.pdf")
plot(p.log.cufflinks$x[,2],p.log.cufflinks$x[,3],pch=20,col=colors,xlab=paste("PC2 25% of variance"),ylab=paste("PC3 22% of variance"),main="log2 reprocessed cufflinks FPKM values \n n=19,475")
legend("bottomright",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
dev.off()
pdf("/Users/fridadanielsson/Documents/Projekt/Publika_dataset/manuscript/figures/manuscript_figures/4d.pdf")
pheatmap(cor(cufflinks_log) ,method="spearman")
dev.off()
library(pheatmap)
library(reshape)
library(gplots)
library(ops)
library(calibrate)
library(biomaRt)
library(sva)
cufflinks <- read.delim("fpkm_table_tophat.txt")
sampleinfo_cufflinks <- read.delim("sample_info_reprocessed.txt")
gene_ids <- as.vector(cufflinks[,1])
ensembl = useMart("ensembl", dataset = "hsapiens_gene_ensembl") #select the ensembl database
gene_type <- getBM(attributes=c("ensembl_gene_id", "gene_biotype"),
filters = "ensembl_gene_id",
values=gene_ids,
mart=ensembl)
pc <- subset(gene_type[,1],gene_type[,2]=="protein_coding")
cufflinks_pc <- cufflinks[match(pc,cufflinks[,1]),]
cufflinks_pc_nozero <- cufflinks_pc[-which(rowSums(cufflinks_pc[,3:16])<=0.01),]
pdf("/Users/fridadanielsson/Documents/Projekt/Publika_dataset/manuscript/figures/manuscript_figures/4a.pdf")
pheatmap(cor(cufflinks_pc_nozero[,3:16], method="spearman"))
dev.off()
cufflinks_fpkms <- cufflinks_pc_nozero[,3:16]
rownames(cufflinks_fpkms) <- cufflinks_pc_nozero[,1]
p.cufflinks <- prcomp(t(cufflinks_fpkms))
colors <- c("dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred")
plot(p.cufflinks$x[,1],p.cufflinks$x[,2],pch=20,col=colors,xlab=paste("PC1 87% of variance"),ylab=paste("PC2 7.7% of variance"),main="Reprocessed FPKM values \n n=19,475")
legend("bottomright",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
pseudo <- 1
cufflinks_log <- log2(cufflinks_fpkms + pseudo)
pdf("/Users/fridadanielsson/Documents/Projekt/Publika_dataset/manuscript/figures/manuscript_figures/4d.pdf")
pheatmap(cor(cufflinks_log) ,method="spearman")
dev.off()
colors <- c("dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred")
p.log.cufflinks <- prcomp(t(cufflinks_log))
pdf("/Users/fridadanielsson/Documents/Projekt/Publika_dataset/manuscript/figures/manuscript_figures/4e.pdf")
plot(p.log.cufflinks$x[,1],p.log.cufflinks$x[,2],pch=20,col=colors,xlab=paste("PC1 33% of variance"),ylab=paste("PC2 25% of variance"),main="log2 reprocessed cufflinks FPKM values \n n=19,475")
legend("bottomright",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
dev.off()
pdf("/Users/fridadanielsson/Documents/Projekt/Publika_dataset/manuscript/figures/manuscript_figures/4f.pdf")
plot(p.log.cufflinks$x[,2],p.log.cufflinks$x[,3],pch=20,col=colors,xlab=paste("PC2 25% of variance"),ylab=paste("PC3 22% of variance"),main="log2 reprocessed cufflinks FPKM values \n n=19,475")
legend("bottomright",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
dev.off()
load.pc1 <- p.log.cufflinks$rotation[,1][order(p.log.cufflinks$rotation[,1])]
extreme.pc1 <- c(tail(load.pc1), head(load.pc1))
extreme.pc1.ensg <- names(extreme.pc1)
extreme.pc1.symbols <- getBM(attributes=c("ensembl_gene_id", "hgnc_symbol"),
filters = "ensembl_gene_id",
values=extreme.pc1.ensg,
mart=ensembl)
barplot(extreme.pc1, names.arg=extreme.pc1.symbols[,2], las=2, main="Genes w highest absolute loadings in PC1 (log2Cufflinks FPKM)")
cufflinks_values <- cufflinks_pc_nozero[,3:16]
rownames(cufflinks_values) <- cufflinks_pc_nozero[,1]
load.pc1 <- abs(p.log.cufflinks$rotation[,1])[order(abs(p.log.cufflinks$rotation[,1]),decreasing=TRUE)]
top.pc1 <- names(load.pc1[1:500])
pdf("/Users/fridadanielsson/Documents/Projekt/Publika_dataset/manuscript/figures/manuscript_figures/4g_1.pdf")
pheatmap(cor(cufflinks_values[top.pc1,]),method="spearman")
dev.off()
load.pc2 <- abs(p.log.cufflinks$rotation[,2])[order(abs(p.log.cufflinks$rotation[,2]),decreasing=TRUE)]
top.pc2 <- names(load.pc2[1:500])
pdf("/Users/fridadanielsson/Documents/Projekt/Publika_dataset/manuscript/figures/manuscript_figures/4g_2.pdf")
pheatmap(cor(cufflinks_values[top.pc2,]),method="spearman")
dev.off()
load.pc3 <- abs(p.log.cufflinks$rotation[,3])[order(abs(p.log.cufflinks$rotation[,3]),decreasing=TRUE)]
top.pc3 <- names(load.pc3[1:500])
pdf("/Users/fridadanielsson/Documents/Projekt/Publika_dataset/manuscript/figures/manuscript_figures/4g_3.pdf")
pheatmap(cor(cufflinks_values[top.pc3,]),method="spearman")
dev.off()
meta <- data.frame(study=c(rep("EoGE",3),rep("Atlas",3),rep("BodyMap",3),rep("HPA",3),rep("AltIso",2)),tissue=c("Brain","Heart","Kidney","Brain","Heart","Kidney","Brain","Heart","Kidney","Brain","Heart","Kidney","Brain","Heart"),prep=c(rep("poly-A",3),rep("rRNA-depl",3),rep("poly-A",8)),layout=c(rep("PE",3),rep("SE",3),rep("PE",6),rep("SE",2)))
batch <- meta$study
design <- model.matrix(~as.factor(tissue),data=meta)
combat.cufflinks <- ComBat(dat=cufflinks_log,batch=batch,mod=design,numCovs=NULL,par.prior=TRUE)
rownames(combat.cufflinks) <- rownames(cufflinks_log)
pdf("/Users/fridadanielsson/Documents/Projekt/Publika_dataset/manuscript/figures/manuscript_figures/4h.pdf")
pheatmap(cor(combat.cufflinks),method="spearman")
dev.off()
p.combat.cufflinks <- prcomp(t(combat.cufflinks))
pdf("/Users/fridadanielsson/Documents/Projekt/Publika_dataset/manuscript/figures/manuscript_figures/4i.pdf")
plot(p.combat.cufflinks$x[,1],p.combat.cufflinks$x[,2],pch=20,col=colors,xlab=paste("PC1 54% of variance"),ylab=paste("PC2 37% of variance"),main="Cufflinks FPKM values \n COMBAT \n n=19,475")
legend("bottomright",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
dev.off()
install.packages("knitr")
library(pheatmap)
library(reshape)
library(gplots)
library(ops)
library(calibrate)
library(biomaRt)
library(sva)
published <- read.delim("published_rpkms.txt",sep=" ")
sampleinfo_published <- read.table("sample_info_published.txt",header=TRUE)
published.nozero <- published[-which(rowSums(published[,])<=0.01),]
colors <- c("indianred", "dodgerblue", "forestgreen",
"indianred", "dodgerblue",
"indianred", "dodgerblue", "forestgreen",
"indianred", "dodgerblue", "forestgreen")
p <- prcomp(t(published.nozero))
rownames(p$x) <- c(rep("HPA",3),rep("AltIso",2),rep("GTEx",3),rep("Atlas",3))
plot(p$x[,1],p$x[,2],pch=20,cex=1.5,col=colors,xlab=paste("PC1 58% of variance"),ylab=paste("PC2 13% of variance"),main="Published FPKM/RPKM values \n n=13,323")
legend("bottomright",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
load.pc1 <- p$rotation[,1][order(p$rotation[,1])]
extreme.pc1 <- c(tail(load.pc1), head(load.pc1))
extreme.pc1.ensg <- names(extreme.pc1)
ensembl = useMart("ensembl", dataset = "hsapiens_gene_ensembl") #select the ensembl database
extreme.pc1.symbols <- getBM(attributes=c("ensembl_gene_id", "hgnc_symbol"),
filters = "ensembl_gene_id",
values=extreme.pc1.ensg,
mart=ensembl)
barplot(extreme.pc1, names.arg=extreme.pc1.symbols[,2], las=2, main="Genes w highest absolute loadings in PC1 (raw RPKM)")
cufflinks <- read.delim("fpkm_table_tophat.txt")
sampleinfo_cufflinks <- read.delim("sample_info_reprocessed.txt")
gene_ids <- as.vector(cufflinks[,1])
ensembl = useMart("ensembl", dataset = "hsapiens_gene_ensembl") #select the ensembl database
gene_type <- getBM(attributes=c("ensembl_gene_id", "gene_biotype"),
filters = "ensembl_gene_id",
values=gene_ids,
mart=ensembl)
pc <- subset(gene_type[,1],gene_type[,2]=="protein_coding")
cufflinks_fpkms <- cufflinks_pc_nozero[,3:16]
rownames(cufflinks_fpkms) <- cufflinks_pc_nozero[,1]
cufflinks <- read.delim("fpkm_table_tophat.txt")
sampleinfo_cufflinks <- read.delim("sample_info_reprocessed.txt")
gene_ids <- as.vector(cufflinks[,1])
ensembl = useMart("ensembl", dataset = "hsapiens_gene_ensembl") #select the ensembl database
gene_type <- getBM(attributes=c("ensembl_gene_id", "gene_biotype"),
filters = "ensembl_gene_id",
values=gene_ids,
mart=ensembl)
pc <- subset(gene_type[,1],gene_type[,2]=="protein_coding")
cufflinks_pc <- cufflinks[match(pc,cufflinks[,1]),]
cufflinks_pc_nozero <- cufflinks_pc[-which(rowSums(cufflinks_pc[,3:16])<=0.01),]
pheatmap(cor(cufflinks_pc_nozero[,3:16], method="spearman"))
cufflinks_fpkms <- cufflinks_pc_nozero[,3:16]
rownames(cufflinks_fpkms) <- cufflinks_pc_nozero[,1]
p.cufflinks <- prcomp(t(cufflinks_fpkms))
colors <- c("dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred")
plot(p.cufflinks$x[,1],p.cufflinks$x[,2],pch=20,col=colors,xlab=paste("PC1 87% of variance"),ylab=paste("PC2 7.7% of variance"),main="Reprocessed FPKM values \n n=19,475")
legend("bottomright",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
load.pc1 <- p.cufflinks$rotation[,1][order(p.cufflinks$rotation[,1])]
head(p.cufflinks)
head(load.pc1)
extreme.pc1 <- c(tail(load.pc1), head(load.pc1))
extreme.pc1.ensg <- names(extreme.pc1)
head(extreme.pc1.ensg)
extreme.pc1.symbols <- getBM(attributes=c("ensembl_gene_id", "hgnc_symbol"),
filters = "ensembl_gene_id",
values=extreme.pc1.ensg,
mart=ensembl)
head(extreme.pc1.symbols)
q <- extreme.pc1.symbols[,2]
names(q) <- extreme.pc1.symbols[,1]
q
load.pc1 <- p.cufflinks$rotation[,1][order(p.cufflinks$rotation[,1])]
extreme.pc1 <- c(tail(load.pc1), head(load.pc1))
extreme.pc1.ensg <- names(extreme.pc1)
extreme.pc1.symbols <- getBM(attributes=c("ensembl_gene_id", "hgnc_symbol"),
filters = "ensembl_gene_id",
values=extreme.pc1.ensg,
mart=ensembl)
q <- extreme.pc1.symbols[,2]
names(q) <- extreme.pc1.symbols[,1]
barplot(extreme.pc1, names.arg=q[extreme.pc1.ensg],las=2,main="Genes w highest absolute loadings in PC1 (raw Cufflinks    FPKM)")
load.pc2 <- p.cufflinks$rotation[,2][order(p.cufflinks$rotation[,2])]
extreme.pc2 <- c(tail(load.pc2), head(load.pc2))
extreme.pc2.ensg <- names(extreme.pc2)
extreme.pc2.symbols <- getBM(attributes=c("ensembl_gene_id", "hgnc_symbol"),
filters = "ensembl_gene_id",
values=extreme.pc2.ensg,
mart=ensembl)
q <- extreme.pc2.symbols[,2]
names(q) <- extreme.pc2.symbols[,1]
barplot(extreme.pc2, names.arg=q[extreme.pc2.ensg],las=2,main="Genes w highest absolute loadings in PC2 (raw Cufflinks    FPKM)")
load.pc3 <- p.cufflinks$rotation[,3][order(p.cufflinks$rotation[,3])]
extreme.pc3 <- c(tail(load.pc3), head(load.pc3))
extreme.pc3.ensg <- names(extreme.pc3)
extreme.pc3.symbols <- getBM(attributes=c("ensembl_gene_id", "hgnc_symbol"),
filters = "ensembl_gene_id",
values=extreme.pc3.ensg,
mart=ensembl)
q <- extreme.pc3.symbols[,2]
q
names(q) <- extreme.pc3.symbols[,1]
barplot(extreme.pc3, names.arg=q[extreme.pc3.ensg],las=2,main="Genes w highest absolute loadings in PC3 (raw Cufflinks    FPKM)")
load.pc1 <- p.log.cufflinks$rotation[,1][order(p.log.cufflinks$rotation[,1])]
extreme.pc1 <- c(tail(load.pc1), head(load.pc1))
extreme.pc1.ensg <- names(extreme.pc1)
extreme.pc1.symbols <- getBM(attributes=c("ensembl_gene_id", "hgnc_symbol"),
filters = "ensembl_gene_id",
values=extreme.pc1.ensg,
mart=ensembl)
colors <- c("dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred")
p.log.cufflinks <- prcomp(t(cufflinks_log))
pseudo <- 1
cufflinks_log <- log2(cufflinks_fpkms + pseudo)
p.log.cufflinks <- prcomp(t(cufflinks_log))
load.pc1 <- p.log.cufflinks$rotation[,1][order(p.log.cufflinks$rotation[,1])]
extreme.pc1 <- c(tail(load.pc1), head(load.pc1))
extreme.pc1.ensg <- names(extreme.pc1)
extreme.pc1.symbols <- getBM(attributes=c("ensembl_gene_id", "hgnc_symbol"),
filters = "ensembl_gene_id",
values=extreme.pc1.ensg,
mart=ensembl)
q <- extreme.pc1.symbols[,2]
names(q) <- extreme.pc1.symbols[,1]
extreme.pc1
extreme.pc1.symbols
barplot(extreme.pc1, names.arg=q[extreme.pc1.ensg],las=2,main="Genes w highest absolute loadings in PC1 (raw Cufflinks    FPKM)")
load.pc2 <- p.log.cufflinks$rotation[,2][order(p.log.cufflinks$rotation[,2])]
extreme.pc2 <- c(tail(load.pc2), head(load.pc2))
extreme.pc2.ensg <- names(extreme.pc2)
extreme.pc2.symbols <- getBM(attributes=c("ensembl_gene_id", "hgnc_symbol"),
filters = "ensembl_gene_id",
values=extreme.pc2.ensg,
mart=ensembl)
q <- extreme.pc2.symbols[,2]
names(q) <- extreme.pc2.symbols[,1]
barplot(extreme.pc2, names.arg=q[extreme.pc2.ensg],las=2,main="Genes w highest absolute loadings in PC2 (log2 Cufflinks    FPKM)")
load.pc3 <- p.log.cufflinks$rotation[,3][order(p.log.cufflinks$rotation[,3])]
extreme.pc3 <- c(tail(load.pc3), head(load.pc3))
extreme.pc3.ensg <- names(extreme.pc3)
extreme.pc3.symbols <- getBM(attributes=c("ensembl_gene_id", "hgnc_symbol"),
filters = "ensembl_gene_id",
values=extreme.pc3.ensg,
mart=ensembl)
load.pc3 <- p.log.cufflinks$rotation[,3][order(p.log.cufflinks$rotation[,3])]
extreme.pc3 <- c(tail(load.pc3), head(load.pc3))
extreme.pc3.ensg <- names(extreme.pc3)
extreme.pc3.symbols <- getBM(attributes=c("ensembl_gene_id", "hgnc_symbol"),
filters = "ensembl_gene_id",
values=extreme.pc3.ensg,
mart=ensembl)
q <- extreme.pc3.symbols[,2]
names(q) <- extreme.pc3.symbols[,1]
barplot(extreme.pc3, names.arg=q[extreme.pc3.ensg],las=2,main="Genes w highest absolute loadings in PC3 (log2 Cufflinks    FPKM)")
meta <- data.frame(study=c(rep("EoGE",3),rep("Atlas",3),rep("BodyMap",3),rep("HPA",3),rep("AltIso",2)),tissue=c("Brain","Heart","Kidney","Brain","Heart","Kidney","Brain","Heart","Kidney","Brain","Heart","Kidney","Brain","Heart"),prep=c(rep("poly-A",3),rep("rRNA-depl",3),rep("poly-A",8)),layout=c(rep("PE",3),rep("SE",3),rep("PE",6),rep("SE",2)))
batch <- meta$study
design <- model.matrix(~as.factor(tissue),data=meta)
combat.cufflinks <- ComBat(dat=cufflinks_log,batch=batch,mod=design,numCovs=NULL,par.prior=TRUE)
rownames(combat.cufflinks) <- rownames(cufflinks_log)
pheatmap(cor(combat.cufflinks),method="spearman")
p.combat.cufflinks <- prcomp(t(combat.cufflinks))
plot(p.combat.cufflinks$x[,1],p.combat.cufflinks$x[,2],pch=20,col=colors,xlab=paste("PC1 54% of variance"),ylab=paste("PC2 37% of variance"),main="Cufflinks FPKM values \n COMBAT \n n=19,475")
legend("bottomright",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
legend("bottomleft",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
plot(p.combat.cufflinks$x[,2],p.combat.cufflinks$x[,3],pch=20,col=colors,xlab=paste("PC2 37% of variance"),ylab=paste("PC3 2% of variance"),main="Cufflinks FPKM values \n COMBAT \n n=19,475")
legend("bottomright",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
load.pc1 <- p.combat.cufflinks$rotation[,1][order(p.combat.cufflinks$rotation[,1])]
extreme.pc1 <- c(tail(load.pc1), head(load.pc1))
extreme.pc1.ensg <- names(extreme.pc1)
extreme.pc1.symbols <- getBM(attributes=c("ensembl_gene_id", "hgnc_symbol"),
filters = "ensembl_gene_id",
values=extreme.pc1.ensg,
mart=ensembl)
q <- extreme.pc1.symbols[,2]
names(q) <- extreme.pc1.symbols[,1]
barplot(extreme.pc1, names.arg=q[extreme.pc1.ensg],las=2,main="Genes w highest absolute loadings in PC1 (COMBAT Cufflinks    FPKM)")
q <- extreme.pc2.symbols[,2]
names(q) <- extreme.pc2.symbols[,1]
barplot(extreme.pc2, names.arg=q[extreme.pc2.ensg],las=2,main="Genes w highest absolute loadings in PC2 (COMBAT Cufflinks    FPKM)")
load.pc3 <- p.combat.cufflinks$rotation[,3][order(p.combat.cufflinks$rotation[,3])]
extreme.pc3 <- c(tail(load.pc3), head(load.pc3))
extreme.pc3.ensg <- names(extreme.pc3)
extreme.pc3.symbols <- getBM(attributes=c("ensembl_gene_id", "hgnc_symbol"),
filters = "ensembl_gene_id",
values=extreme.pc3.ensg,
mart=ensembl)
q <- extreme.pc3.symbols[,2]
names(q) <- extreme.pc3.symbols[,1]
barplot(extreme.pc3, names.arg=q[extreme.pc3.ensg],las=2,main="Genes w highest absolute loadings in PC3 (COMBAT Cufflinks    FPKM)")
load.pc1 <- p$rotation[,1][order(p$rotation[,1])]
extreme.pc1 <- c(tail(load.pc1), head(load.pc1))
extreme.pc1.ensg <- names(extreme.pc1)
ensembl = useMart("ensembl", dataset = "hsapiens_gene_ensembl") #select the ensembl database
extreme.pc1.symbols <- getBM(attributes=c("ensembl_gene_id", "hgnc_symbol"),
filters = "ensembl_gene_id",
values=extreme.pc1.ensg,
mart=ensembl)
barplot(extreme.pc1, names.arg=extreme.pc1.symbols[,2], las=2, main="Genes w highest absolute loadings in PC1 (raw RPKM)")
load.pc2 <- p$rotation[,2][order(p$rotation[,2])]
extreme.pc2 <- c(tail(load.pc2), head(load.pc2))
extreme.pc2.ensg <- names(extreme.pc2)
extreme.pc2.symbols <- getBM(attributes=c("ensembl_gene_id", "hgnc_symbol"),
filters = "ensembl_gene_id",
values=extreme.pc2.ensg,
mart=ensembl)
load.pc3 <- p$rotation[,3][order(p$rotation[,3])]
extreme.pc3 <- c(tail(load.pc3), head(load.pc3))
extreme.pc3.ensg <- names(extreme.pc3)
extreme.pc3.symbols <- getBM(attributes=c("ensembl_gene_id", "hgnc_symbol"),
filters = "ensembl_gene_id",
values=extreme.pc3.ensg,
mart=ensembl)
q <- extreme.pc3.symbols[,2]
names(q) <- extreme.pc3.symbols[,1]
barplot(extreme.pc3, names.arg=q[extreme.pc3.ensg],las=2,main="Genes w highest absolute loadings in PC3 (raw RPKM)")
pseudo <- 1
published.log <- log2(published.nozero + pseudo)
p.log <- prcomp(t(published.log))
plot(p.log$x[,1],p.log$x[,2],pch=20,col=colors,xlab=paste("PC1 31% of variance"),ylab=paste("PC2 27% of variance"),main="log2 Published FPKM/RPKM values \n n=13,323")
legend("bottomright",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
plot(p.log$x[,2],p.log$x[,3],pch=20,col=colors,xlab=paste("PC2 27% of variance"),ylab=paste("PC3 19% of variance"),main="log2 Published FPKM values \n n=13,323")
legend("bottomright",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
load.pc1 <- p.log$rotation[,1][order(p.log$rotation[,1])]
extreme.pc1 <- c(tail(load.pc1), head(load.pc1))
extreme.pc1.ensg <- names(extreme.pc1)
extreme.pc1.symbols <- getBM(attributes=c("ensembl_gene_id", "hgnc_symbol"),
filters = "ensembl_gene_id",
values=extreme.pc1.ensg,
mart=ensembl)
load.pc1 <- p.log$rotation[,1][order(p.log$rotation[,1])]
extreme.pc1 <- c(tail(load.pc1), head(load.pc1))
extreme.pc1.ensg <- names(extreme.pc1)
extreme.pc1.symbols <- getBM(attributes=c("ensembl_gene_id", "hgnc_symbol"),
filters = "ensembl_gene_id",
values=extreme.pc1.ensg,
mart=ensembl)
q <- extreme.pc1.symbols[,2]
names(q) <- extreme.pc1.symbols[,1]
barplot(extreme.pc1, names.arg=q[extreme.pc1.ensg],las=2,main="Genes w highest absolute loadings in PC1 (log2 RPKM)")
q <- extreme.pc1.symbols[,2]
names(q) <- extreme.pc1.symbols[,1]
barplot(extreme.pc1, names.arg=q[extreme.pc1.ensg],las=2,main="Genes w highest absolute loadings in PC1 (log2 RPKM)")
load.pc2 <- p.log$rotation[,2][order(p.log$rotation[,2])]
extreme.pc2 <- c(tail(load.pc2), head(load.pc2))
extreme.pc2.ensg <- names(extreme.pc2)
extreme.pc2.symbols <- getBM(attributes=c("ensembl_gene_id", "hgnc_symbol"),
filters = "ensembl_gene_id",
values=extreme.pc2.ensg,
mart=ensembl)
q <- extreme.pc2.symbols[,2]
names(q) <- extreme.pc2.symbols[,1]
barplot(extreme.pc2, names.arg=q[extreme.pc2.ensg],las=2,main="Genes w highest absolute loadings in PC2 (log2 RPKM)")
load.pc3 <- p.log$rotation[,3][order(p$rotation[,3])]
extreme.pc3 <- c(tail(load.pc3), head(load.pc3))
extreme.pc3.ensg <- names(extreme.pc3)
extreme.pc3.symbols <- getBM(attributes=c("ensembl_gene_id", "hgnc_symbol"),
filters = "ensembl_gene_id",
values=extreme.pc3.ensg,
mart=ensembl)
load.pc3 <- p.log$rotation[,3][order(p$rotation[,3])]
extreme.pc3 <- c(tail(load.pc3), head(load.pc3))
extreme.pc3.ensg <- names(extreme.pc3)
extreme.pc3.symbols <- getBM(attributes=c("ensembl_gene_id", "hgnc_symbol"),
filters = "ensembl_gene_id",
values=extreme.pc3.ensg,
mart=ensembl)
q <- extreme.pc3.symbols[,2]
names(q) <- extreme.pc3.symbols[,1]
barplot(extreme.pc3, names.arg=q[extreme.pc3.ensg],las=2,main="Genes w highest absolute loadings in PC3 (log2 RPKM)")
load.pc3 <- p.log$rotation[,3][order(p$rotation[,3])]
extreme.pc3 <- c(tail(load.pc3), head(load.pc3))
extreme.pc3
load.pc2 <- p.combat$rotation[,2][order(p.combat$rotation[,2])]
extreme.pc2 <- c(tail(load.pc2), head(load.pc2))
extreme.pc2.ensg <- names(extreme.pc2)
extreme.pc2.symbols <- getBM(attributes=c("ensembl_gene_id", "hgnc_symbol"),
library(pheatmap)
library(reshape)
library(gplots)
library(ops)
library(calibrate)
library(biomaRt)
library(sva)
published <- read.delim("published_rpkms.txt",sep=" ")
sampleinfo_published <- read.table("sample_info_published.txt",header=TRUE)
published.nozero <- published[-which(rowSums(published[,])<=0.01),]
e
pheatmap(cor(published.nozero, method="spearman"))
meta <- data.frame(study=c(rep("HPA",3),rep("AltIso",2),rep("GTex",3),rep("Atlas",3)),tissue=c("Heart","Brain","Kidney","Heart","Brain","Heart","Brain","Kidney","Heart","Brain","Kidney"))
batch <- meta$study
design <- model.matrix(~1,data=meta)
design
combat <- ComBat(dat=published.log,batch=batch,mod=design,numCovs=NULL,par.prior=TRUE)
pseudo <- 1
published.log <- log2(published.nozero + pseudo)
meta <- data.frame(study=c(rep("HPA",3),rep("AltIso",2),rep("GTex",3),rep("Atlas",3)),tissue=c("Heart","Brain","Kidney","Heart","Brain","Heart","Brain","Kidney","Heart","Brain","Kidney"))
batch <- meta$study
design <- model.matrix(~1,data=meta)
combat <- ComBat(dat=published.log,batch=batch,mod=design,numCovs=NULL,par.prior=TRUE)
pheatmap(cor(combat, method="spearman"))
colors <- c("indianred", "dodgerblue", "forestgreen",
"indianred", "dodgerblue",
"indianred", "dodgerblue", "forestgreen",
"indianred", "dodgerblue", "forestgreen")
p.combat <- prcomp(t(combat))
plot(p.combat$x[,1],p.combat$x[,2],pch=20,col=colors,xlab=paste("PC1 54% of variance"),ylab=paste("PC2 38% of variance"),main="Published FPKM values \n COMBAT \n n=13,323")
legend("bottomright",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
