extreme.pc1 <- c(tail(load.pc1), head(load.pc1))
extreme.pc1.ensg <- names(extreme.pc1)
extreme.pc1.symbols <- getBM(attributes=c("ensembl_gene_id", "hgnc_symbol"),
filters = "ensembl_gene_id",
values=extreme.pc1.ensg,
mart=ensembl)
q <- extreme.pc1.symbols[,2]
names(q) <- extreme.pc1.symbols[,1]
fpkm.combat.pc1 <- cbind(q[extreme.pc1.ensg],published.nozero[extreme.pc1.ensg,])
names(fpkm.combat.pc1)[names(fpkm.combat.pc1) == 'q[extreme.pc1.ensg]'] <- 'Gene Symbol'
q <- extreme.pc1.symbols[,2]
names(q) <- extreme.pc1.symbols[,1]
fpkm.combat.pc1 <- cbind(q[extreme.pc1.ensg],published.nozero[extreme.pc1.ensg,])
names(fpkm.combat.pc1)[names(fpkm.combat.pc1) == 'q[extreme.pc1.ensg]'] <- 'Gene Symbol'
barplot(extreme.pc1, names.arg=q[extreme.pc1.ensg],las=2,main="Genes w highest absolute loadings in PC1 (ComBat log2 RPKM)")
print(fpkm.combat.pc1)
load.pc2 <- p.combat$rotation[,2][order(p.combat$rotation[,2])]
extreme.pc2 <- c(tail(load.pc2), head(load.pc2))
extreme.pc2.ensg <- names(extreme.pc2)
extreme.pc2.symbols <- getBM(attributes=c("ensembl_gene_id", "hgnc_symbol"),
filters = "ensembl_gene_id",
values=extreme.pc2.ensg,
mart=ensembl)
q <- extreme.pc2.symbols[,2]
names(q) <- extreme.pc2.symbols[,1]
fpkm.combat.pc2 <- cbind(q[extreme.pc2.ensg],published.nozero[extreme.pc2.ensg,])
names(fpkm.combat.pc2)[names(fpkm.combat.pc2) == 'q[extreme.pc2.ensg]'] <- 'Gene Symbol'
barplot(extreme.pc2, names.arg=q[extreme.pc2.ensg],las=2,main="Genes w highest absolute loadings in PC2 (ComBat log2 RPKM)")
print(fpkm.combat.pc2)
load.pc3 <- p.combat$rotation[,3][order(p.combat$rotation[,3])]
extreme.pc3 <- c(tail(load.pc3), head(load.pc3))
extreme.pc3.ensg <- names(extreme.pc3)
extreme.pc3.symbols <- getBM(attributes=c("ensembl_gene_id", "hgnc_symbol"),
filters = "ensembl_gene_id",
values=extreme.pc3.ensg,
mart=ensembl)
q <- extreme.pc3.symbols[,2]
names(q) <- extreme.pc3.symbols[,1]
fpkm.combat.pc3 <- cbind(q[extreme.pc3.ensg],published.nozero[extreme.pc3.ensg,])
names(fpkm.combat.pc3)[names(fpkm.combat.pc3) == 'q[extreme.pc3.ensg]'] <- 'Gene Symbol'
barplot(extreme.pc3, names.arg=q[extreme.pc3.ensg],las=2,main="Genes w highest absolute loadings in PC3 (ComBat log2 RPKM)")
print(fpkm.combat.pc3)
o <- melt(combat)
colnames(o) <- c("sample_ID","combat")
meta <- sampleinfo_published[,c("Study","Tissue","Preparation","NumberRaw","Numbermapped","Readtype")]
rownames(meta) <- colnames(combat)
tissue <- rep(meta$Tissue, each=nrow(combat))
study <- rep(meta$Study, each=nrow(combat))
prep <- rep(meta$Preparation, each=nrow(combat))
layout <- rep(meta$Readtype, each=nrow(combat))
raw <- rep(meta$NumberRaw, each=nrow(combat))
mapped <- rep(meta$Numbermapped, each=nrow(combat))
data <- data.frame(o, tissue=tissue, study=study, prep=prep, layout=layout,nraw=raw,nmapped=mapped)
fit <- lm(combat ~ layout + prep + nraw + study + tissue, data=data)
c <- anova(fit)
maxval = 100
barplot(100*c$"Sum Sq"[1:5]/sum(c$"Sum Sq"[1:5]),names.arg=rownames(c[1:5,]),main="Anova Combat",ylim=c(0,maxval))
cufflinks <- read.delim("fpkm_table_tophat.txt")
sampleinfo_cufflinks <- read.delim("sample_info_reprocessed.txt")
gene_ids <- as.vector(cufflinks[,1])
ensembl = useMart("ensembl", dataset = "hsapiens_gene_ensembl") #select the ensembl database
gene_type <- getBM(attributes=c("ensembl_gene_id", "gene_biotype"),
filters = "ensembl_gene_id",
values=gene_ids,
mart=ensembl)
pc <- subset(gene_type[,1],gene_type[,2]=="protein_coding")
cufflinks_pc <- cufflinks[match(pc,cufflinks[,1]),]
cufflinks_pc_nozero <- cufflinks_pc[-which(rowSums(cufflinks_pc[,3:16])<=0.01),]
pheatmap(cor(cufflinks_pc_nozero[,3:16], method="spearman"))
cufflinks_fpkms <- cufflinks_pc_nozero[,3:16]
rownames(cufflinks_fpkms) <- cufflinks_pc_nozero[,1]
p.cufflinks <- prcomp(t(cufflinks_fpkms))
colors <- c("dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred")
shapes_cufflinks <- c(rep(11,3),rep(8,3),rep(17,3),rep(15,3),rep(16,2))
plot(p.cufflinks$x[,1],p.cufflinks$x[,2],pch=shapes_cufflinks,col=colors,xlab=paste("PC1 87% of variance"),ylab=paste("PC2 7.7% of variance"),main="Reprocessed FPKM values \n n=19,475")
legend("bottomright",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
colors <- c("dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred")
par(mfrow=c(4,4))
for (i in 1:6){
for(j in 1:6){
if (i<j){
plot(p.cufflinks$x[,i],p.cufflinks$x[,j],pch=shapes_cufflinks,col=colors,xlab=paste("PC",i),ylab=paste("PC",j),main="Cufflinks FPKM values \n n=19475")
}
}
}
load.pc1 <- p.cufflinks$rotation[,1][order(p.cufflinks$rotation[,1])]
extreme.pc1 <- c(tail(load.pc1), head(load.pc1))
extreme.pc1.ensg <- names(extreme.pc1)
extreme.pc1.symbols <- getBM(attributes=c("ensembl_gene_id", "hgnc_symbol"),
filters = "ensembl_gene_id",
values=extreme.pc1.ensg,
mart=ensembl)
q <- extreme.pc1.symbols[,2]
names(q) <- extreme.pc1.symbols[,1]
load.pc1 <- p.cufflinks$rotation[,1][order(p.cufflinks$rotation[,1])]
extreme.pc1 <- c(tail(load.pc1), head(load.pc1))
extreme.pc1.ensg <- names(extreme.pc1)
extreme.pc1.symbols <- getBM(attributes=c("ensembl_gene_id", "hgnc_symbol"),
filters = "ensembl_gene_id",
values=extreme.pc1.ensg,
mart=ensembl)
q <- extreme.pc1.symbols[,2]
names(q) <- extreme.pc1.symbols[,1]
fpkm.cuff.pc1 <- cbind(q[extreme.pc1.ensg],published.nozero[extreme.pc1.ensg,])
names(fpkm.cuff.pc1)[names(fpkm.cuff.pc1) == 'q[extreme.pc1.ensg]'] <- 'Gene Symbol'
barplot(extreme.pc1, names.arg=q[extreme.pc1.ensg],las=2,main="Genes w highest absolute loadings in PC1 (raw Cufflinks FPKM)")
print(fpkm.cuff.pc1)
load.pc1 <- p.cufflinks$rotation[,1][order(p.cufflinks$rotation[,1])]
extreme.pc1 <- c(tail(load.pc1), head(load.pc1))
extreme.pc1.ensg <- names(extreme.pc1)
extreme.pc1.symbols <- getBM(attributes=c("ensembl_gene_id", "hgnc_symbol"),
filters = "ensembl_gene_id",
values=extreme.pc1.ensg,
mart=ensembl)
q <- extreme.pc1.symbols[,2]
names(q) <- extreme.pc1.symbols[,1]
fpkm.cuff.pc1 <- cbind(q[extreme.pc1.ensg],cufflinks_pc_nozero[extreme.pc1.ensg,])
names(fpkm.cuff.pc1)[names(fpkm.cuff.pc1) == 'q[extreme.pc1.ensg]'] <- 'Gene Symbol'
barplot(extreme.pc1, names.arg=q[extreme.pc1.ensg],las=2,main="Genes w highest absolute loadings in PC1 (raw Cufflinks FPKM)")
print(fpkm.cuff.pc1)
load.pc1 <- p.cufflinks$rotation[,1][order(p.cufflinks$rotation[,1])]
extreme.pc1 <- c(tail(load.pc1), head(load.pc1))
extreme.pc1.ensg <- names(extreme.pc1)
extreme.pc1.symbols <- getBM(attributes=c("ensembl_gene_id", "hgnc_symbol"),
filters = "ensembl_gene_id",
values=extreme.pc1.ensg,
mart=ensembl)
extreme.pc1
extreme.pc1.ensg
extreme.pc1.symbols
head(cufflinks_pc_nozero)
head(cufflinks_fpkms)
fpkm.cuff.pc1 <- cbind(q[extreme.pc1.ensg],cufflinks_fpkms[extreme.pc1.ensg,])
names(fpkm.cuff.pc1)[names(fpkm.cuff.pc1) == 'q[extreme.pc1.ensg]'] <- 'Gene Symbol'
barplot(extreme.pc1, names.arg=q[extreme.pc1.ensg],las=2,main="Genes w highest absolute loadings in PC1 (raw Cufflinks FPKM)")
print(fpkm.cuff.pc1)
fpkm.cuff.pc2 <- cbind(q[extreme.pc2.ensg],cufflinks_fpkms[extreme.pc2.ensg,])
fpkm.cuff.pc3 <- cbind(q[extreme.pc3.ensg],cufflinks_fpkms[extreme.pc3.ensg,])
#PC1:
load.pc1 <- p.cufflinks$rotation[,1][order(p.cufflinks$rotation[,1])]
extreme.pc1 <- c(tail(load.pc1), head(load.pc1))
extreme.pc1.ensg <- names(extreme.pc1)
extreme.pc1.symbols <- getBM(attributes=c("ensembl_gene_id", "hgnc_symbol"),
filters = "ensembl_gene_id",
values=extreme.pc1.ensg,
mart=ensembl)
q <- extreme.pc1.symbols[,2]
names(q) <- extreme.pc1.symbols[,1]
fpkm.cuff.pc1 <- cbind(q[extreme.pc1.ensg],cufflinks_fpkms[extreme.pc1.ensg,])
names(fpkm.cuff.pc1)[names(fpkm.cuff.pc1) == 'q[extreme.pc1.ensg]'] <- 'Gene Symbol'
barplot(extreme.pc1, names.arg=q[extreme.pc1.ensg],las=2,main="Genes w highest absolute loadings in PC1 (raw Cufflinks FPKM)")
print(fpkm.cuff.pc1)
#PC1:
load.pc1 <- p.cufflinks$rotation[,1][order(p.cufflinks$rotation[,1])]
extreme.pc1 <- c(tail(load.pc1), head(load.pc1))
extreme.pc1.ensg <- names(extreme.pc1)
extreme.pc1.symbols <- getBM(attributes=c("ensembl_gene_id", "hgnc_symbol"),
filters = "ensembl_gene_id",
values=extreme.pc1.ensg,
mart=ensembl)
q <- extreme.pc1.symbols[,2]
names(q) <- extreme.pc1.symbols[,1]
fpkm.cuff.pc1 <- cbind(q[extreme.pc1.ensg],cufflinks_fpkms[extreme.pc1.ensg,])
names(fpkm.cuff.pc1)[names(fpkm.cuff.pc1) == 'q[extreme.pc1.ensg]'] <- 'Gene Symbol'
barplot(extreme.pc1, names.arg=q[extreme.pc1.ensg],las=2,main="Genes w highest absolute loadings in PC1 (raw Cufflinks FPKM)")
print(fpkm.cuff.pc1)
#PC2:
load.pc2 <- p.cufflinks$rotation[,2][order(p.cufflinks$rotation[,2])]
extreme.pc2 <- c(tail(load.pc2), head(load.pc2))
extreme.pc2.ensg <- names(extreme.pc2)
extreme.pc2.symbols <- getBM(attributes=c("ensembl_gene_id", "hgnc_symbol"),
filters = "ensembl_gene_id",
values=extreme.pc2.ensg,
mart=ensembl)
q <- extreme.pc2.symbols[,2]
names(q) <- extreme.pc2.symbols[,1]
fpkm.cuff.pc2 <- cbind(q[extreme.pc2.ensg],cufflinks_fpkms[extreme.pc2.ensg,])
names(fpkm.cuff.pc2)[names(fpkm.cuff.pc2) == 'q[extreme.pc2.ensg]'] <- 'Gene Symbol'
barplot(extreme.pc2, names.arg=q[extreme.pc2.ensg],las=2,main="Genes w highest absolute loadings in PC2 (raw Cufflinks FPKM)")
print(fpkm.cuff.pc2)
#PC3:
load.pc3 <- p.cufflinks$rotation[,3][order(p.cufflinks$rotation[,3])]
extreme.pc3 <- c(tail(load.pc3), head(load.pc3))
extreme.pc3.ensg <- names(extreme.pc3)
extreme.pc3.symbols <- getBM(attributes=c("ensembl_gene_id", "hgnc_symbol"),
filters = "ensembl_gene_id",
values=extreme.pc3.ensg,
mart=ensembl)
q <- extreme.pc3.symbols[,2]
names(q) <- extreme.pc3.symbols[,1]
fpkm.cuff.pc3 <- cbind(q[extreme.pc3.ensg],cufflinks_fpkms[extreme.pc3.ensg,])
names(fpkm.cuff.pc3)[names(fpkm.cuff.pc3) == 'q[extreme.pc3.ensg]'] <- 'Gene Symbol'
barplot(extreme.pc3, names.arg=q[extreme.pc3.ensg],las=2,main="Genes w highest absolute loadings in PC3 (raw Cufflinks FPKM)")
print(fpkm.cuff.pc3)
p <- melt(cufflinks_fpkms)
colnames(p) <- c("sample_ID","Cuff_FPKM")
meta <- sampleinfo_cufflinks[,c("Study","Tissue","Preparation","NumberRaw","Numbermapped","Readtype")]
rownames(meta) <- colnames(cufflinks_fpkms)
tissue <- rep(meta$Tissue, each=nrow(cufflinks_fpkms))
study <- rep(meta$Study, each=nrow(cufflinks_fpkms))
prep <- rep(meta$Preparation, each=nrow(cufflinks_fpkms))
layout <- rep(meta$Readtype, each=nrow(cufflinks_fpkms))
nraw <- rep(meta$NumberRaw, each=nrow(cufflinks_fpkms))
data <- data.frame(p, tissue=tissue, study=study, prep=prep, layout=layout, nraw=nraw)
fit <- lm(Cuff_FPKM ~ layout + prep + nraw + study + tissue, data=data)
d <- anova(fit)
maxval = 100
barplot(100*d$"Sum Sq"[1:5]/sum(d$"Sum Sq"[1:5]),names.arg=rownames(d[1:5,]),main="Anova, Cufflinks FPKM",ylim=c(0,maxval))
```
pseudo <- 1
cufflinks_log <- log2(cufflinks_fpkms + pseudo)
plot(p.log.cufflinks$x[,2],p.log.cufflinks$x[,3],pch=shapes_cufflinks,col=colors,xlab=paste("PC2 25% of variance"),ylab=paste("PC3 22% of variance"),main="log2 reprocessed cufflinks FPKM values \n n=19,475")
legend("bottomright",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
colors <- c("dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred")
p.log.cufflinks <- prcomp(t(cufflinks_log))
shapes_cufflinks <- c(rep(11,3),rep(8,3),rep(17,3),rep(15,3),rep(16,2))
plot(p.log.cufflinks$x[,1],p.log.cufflinks$x[,2],pch=shapes_cufflinks,col=colors,xlab=paste("PC1 33% of variance"),ylab=paste("PC2 25% of variance"),main="log2 reprocessed cufflinks FPKM values \n n=19,475")
legend("bottomright",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
```
plot(p.log.cufflinks$x[,2],p.log.cufflinks$x[,3],pch=shapes_cufflinks,col=colors,xlab=paste("PC2 25% of variance"),ylab=paste("PC3 22% of variance"),main="log2 reprocessed cufflinks FPKM values \n n=19,475")
legend("bottomright",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
par(mfrow=c(4,4))
for (i in 1:6){
for(j in 1:6){
if (i<j){
plot(p.log.cufflinks$x[,i],p.log.cufflinks$x[,j],pch=shapes_cufflinks,col=colors,xlab=paste("PC",i),ylab=paste("PC",j),main="log2 reprocessed FPKM values \n n=19475")
}
}
}
load.pc1 <- p.log.cufflinks$rotation[,1][order(p.log.cufflinks$rotation[,1])]
extreme.pc1 <- c(tail(load.pc1), head(load.pc1))
extreme.pc1.ensg <- names(extreme.pc1)
extreme.pc1.symbols <- getBM(attributes=c("ensembl_gene_id", "hgnc_symbol"),
filters = "ensembl_gene_id",
values=extreme.pc1.ensg,
mart=ensembl)
q <- extreme.pc1.symbols[,2]
names(q) <- extreme.pc1.symbols[,1]
meta <- data.frame(study=c(rep("EoGE",3),rep("Atlas",3),rep("BodyMap",3),rep("HPA",3),rep("AltIso",2)),tissue=c("Brain","Heart","Kidney","Brain","Heart","Kidney","Brain","Heart","Kidney","Brain","Heart","Kidney","Brain","Heart"),prep=c(rep("poly-A",3),rep("rRNA-depl",3),rep("poly-A",8)),layout=c(rep("PE",3),rep("SE",3),rep("PE",6),rep("SE",2)))
batch <- meta$study
design <- model.matrix(~1,data=meta)
combat.cufflinks <- ComBat(dat=cufflinks_log,batch=batch,mod=design,numCovs=NULL,par.prior=TRUE)
rownames(combat.cufflinks) <- rownames(cufflinks_log)
pheatmap(cor(combat.cufflinks),method="spearman")
p.combat.cufflinks <- prcomp(t(combat.cufflinks))
shapes_cufflinks <- c(rep(11,3),rep(8,3),rep(17,3),rep(15,3),rep(16,2))
plot(p.combat.cufflinks$x[,1],p.combat.cufflinks$x[,2],pch=shapes_cufflinks,col=colors,xlab=paste("PC1 54% of variance"),ylab=paste("PC2 37% of variance"),main="Cufflinks FPKM values \n COMBAT \n n=19,475")
legend("bottomleft",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
par(mfrow=c(4,4))
for (i in 1:6){
for(j in 1:6){
if (i<j){
plot(p.combat.cufflinks$x[,i],p.combat.cufflinks$x[,j],pch=shapes_cufflinks,col=colors,xlab=paste("PC",i),ylab=paste("PC",j),main="Cufflinks FPKM values \n COMBAT \ n=19,475")
}
}
}
load.pc1 <- p.combat.cufflinks$rotation[,1][order(p.combat.cufflinks$rotation[,1])]
extreme.pc1 <- c(tail(load.pc1), head(load.pc1))
extreme.pc1.ensg <- names(extreme.pc1)
extreme.pc1.symbols <- getBM(attributes=c("ensembl_gene_id", "hgnc_symbol"),
filters = "ensembl_gene_id",
values=extreme.pc1.ensg,
mart=ensembl)
q <- extreme.pc1.symbols[,2]
names(q) <- extreme.pc1.symbols[,1]
load.pc1 <- p.combat.cufflinks$rotation[,1][order(p.combat.cufflinks$rotation[,1])]
extreme.pc1 <- c(tail(load.pc1), head(load.pc1))
extreme.pc1.ensg <- names(extreme.pc1)
extreme.pc1.symbols <- getBM(attributes=c("ensembl_gene_id", "hgnc_symbol"),
filters = "ensembl_gene_id",
values=extreme.pc1.ensg,
mart=ensembl)
q <- extreme.pc1.symbols[,2]
names(q) <- extreme.pc1.symbols[,1]
fpkm.combatcuff.pc1 <- cbind(q[extreme.pc1.ensg],cufflinks_fpkms[extreme.pc1.ensg,])
names(fpkm.combatcuff.pc1)[names(fpkm.combatcuff.pc1) == 'q[extreme.pc1.ensg]'] <- 'Gene Symbol'
barplot(extreme.pc1, names.arg=q[extreme.pc1.ensg],las=2,main="Genes w highest absolute loadings in PC1 (COMBAT Cufflinks FPKM)")
print(fpkm.combatcuff.pc1)
#PC3:
load.pc3 <- p.combat.cufflinks$rotation[,3][order(p.combat.cufflinks$rotation[,3])]
extreme.pc3 <- c(tail(load.pc3), head(load.pc3))
extreme.pc3.ensg <- names(extreme.pc3)
extreme.pc3.symbols <- getBM(attributes=c("ensembl_gene_id", "hgnc_symbol"),
filters = "ensembl_gene_id",
values=extreme.pc3.ensg,
mart=ensembl)
q <- extreme.pc3.symbols[,2]
names(q) <- extreme.pc3.symbols[,1]
fpkm.combatcuff.pc3 <- cbind(q[extreme.pc3.ensg],cufflinks_fpkms[extreme.pc3.ensg,])
names(fpkm.combatcuff.pc3)[names(fpkm.combatcuff.pc3) == 'q[extreme.pc3.ensg]'] <- 'Gene Symbol'
barplot(extreme.pc3, names.arg=q[extreme.pc3.ensg],las=2,main="Genes w highest absolute loadings in PC3 (COMBAT Cufflinks FPKM)")
print(fpkm.combatcuff.pc3)
q <- melt(combat.cufflinks)
colnames(q) <- c("sample_ID","combat")
meta <- sampleinfo_cufflinks[,c("Study","Tissue","Preparation","NumberRaw","Numbermapped","Readtype")]
rownames(meta) <- colnames(combat.cufflinks)
tissue <- rep(meta$Tissue, each=nrow(combat.cufflinks))
study <- rep(meta$Study, each=nrow(combat.cufflinks))
prep <- rep(meta$Preparation, each=nrow(combat.cufflinks))
layout <- rep(meta$Readtype, each=nrow(combat.cufflinks))
raw <- rep(meta$NumberRaw, each=nrow(combat.cufflinks))
mapped <- rep(meta$Numbermapped, each=nrow(combat.cufflinks))
data <- data.frame(q, tissue=tissue, study=study, prep=prep, layout=layout,nraw=raw,nmapped=mapped)
fit <- lm(combat ~ prep + nraw + layout + study + tissue, data=data)
f <- anova(fit)
maxval = 100
barplot(100*f$"Sum Sq"/sum(f$"Sum Sq"),names.arg=rownames(f),main="Anova Cufflinks Combat",ylim=c(0,maxval))
q <- melt(combat.cufflinks)
colnames(q) <- c("sample_ID","combat")
meta <- sampleinfo_cufflinks[,c("Study","Tissue","Preparation","NumberRaw","Numbermapped","Readtype")]
rownames(meta) <- colnames(combat.cufflinks)
tissue <- rep(meta$Tissue, each=nrow(combat.cufflinks))
study <- rep(meta$Study, each=nrow(combat.cufflinks))
prep <- rep(meta$Preparation, each=nrow(combat.cufflinks))
layout <- rep(meta$Readtype, each=nrow(combat.cufflinks))
raw <- rep(meta$NumberRaw, each=nrow(combat.cufflinks))
mapped <- rep(meta$Numbermapped, each=nrow(combat.cufflinks))
data <- data.frame(q, tissue=tissue, study=study, prep=prep, layout=layout,nraw=raw,nmapped=mapped)
fit <- lm(combat ~ prep + nraw + layout + study + tissue, data=data)
f <- anova(fit)
maxval = 100
barplot(100*f$"Sum Sq"[1:5]/sum(f$"Sum Sq"[1:5]),names.arg=rownames(f[1:5,]),main="Anova Cufflinks Combat",ylim=c(0,maxval))
colors <- c("indianred", "dodgerblue", "forestgreen",
"indianred", "dodgerblue",
"indianred", "dodgerblue", "forestgreen",
"indianred", "dodgerblue", "forestgreen")
p <- prcomp(t(published.nozero))
shapes <- c(rep(15,3),rep(16,2),rep(17,3),rep(8,3))
plot(p$x[,1],p$x[,2],pch=shapes,cex=1.5,col=colors,xlab=paste("PC1 58% of variance"),ylab=paste("PC2 13% of variance"),main="Published FPKM/RPKM values \n n=13,323")
legend("bottomleft",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
head(published.nozero)
unique(names(published.nozero)
)
legend("topcenter",legend=c("HPA","AltIso","GTEx","Atlas"),col="black")
legend("top",legend=c("HPA","AltIso","GTEx","Atlas"),col="black")
legend("top",legend=c("HPA","AltIso","GTEx","Atlas"),col="black",pch=c(15,16,17,8))
legend("bottomright",legend=c("HPA","AltIso","GTEx","Atlas"),col="black",pch=c(15,16,17,8))
colors <- c("indianred", "dodgerblue", "forestgreen",
"indianred", "dodgerblue",
"indianred", "dodgerblue", "forestgreen",
"indianred", "dodgerblue", "forestgreen")
p <- prcomp(t(published.nozero))
shapes <- c(rep(15,3),rep(16,2),rep(17,3),rep(8,3))
plot(p$x[,1],p$x[,2],pch=shapes,cex=1.5,col=colors,xlab=paste("PC1 58% of variance"),ylab=paste("PC2 13% of variance"),main="Published FPKM/RPKM values \n n=13,323")
legend("bottomleft",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
legend("bottomright",legend=c("HPA","AltIso","GTEx","Atlas"),col="black",pch=c(15,16,17,8))
colors <- c("indianred", "dodgerblue", "forestgreen",
"indianred", "dodgerblue",
"indianred", "dodgerblue", "forestgreen",
"indianred", "dodgerblue", "forestgreen")
p <- prcomp(t(published.nozero))
shapes <- c(rep(15,3),rep(16,2),rep(17,3),rep(8,3))
plot(p$x[,1],p$x[,2],pch=shapes,cex=1.5,col=colors,xlab=paste("PC1 58% of variance"),ylab=paste("PC2 13% of variance"),main="Published FPKM/RPKM values \n n=13,323")
legend("bottomleft",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
legend("bottomright",legend=c("HPA","AltIso","GTEx","Atlas"),col="black",pch=c(15,16,17,8))
legend("top",legend=c("HPA","AltIso","GTEx","Atlas"),col="black",pch=c(15,16,17,8),nrow=2)
legend("top",legend=c("HPA","AltIso","GTEx","Atlas"),col="black",pch=c(15,16,17,8),ncol=2)
colors <- c("indianred", "dodgerblue", "forestgreen",
"indianred", "dodgerblue",
"indianred", "dodgerblue", "forestgreen",
"indianred", "dodgerblue", "forestgreen")
p <- prcomp(t(published.nozero))
shapes <- c(rep(15,3),rep(16,2),rep(17,3),rep(8,3))
plot(p$x[,1],p$x[,2],pch=shapes,cex=1.5,col=colors,xlab=paste("PC1 58% of variance"),ylab=paste("PC2 13% of variance"),main="Published FPKM/RPKM values \n n=13,323")
legend("bottom",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
legend("top",legend=c("HPA","AltIso","GTEx","Atlas"),col="black",pch=c(15,16,17,8),ncol=2)
legend("topleft",legend=c("HPA","AltIso","GTEx","Atlas"),col="black",pch=c(15,16,17,8),ncol=2)
colors <- c("indianred", "dodgerblue", "forestgreen",
"indianred", "dodgerblue",
"indianred", "dodgerblue", "forestgreen",
"indianred", "dodgerblue", "forestgreen")
p <- prcomp(t(published.nozero))
shapes <- c(rep(15,3),rep(16,2),rep(17,3),rep(8,3))
plot(p$x[,1],p$x[,2],pch=shapes,cex=1.5,col=colors,xlab=paste("PC1 58% of variance"),ylab=paste("PC2 13% of variance"),main="Published FPKM/RPKM values \n n=13,323")
legend("bottom",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
legend("topleft",legend=c("HPA","AltIso","GTEx","Atlas"),col="black",pch=c(15,16,17,8),ncol=2)
legend("bottomleft",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
colors <- c("indianred", "dodgerblue", "forestgreen",
"indianred", "dodgerblue",
"indianred", "dodgerblue", "forestgreen",
"indianred", "dodgerblue", "forestgreen")
p <- prcomp(t(published.nozero))
shapes <- c(rep(15,3),rep(16,2),rep(17,3),rep(8,3))
plot(p$x[,1],p$x[,2],pch=shapes,cex=1.5,col=colors,xlab=paste("PC1 58% of variance"),ylab=paste("PC2 13% of variance"),main="Published FPKM/RPKM values \n n=13,323")
legend("bottomleft",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
legend("top",legend=c("HPA","AltIso","GTEx","Atlas"),col="black",pch=c(15,16,17,8),ncol=2)
legend("top",legend=c("HPA","AltIso","GTEx","Atlas"),col="black",pch=c(15,16,17,8),ncol=2,bty="n")
colors <- c("indianred", "dodgerblue", "forestgreen",
"indianred", "dodgerblue",
"indianred", "dodgerblue", "forestgreen",
"indianred", "dodgerblue", "forestgreen")
p <- prcomp(t(published.nozero))
shapes <- c(rep(15,3),rep(16,2),rep(17,3),rep(8,3))
plot(p$x[,1],p$x[,2],pch=shapes,cex=1.5,col=colors,xlab=paste("PC1 58% of variance"),ylab=paste("PC2 13% of variance"),main="Published FPKM/RPKM values \n n=13,323")
legend("bottomleft",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
legend("top",legend=c("HPA","AltIso","GTEx","Atlas"),col="black",pch=c(15,16,17,8),ncol=2,bty="n")
colors <- c("indianred", "dodgerblue", "forestgreen",
"indianred", "dodgerblue",
"indianred", "dodgerblue", "forestgreen",
"indianred", "dodgerblue", "forestgreen")
p <- prcomp(t(published.nozero))
shapes <- c(rep(15,3),rep(16,2),rep(17,3),rep(8,3))
plot(p$x[,1],p$x[,2],pch=shapes,cex=1.5,col=colors,xlab=paste("PC1 58% of variance"),ylab=paste("PC2 13% of variance"),main="Published FPKM/RPKM values \n n=13,323")
legend("bottomleft",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20)
legend("top",legend=c("HPA","AltIso","GTEx","Atlas"),col="black",pch=c(15,16,17,8),ncol=2)
colors <- c("indianred", "dodgerblue", "forestgreen",
"indianred", "dodgerblue",
"indianred", "dodgerblue", "forestgreen",
"indianred", "dodgerblue", "forestgreen")
p <- prcomp(t(published.nozero))
shapes <- c(rep(15,3),rep(16,2),rep(17,3),rep(8,3))
plot(p$x[,1],p$x[,2],pch=shapes,cex=1.5,col=colors,xlab=paste("PC1 58% of variance"),ylab=paste("PC2 13% of variance"),main="Published FPKM/RPKM values \n n=13,323")
legend("top",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20)
legend("top",legend=c("HPA","AltIso","GTEx","Atlas"),col="black",pch=c(15,16,17,8),ncol=2)
colors <- c("indianred", "dodgerblue", "forestgreen",
"indianred", "dodgerblue",
"indianred", "dodgerblue", "forestgreen",
"indianred", "dodgerblue", "forestgreen")
p <- prcomp(t(published.nozero))
shapes <- c(rep(15,3),rep(16,2),rep(17,3),rep(8,3))
plot(p$x[,1],p$x[,2],pch=shapes,cex=1.5,col=colors,xlab=paste("PC1 58% of variance"),ylab=paste("PC2 13% of variance"),main="Published FPKM/RPKM values \n n=13,323")
legend("bottomleft",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20)
legend("bottomright",legend=c("HPA","AltIso","GTEx","Atlas"),col="black",pch=c(15,16,17,8),ncol=2)
legend("top",legend=c("HPA","AltIso","GTEx","Atlas"),col="black",pch=c(15,16,17,8),ncol=2)
colors <- c("indianred", "dodgerblue", "forestgreen",
"indianred", "dodgerblue",
"indianred", "dodgerblue", "forestgreen",
"indianred", "dodgerblue", "forestgreen")
p <- prcomp(t(published.nozero))
shapes <- c(rep(15,3),rep(16,2),rep(17,3),rep(8,3))
plot(p$x[,1],p$x[,2],pch=shapes,cex=1.5,col=colors,xlab=paste("PC1 58% of variance"),ylab=paste("PC2 13% of variance"),main="Published FPKM/RPKM values \n n=13,323")
legend("bottomleft",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20)
legend("top",legend=c("HPA","AltIso","GTEx","Atlas"),col="black",pch=c(15,16,17,8),ncol=2)
colors <- c("indianred", "dodgerblue", "forestgreen",
"indianred", "dodgerblue",
"indianred", "dodgerblue", "forestgreen",
"indianred", "dodgerblue", "forestgreen")
p.log <- prcomp(t(published.log))
shapes <- c(rep(15,3),rep(16,2),rep(17,3),rep(8,3))
plot(p.log$x[,1],p.log$x[,2],pch=shapes,col=colors,xlab=paste("PC1 31% of variance"),ylab=paste("PC2 27% of variance"),main="log2 Published FPKM/RPKM values \n n=13,323")
legend("bottomright",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
legend("top",legend=c("HPA","AltIso","GTEx","Atlas"),col="black",pch=c(15,16,17,8),ncol=2)
colors <- c("indianred", "dodgerblue", "forestgreen",
"indianred", "dodgerblue",
"indianred", "dodgerblue", "forestgreen",
"indianred", "dodgerblue", "forestgreen")
p.combat <- prcomp(t(combat))
shapes <- c(rep(15,3),rep(16,2),rep(17,3),rep(8,3))
plot(p.combat$x[,1],p.combat$x[,2],pch=shapes,col=colors,xlab=paste("PC1 54% of variance"),ylab=paste("PC2 38% of variance"),main="Published FPKM values \n COMBAT \n n=13,323")
legend("bottomright",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
legend("top",legend=c("HPA","AltIso","GTEx","Atlas"),col="black",pch=c(15,16,17,8),ncol=2)
legend("topright",legend=c("HPA","AltIso","GTEx","Atlas"),col="black",pch=c(15,16,17,8),ncol=2)
colors <- c("indianred", "dodgerblue", "forestgreen",
"indianred", "dodgerblue",
"indianred", "dodgerblue", "forestgreen",
"indianred", "dodgerblue", "forestgreen")
p.combat <- prcomp(t(combat))
shapes <- c(rep(15,3),rep(16,2),rep(17,3),rep(8,3))
plot(p.combat$x[,1],p.combat$x[,2],pch=shapes,col=colors,xlab=paste("PC1 54% of variance"),ylab=paste("PC2 38% of variance"),main="Published FPKM values \n COMBAT \n n=13,323")
legend("bottom",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
legend("topright",legend=c("HPA","AltIso","GTEx","Atlas"),col="black",pch=c(15,16,17,8),ncol=2)
legend("bottomright",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
head(cufflinks_fpkms)
cufflinks_fpkms <- cufflinks_pc_nozero[,3:16]
rownames(cufflinks_fpkms) <- cufflinks_pc_nozero[,1]
p.cufflinks <- prcomp(t(cufflinks_fpkms))
colors <- c("dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred")
shapes_cufflinks <- c(rep(11,3),rep(8,3),rep(17,3),rep(15,3),rep(16,2))
plot(p.cufflinks$x[,1],p.cufflinks$x[,2],pch=shapes_cufflinks,col=colors,xlab=paste("PC1 87% of variance"),ylab=paste("PC2 7.7% of variance"),main="Reprocessed FPKM values \n n=19,475")
legend("bottomright",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
legend("top",legend=c("EoGE","Atlas","BodyMap","HPA","AltIso"),col="black",pch=c(11,8,17,15,16),ncol=2)
colors <- c("dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred")
p.log.cufflinks <- prcomp(t(cufflinks_log))
shapes_cufflinks <- c(rep(11,3),rep(8,3),rep(17,3),rep(15,3),rep(16,2))
plot(p.log.cufflinks$x[,1],p.log.cufflinks$x[,2],pch=shapes_cufflinks,col=colors,xlab=paste("PC1 33% of variance"),ylab=paste("PC2 25% of variance"),main="log2 reprocessed cufflinks FPKM values \n n=19,475")
legend("bottomright",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
legend("top",legend=c("EoGE","Atlas","BodyMap","HPA","AltIso"),col="black",pch=c(11,8,17,15,16),ncol=2)
colors <- c("dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred", "forestgreen",
"dodgerblue", "indianred")
p.log.cufflinks <- prcomp(t(cufflinks_log))
shapes_cufflinks <- c(rep(11,3),rep(8,3),rep(17,3),rep(15,3),rep(16,2))
plot(p.log.cufflinks$x[,1],p.log.cufflinks$x[,2],pch=shapes_cufflinks,col=colors,xlab=paste("PC1 33% of variance"),ylab=paste("PC2 25% of variance"),main="log2 reprocessed cufflinks FPKM values \n n=19,475")
legend("bottomleft",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
legend("top",legend=c("EoGE","Atlas","BodyMap","HPA","AltIso"),col="black",pch=c(11,8,17,15,16),ncol=2)
p.combat.cufflinks <- prcomp(t(combat.cufflinks))
shapes_cufflinks <- c(rep(11,3),rep(8,3),rep(17,3),rep(15,3),rep(16,2))
plot(p.combat.cufflinks$x[,1],p.combat.cufflinks$x[,2],pch=shapes_cufflinks,col=colors,xlab=paste("PC1 54% of variance"),ylab=paste("PC2 37% of variance"),main="Cufflinks FPKM values \n COMBAT \n n=19,475")
legend("bottomleft",legend=c("Heart","Brain","Kidney"),col=c("indianred", "dodgerblue", "forestgreen"),cex=1.5,pch=20,bty="n")
legend("top",legend=c("EoGE","Atlas","BodyMap","HPA","AltIso"),col="black",pch=c(11,8,17,15,16),ncol=2)
