meta <- data.frame(tissue=c("brain","heart","kidney","brain","heart","kidney","brain","heart","kidney","brain","heart","kidney","brain","heart"),study=c("EoGE","EoGE","EoGE","Atlas","Atlas","Atlas","BodyMap","BodyMap","BodyMap","HPA","HPA","HPA","AltIso","AltIso"),prep=c(rep("poly-A",3),rep("rRNA-depl",3),rep("poly-A",8)),layout=c(rep("PE",3),rep("SE",3),rep("PE",6),rep("SE",2)))
rownames(meta) <- colnames(f_pc_nozero)[3:16]
tissue <- rep(meta$tissue, each=nrow(f_pc_nozero))
study <- rep(meta$study, each=nrow(f_pc_nozero))
prep <- rep(meta$prep, each=nrow(f_pc_nozero))
meta <- data.frame(tissue=c("brain","heart","kidney","brain","heart","kidney","brain","heart","kidney","brain","heart","kidney","brain","heart"),study=c("EoGE","EoGE","EoGE","Atlas","Atlas","Atlas","BodyMap","BodyMap","BodyMap","HPA","HPA","HPA","AltIso","AltIso"),prep=c(rep("poly-A",3),rep("rRNA-depl",3),rep("poly-A",8)),layout=c(rep("PE",3),rep("SE",3),rep("PE",6),rep("SE",2)))
rownames(meta) <- colnames(f_pc_nozero)[3:16]
tissue <- rep(meta$tissue, each=nrow(cufflinks_pc_nozero))
study <- rep(meta$study, each=nrow(cufflinks_pc_nozero))
prep <- rep(meta$prep, each=nrow(cufflinks_pc_nozero))
layout <- rep(meta$layout, each=nrow(cufflinks_pc_nozero))
data <- data.frame(o, tissue=tissue, study=study, prep=prep, layout=layout)
fit <- lm(Cuff_FPKM ~ prep + layout + study + tissue, data=data)
d <- anova(fit)
barplot(d$"F value"[-5],names.arg=rownames(d)[-5],main="Anova F score, Cufflinks FPKM",ylim=c(0,maxval))
head(cufflinks_pc_nozero)
cufflinks.log <- log2(cufflinks_pc_nozero[,3:16] + pseudo)
pheatmap(cor(cufflinks.log))
p.log.cufflinks <- prcomp(t(cufflinks.log))
colors <- c(2,1,3,2,1,3,2,1,3,2,1,3,2,1)
p.log.cufflinks <- prcomp(t(cufflinks.log))
plot(p.log.cufflinkscufflinks$x[,1],p.log.cufflinks$x[,2],pch=20,col=colors,xlab=paste("PC1"),ylab=paste("PC2"),main="log2 reprocessed cufflinks FPKM values \n n=19475")
plot(p.log.cufflinks$x[,2],p.log.cufflinks$x[,3],pch=20,col=colors,xlab=paste("PC2"),ylab=paste("PC3"),main="log2 reprocessed cufflinks FPKM values \n n=13323")
plot(p.log.cufflinkscufflinks$x[,1],p.log.cufflinks$x[,2],pch=20,col=colors,xlab=paste("PC1"),ylab=paste("PC2"),main="log2 reprocessed cufflinks FPKM values \n n=19475")
plot(p.log.cufflinks$x[,2],p.log.cufflinks$x[,3],pch=20,col=colors,xlab=paste("PC2"),ylab=paste("PC3"),main="log2 reprocessed cufflinks FPKM values \n n=13323")
plot(p.log.cufflinkscufflinks$x[,1],p.log.cufflinks$x[,2],pch=20,col=colors,xlab=paste("PC1"),ylab=paste("PC2"),main="log2 reprocessed cufflinks FPKM values \n n=19475")
p.log.cufflinks <- prcomp(t(cufflinks.log))
plot(p.log.cufflinks$x[,1],p.log.cufflinks$x[,2],pch=20,col=colors,xlab=paste("PC1"),ylab=paste("PC2"),main="log2 reprocessed cufflinks FPKM values \n n=19475")
plot(p.log.cufflinks$x[,2],p.log.cufflinks$x[,3],pch=20,col=colors,xlab=paste("PC2"),ylab=paste("PC3"),main="log2 reprocessed cufflinks FPKM values \n n=13323")
par(mfrow=c(4,4))
for (i in 1:6){
for(j in 1:6){
if (i<j){
plot(p.log.cufflinks$x[,i],p.log.cufflinks$x[,j],pch=20,col=colors,xlab=paste("PC",i),ylab=paste("PC",j),main="log2 reprocessed FPKM values \n n=19475")
}
}
}
symbol <- read.table("ENSG_Symbol.txt",header=TRUE)
plot(p.log.cufflinks$x[,1],p.log.cufflinks$x[,2],pch=20,col=colors,xlab=paste("PC1"),ylab=paste("PC2"))
textxy(p.log.cufflinks$x[,1],p.log.cufflinks$x[,2],labs=rownames(p.log.cufflinks$x))
plot(p.log.cufflinks$x[,1],p.log.cufflinks$x[,2],pch=20,col=colors,xlab=paste("PC1"),ylab=paste("PC2"))
textxy(p.log.cufflinks$x[,1],p.log.cufflinks$x[,2],labs=rownames(p.log.cufflinks$x))
load.pc1 <- p.log.cufflinks$rotation[,1][order(p.log.cufflinks$rotation[,1])]
extreme.pc1 <- c(tail(load.pc1), head(load.pc1))
symbs <- vector()
for (n in names(extreme.pc1)){
temp <- as.character(symbol[symbol[,1] == n,2])
if (length(temp)>1) temp <- temp[1]
symbs <- c(symbs, temp)
}
barplot(extreme.pc1, names.arg=symbs, las=2, main="Genes w highest absolute loadings in PC1 (log2 cufflinks FPKM)")
rownames(cufflinks.log) <- cufflinks_pc_nozero[,1]
p <- prcomp(t(cufflinks.log))
par(mfrow=c(1,1))
symbol <- read.table("ENSG_Symbol.txt",header=TRUE)
plot(p.log.cufflinks$x[,1],p.log.cufflinks$x[,2],pch=20,col=colors,xlab=paste("PC1"),ylab=paste("PC2"))
textxy(p.log.cufflinks$x[,1],p.log.cufflinks$x[,2],labs=rownames(p$x))
head(extreme.pc1)
head(names(extreme.pc1))
pseudo <- 1
cufflinks.log <- log2(cufflinks_pc_nozero[,3:16] + pseudo)
rownames(cufflinks.log) <- cufflinks_pc_nozero[,1]
head(cufflinks.log)
head(extreme.pc1)
par(mfrow=c(1,1))
symbol <- read.table("ENSG_Symbol.txt",header=TRUE)
plot(p.log.cufflinks$x[,1],p.log.cufflinks$x[,2],pch=20,col=colors,xlab=paste("PC1"),ylab=paste("PC2"))
textxy(p.log.cufflinks$x[,1],p.log.cufflinks$x[,2],labs=rownames(p$x))
load.pc1 <- p.log.cufflinks$rotation[,1][order(p.log.cufflinks$rotation[,1])]
extreme.pc1 <- c(tail(load.pc1), head(load.pc1))
symbs <- vector()
for (n in names(extreme.pc1)){
temp <- as.character(symbol[symbol[,1] == n,2])
if (length(temp)>1) temp <- temp[1]
symbs <- c(symbs, temp)
}
barplot(extreme.pc1, names.arg=symbs, las=2, main="Genes w highest absolute loadings in PC1 (log Cufflinks FPKM)")
library(pheatmap)
library(reshape)
library(gplots)
library(ops)
library(calibrate)
published <- read.delim("published_rpkms.txt",sep=" ")
sampleinfo_published <- read.table("sample_info_published.txt",header=TRUE)
dim(published)
published.nozero <- published[-which(rowSums(published[,])<=0.01),]
pheatmap(cor(published.nozero, method="spearman"))
pheatmap(cor(published.nozero))
colors <- c(1, 2, 3, 1, 2, 1, 2, 3, 1, 2, 3)
p <- prcomp(t(published.nozero))
plot(p$x[,1],p$x[,2],pch=20,col=colors,xlab=paste("PC1"),ylab=paste("PC2"),main="Published FPKM values \n n=13323")
plot(p$x[,2],p$x[,3],pch=20,col=colors,xlab=paste("PC2"),ylab=paste("PC3"),main="Published FPKM values \n n=13323")
par(mfrow=c(4,4))
for (i in 1:6){
for(j in 1:6){
if (i<j){
plot(p$x[,i],p$x[,j],pch=20,col=colors,xlab=paste("PC",i),ylab=paste("PC",j),main="Published FPKM values \n n=13323")
}
}
}
symbol <- read.table("ENSG_Symbol.txt",header=TRUE)
plot(p$x[,1],p$x[,2],pch=20,col=colors,xlab=paste("PC1"),ylab=paste("PC2"))
plot(p$x[,1],p$x[,2],pch=20,col=colors,xlab=paste("PC1"),ylab=paste("PC2"),main="Published FPKM values \n n=13323")
textxy(p$x[,1],p$x[,2],labs=rownames(p$x))
plot(p$x[,2],p$x[,3],pch=20,col=colors,xlab=paste("PC2"),ylab=paste("PC3"),main="Published FPKM values \n n=13323")
textxy(p$x[,1],p$x[,2],labs=rownames(p$x))
```
plot(p$x[,2],p$x[,3],pch=20,col=colors,xlab=paste("PC2"),ylab=paste("PC3"),main="Published FPKM values \n n=13323")
textxy(p$x[,2],p$x[,3],labs=rownames(p$x))
load.pc1 <- p$rotation[,1][order(p$rotation[,1])]
extreme.pc1 <- c(tail(load.pc1), head(load.pc1))
symbs <- vector()
extreme.pc1 <- c(tail(load.pc1), head(load.pc1))
head(extreme.pc1)
head(published.nozero)
head(names(published.nozero))
head(rownames(published.nozero))
cufflinks <- read.delim("fpkm_table_tophat.txt")
head(cufflinks)
cufflinks_data <- read.delim("fpkm_table_tophat.txt")
cufflinks <- cufflinks_data[,3:16]
cufflinks_data <- read.delim("fpkm_table_tophat.txt")
cufflinks <- cufflinks_data[,3:16]
rownames(cufflinks) <- cufflinks_data[,1]
pseudo <- 1
logs <- log2(cufflinks_pc_nozero[,3:16] + pseudo)
cufflinks.log <- cbind(f_pc_nozero[,1:2],logs)
cufflinks <- read.delim("fpkm_table_tophat.txt")
sampleinfo_cufflinks <- read.delim("sample_info_reprocessed.txt")
library(biomaRt)
gene_ids <- as.vector(cufflinks[,1])
ensembl = useMart("ensembl", dataset = "hsapiens_gene_ensembl") #select the ensembl database
gene_type <- getBM(attributes=c("ensembl_gene_id", "gene_biotype"),
filters = "ensembl_gene_id",
values=gene_ids,
mart=ensembl)
library(biomaRt)
gene_ids <- as.vector(cufflinks[,1])
ensembl = useMart("ensembl", dataset = "hsapiens_gene_ensembl") #select the ensembl database
gene_type <- getBM(attributes=c("ensembl_gene_id", "gene_biotype"),
filters = "ensembl_gene_id",
values=gene_ids,
mart=ensembl)
ensembl = useMart("ensembl", dataset = "hsapiens_gene_ensembl") #select the ensembl database
library(biomaRt)
gene_ids <- as.vector(cufflinks[,1])
ensembl = useMart("ensembl", dataset = "hsapiens_gene_ensembl") #select the ensembl database
cufflinks <- read.delim("fpkm_table_tophat.txt")
pseudo <- 1
logs <- log2(cufflinks_pc_nozero[,3:16] + pseudo)
library(pheatmap)
library(reshape)
library(gplots)
library(ops)
library(calibrate)
published <- read.delim("published_rpkms.txt",sep=" ")
sampleinfo_published <- read.table("sample_info_published.txt",header=TRUE)
dim(published)
published.nozero <- published[-which(rowSums(published[,])<=0.01),]
Heatmap of Spearman correlations between published expression profiles (# genes = 13,323)
published <- read.delim("published_rpkms.txt",sep=" ")
published.nozero <- published[-which(rowSums(published[,])<=0.01),]
pheatmap(cor(published.nozero, method="spearman"))
pheatmap(cor(published.nozero, method="spearman"))
pheatmap(cor(published.nozero))
?pheatmap
colors <- c(1, 2, 3, 1, 2, 1, 2, 3, 1, 2, 3)
p <- prcomp(t(published.nozero))
plot(p$x[,1],p$x[,2],pch=20,col=colors,xlab=paste("PC1"),ylab=paste("PC2"),main="Published FPKM values \n n=13323")
textxy(p$x[,1],p$x[,2],labs=rownames(p$x))
pheatmap(cor(published.nozero))
pheatmap(cor(published.nozero, method="spearman"))
View(published.nozero)
?correlogram
pairs
?pairs
panel.cor <- function(x, y, digits = 2, prefix = "", cex.cor, ...)
{
usr <- par("usr"); on.exit(par(usr))
par(usr = c(0, 1, 0, 1))
r <- abs(cor(x, y))
txt <- format(c(r, 0.123456789), digits = digits)[1]
txt <- paste0(prefix, txt)
if(missing(cex.cor)) cex.cor <- 0.8/strwidth(txt)
text(0.5, 0.5, txt, cex = cex.cor * r)
}
pairs(USJudgeRatings, lower.panel = panel.smooth, upper.panel = panel.cor)
?pairs
pairs(published.nozero)
install.packages("psych")
library(psych)
pairs.panels(published.nozero)
pairs.panels(published.nozero)
?pairs
panel.cor <- function(x, y, digits = 2, prefix = "", cex.cor, ...)
{
usr <- par("usr"); on.exit(par(usr))
par(usr = c(0, 1, 0, 1))
r <- abs(cor(x, y))
txt <- format(c(r, 0.123456789), digits = digits)[1]
txt <- paste0(prefix, txt)
if(missing(cex.cor)) cex.cor <- 0.8/strwidth(txt)
text(0.5, 0.5, txt, cex = cex.cor * r)
}
panel.cor <- function(x, y, digits = 2, prefix = "", cex.cor, ...)
+ {
+     usr <- par("usr"); on.exit(par(usr))
+     par(usr = c(0, 1, 0, 1))
+     r <- abs(cor(x, y))
+     txt <- format(c(r, 0.123456789), digits = digits)[1]
+     txt <- paste0(prefix, txt)
+     if(missing(cex.cor)) cex.cor <- 0.8/strwidth(txt)
+     text(0.5, 0.5, txt, cex = cex.cor * r) }
> pairs(USJudgeRatings, lower.panel = panel.smooth, upper.panel = panel.cor)
>
panel.cor <- function(x, y, digits = 2, prefix = "", cex.cor, ...)
{
usr <- par("usr"); on.exit(par(usr))
par(usr = c(0, 1, 0, 1))
r <- abs(cor(x, y))
txt <- format(c(r, 0.123456789), digits = digits)[1]
txt <- paste0(prefix, txt)
if(missing(cex.cor)) cex.cor <- 0.8/strwidth(txt)
text(0.5, 0.5, txt, cex = cex.cor * r)
}
pairs(USJudgeRatings, lower.panel = panel.smooth, upper.panel = panel.cor)
library(pheatmap)
library(reshape)
library(gplots)
library(ops)
library(calibrate)
published <- read.delim("published_rpkms.txt",sep=" ")
sampleinfo_published <- read.table("sample_info_published.txt",header=TRUE)
head)published
head(published)
sampleinfo_published <- read.table("sample_info_published.txt",header=TRUE)
sampleinfo_published
published.nozero <- published[-which(rowSums(published[,])<=0.01),]
pheatmap(cor(published.nozero, method="spearman"))
colors <- c(1, 2, 3, 1, 2, 1, 2, 3, 1, 2, 3)
p <- prcomp(t(published.nozero))
plot(p$x[,1],p$x[,2],pch=20,col=colors,xlab=paste("PC1"),ylab=paste("PC2"),main="Published FPKM values \n n=13323")
textxy(p$x[,1],p$x[,2],labs=rownames(p$x))
plot(p$x[,2],p$x[,3],pch=20,col=colors,xlab=paste("PC2"),ylab=paste("PC3"),main="Published FPKM values \n n=13323")
symbol <- read.table("ENSG_Symbol.txt",header=TRUE)
plot(p$x[,1],p$x[,2],pch=20,col=colors,xlab=paste("PC1"),ylab=paste("PC2"))
textxy(p$x[,1],p$x[,2],labs=rownames(p$x))
load.pc1 <- p$rotation[,1][order(p$rotation[,1])]
extreme.pc1 <- c(tail(load.pc1), head(load.pc1))
symbs <- vector()
for (n in names(extreme.pc1)){
temp <- as.character(symbol[symbol[,1] == n,2])
if (length(temp)>1) temp <- temp[1]
symbs <- c(symbs, temp)
}
barplot(extreme.pc1, names.arg=symbs, las=2, main="Genes w highest absolute loadings in PC1 (raw RPKM)")
plot(p$x[,1],p$x[,2],pch=20,col=colors,xlab=paste("PC1"),ylab=paste("PC2"))
textxy(p$x[,1],p$x[,2],labs=rownames(p$x))
m <- melt(published.nozero)
colnames(m) <- c("sample_ID","RPKM")
meta <- sampleinfo_published[,c("Study","Tissue","Preparation","NumberRaw","Numbermapped","Readtype")]
rownames(meta) <- colnames(published.nozero)
tissue <- rep(meta$Tissue, each=nrow(published.nozero))
study <- rep(meta$Study, each=nrow(published.nozero))
prep <- rep(meta$Preparation, each=nrow(published.nozero))
layout <- rep(meta$Readtype, each=nrow(published.nozero))
raw <- rep(meta$NumberRaw, each=nrow(published.nozero))
mapped <- rep(meta$Numbermapped, each=nrow(published.nozero))
data <- data.frame(m, tissue=tissue, study=study, prep=prep, layout=layout,nraw=raw,nmapped=mapped)
subset <- data[sample(1:nrow(data), 1000),]
fit <- lm(RPKM ~ study + nraw + layout + prep + tissue, data=data)
a <- anova(fit)
maxval = 3000
barplot(a$"F value"[-7],names.arg=rownames(a)[-7],main="Anova F score, Raw RPKM",ylim=c(0,maxval))
print(a)
?lm
m <- melt(published.nozero)
colnames(m) <- c("sample_ID","RPKM")
meta <- sampleinfo_published[,c("Study","Tissue","Preparation","NumberRaw","Numbermapped","Readtype")]
rownames(meta) <- colnames(published.nozero)
tissue <- rep(meta$Tissue, each=nrow(published.nozero))
study <- rep(meta$Study, each=nrow(published.nozero))
prep <- rep(meta$Preparation, each=nrow(published.nozero))
layout <- rep(meta$Readtype, each=nrow(published.nozero))
raw <- rep(meta$NumberRaw, each=nrow(published.nozero))
mapped <- rep(meta$Numbermapped, each=nrow(published.nozero))
data <- data.frame(m, tissue=tissue, study=study, prep=prep, layout=layout,nraw=raw,nmapped=mapped)
subset <- data[sample(1:nrow(data), 1000),]
fit <- lm(RPKM ~ study + nraw + layout + prep + tissue, data=data)
head(fit)
View(sampleinfo_published)
fit <- lm(RPKM ~ study + nraw + layout + prep + tissue, data=data)
a <- anova(fit)
maxval = 3000
barplot(a$"F value"[-7],names.arg=rownames(a)[-7],main="Anova F score, Raw RPKM",ylim=c(0,maxval))
a
f <- read.delim("published_rpkms.txt",sep=" ")
sampleinfo <- read.table("sample_info_published.txt",header=TRUE)
f.nozero <- f[-which(rowSums(f[,])<=0.01),]
pheatmap(cor(f.nozero, method="spearman"))
pheatmap(cor(f.nozero))
library(reshape)
m <- melt(f.nozero)
colnames(m) <- c("sample_ID","RPKM")
meta <- sampleinfo[,c("Study","Tissue","Preparation","NumberRaw","Numbermapped","Readtype")]
rownames(meta) <- colnames(f.nozero)
tissue <- rep(meta$Tissue, each=nrow(f.nozero))
study <- rep(meta$Study, each=nrow(f.nozero))
prep <- rep(meta$Preparation, each=nrow(f.nozero))
layout <- rep(meta$Readtype, each=nrow(f.nozero))
raw <- rep(meta$NumberRaw, each=nrow(f.nozero))
mapped <- rep(meta$Numbermapped, each=nrow(f.nozero))
data <- data.frame(m, tissue=tissue, study=study, prep=prep, layout=layout,nraw=raw,nmapped=mapped)
subset <- data[sample(1:nrow(data), 1000),]
fit <- lm(RPKM ~ study + nraw + layout + prep + tissue, data=data)
a <- anova(fit)
maxval = 3000
barplot(a$"F value"[-7],names.arg=rownames(a)[-7],main="Anova F score, Raw RPKM",ylim=c(0,maxval))
pseudo <- 1
published.log <- log2(published.nozero + pseudo)
pheatmap(cor(published.log))
pheatmap(cor(published.log), method="spearman")
pheatmap(cor(published.log))
, method="spearman"
pheatmap(cor(published.log))
pheatmap(cor(published.log),method="spearman")
colors <- c(1, 2, 3, 1, 2, 1, 2, 3, 1, 2, 3)
p.log <- prcomp(t(published.log))
plot(p.log$x[,1],p.log$x[,2],pch=20,col=colors,xlab=paste("PC1"),ylab=paste("PC2"),main="log2 Published FPKM values \n n=13323")
textxy(p$x[,1],p$x[,2],labs=rownames(p.log$x))
textxy(p.log$x[,1],p.log$x[,2],labs=rownames(p.log$x))
plot(p.log$x[,2],p.log$x[,3],pch=20,col=colors,xlab=paste("PC2"),ylab=paste("PC3"),main="log2 Published FPKM values \n n=13323")
textxy(p.log$x[,2],p.log$x[,3],labs=rownames(p.log$x))
plot(p.log$x[,2],p.log$x[,3],pch=20,col=colors,xlab=paste("PC2"),ylab=paste("PC3"),main="log2 Published FPKM values \n n=13323")
textxy(p.log$x[,2],p.log$x[,3],labs=rownames(p.log$x))
symbol <- read.table("ENSG_Symbol.txt",header=TRUE)
plot(p.log$x[,1],p.log$x[,2],pch=20,col=colors,xlab=paste("PC1"),ylab=paste("PC2"))
textxy(p.log$x[,1],p.log$x[,2],labs=rownames(p$x))
load.pc1 <- p.log$rotation[,1][order(p.log$rotation[,1])]
extreme.pc1 <- c(tail(load.pc1), head(load.pc1))
symbs <- vector()
for (n in names(extreme.pc1)){
temp <- as.character(symbol[symbol[,1] == n,2])
if (length(temp)>1) temp <- temp[1]
symbs <- c(symbs, temp)
}
barplot(extreme.pc1, names.arg=symbs, las=2, main="Genes w highest absolute loadings in PC1 (log2RPKM)")
load.pc2 <- p.log$rotation[,2][order(p.log$rotation[,2])]
extreme.pc2 <- c(tail(load.pc2), head(load.pc2))
symbs <- vector()
for (n in names(extreme.pc2)){
temp <- as.character(symbol[symbol[,1] == n,2])
if (length(temp)>1) temp <- temp[1]
symbs <- c(symbs, temp)
}
barplot(extreme.pc2, names.arg=symbs, las=2, main="Genes w highest absolute loadings in PC2 (log2RPKM)")
extreme.pc2
published[published[,1]=="ENSG00000168314",]
head(published)
published[rownames(published)=="ENSG00000168314",]
published[rownames(published)=="ENSG00000104833",]
published[rownames(published)=="ENSG00000104435",]
published[rownames(published)=="ENSG00000132639",]
extreme.pc2
published[rownames(published)=="ENSG00000123560",]
published[rownames(published)=="ENSG00000131095",]
published[rownames(published)=="ENSG00000111245",]
published[rownames(published)=="ENSG00000114854",]
published[rownames(published)=="ENSG00000160808",]
published[rownames(published)=="ENSG00000198125",]
extreme.pc2
published[rownames(published)=="ENSG00000104879",]
published[rownames(published)=="ENSG00000159251",]
load.pc3 <- p.log$rotation[,3][order(p$rotation[,3])]
extreme.pc3 <- c(tail(load.pc3), head(load.pc3))
symbs <- vector()
for (n in names(extreme.pc3)){
temp <- as.character(symbol[symbol[,1] == n,2])
if (length(temp)>1) temp <- temp[1]
symbs <- c(symbs, temp)
}
barplot(extreme.pc3, names.arg=symbs, las=2, main="Genes w highest absolute loadings in PC3 (log2RPKM)")
extreme.pc3
published[rownames(published)=="ENSG00000111245",]
published[rownames(published)=="ENSG00000101608",]
published[rownames(published)=="ENSG00000175206",]
published[rownames(published)=="ENSG00000175084",]
published[rownames(published)=="ENSG00000159251",]
published[rownames(published)=="ENSG00000129991",]
published[rownames(published)=="ENSG00000167996",]
published[rownames(published)=="ENSG00000118194",]
published[rownames(published)=="ENSG00000125971",]
published[rownames(published)=="ENSG00000075624",]
published[rownames(published)=="ENSG00000071082",]
published[rownames(published)=="ENSG00000106211",]
p.log <- prcomp(t(published.log))
plot(p.log$x[,1],p.log$x[,2],pch=20,col=colors,xlab=paste("PC1"),ylab=paste("PC2"),main="log2 Published FPKM values \n n=13323")
textxy(p.log$x[,1],p.log$x[,2],labs=rownames(p.log$x))
library(sva)
meta <- data.frame(study=c(rep("HPA",3),rep("AltIso",2),rep("GTex",3),rep("Atlas",3)),tissue=c("Heart","Brain","Kidney","Heart","Brain","Heart","Brain","Kidney","Heart","Brain","Kidney"))
meta <- data.frame(study=c(rep("HPA",3),rep("AltIso",2),rep("GTex",3),rep("Atlas",3)),tissue=c("Heart","Brain","Kidney","Heart","Brain","Heart","Brain","Kidney","Heart","Brain","Kidney"))
batch <- meta$study
design <- model.matrix(~as.factor(tissue),data=meta)
combat <- ComBat(dat=published.log,batch=batch,mod=design,numCovs=NULL,par.prior=TRUE)
pheatmap(cor(combat, method="spearman"))
colors <- c(1, 2, 3, 1, 2, 1, 2, 3, 1, 2, 3)
p.combat <- prcomp(t(combat))
plot(p.combat$x[,1],p.combat$x[,2],pch=20,col=colors,xlab=paste("PC1"),ylab=paste("PC2"),main="Published FPKM values \n COMBAT \n n=13323")
textxy(p.combat$x[,1],p.log$x[,2],labs=rownames(p.combat$x))
head(p.combat)
head(p.combat)
plot(p.combat$x[,1],p.combat$x[,2],pch=20,col=colors,xlab=paste("PC1"),ylab=paste("PC2"),main="Published FPKM values \n COMBAT \n n=13323")
textxy(p.combat$x[,1],p.log$x[,2],labs=names(p.combat$x))
textxy(p.combat$x[,1],p.log$x[,2],labs=rownames(p.combat$x))
plot(p.combat$x[,2],p.combat$x[,3],pch=20,col=colors,xlab=paste("PC2"),ylab=paste("PC3"),main="Published FPKM values \n COMBAT \n n=13323")
par(mfrow=c(4,4))
for (i in 1:6){
for(j in 1:6){
if (i<j){
plot(p.combat$x[,i],p.combat$x[,j],pch=20,col=colors,xlab=paste("PC",i),ylab=paste("PC",j),main="Published FPKM values \n COMBAT \ n=13323")
}
}
}
par(mfrow=c(4,4))
for (i in 1:6){
for(j in 1:6){
if (i<j){
plot(p.combat$x[,i],p.combat$x[,j],pch=20,col=colors,xlab=paste("PC",i),ylab=paste("PC",j),main="Published FPKM values \n COMBAT \ n=13323")
}
}
}
symbol <- read.table("ENSG_Symbol.txt",header=TRUE)
plot(p.combat$x[,1],p.combat$x[,2],pch=20,col=colors,xlab=paste("PC1"),ylab=paste("PC2"))
textxy(p.combat$x[,1],p.combat$x[,2],labs=rownames(p$x))
load.pc1 <- p.combat$rotation[,1][order(p.combat$rotation[,1])]
extreme.pc1 <- c(tail(load.pc1), head(load.pc1))
symbs <- vector()
for (n in names(extreme.pc1)){
temp <- as.character(symbol[symbol[,1] == n,2])
if (length(temp)>1) temp <- temp[1]
symbs <- c(symbs, temp)
}
barplot(extreme.pc1, names.arg=symbs, las=2, main="Genes w highest absolute loadings in PC1 (COMBAT)")
m <- melt(combat)
colnames(m) <- c("sample_ID","combat")
data <- data.frame(m, tissue=tissue, study=study, prep=prep, layout=layout,nraw=raw,nmapped=mapped)
fit <- lm(combat ~ study + nraw + layout + prep + tissue, data=data)
c <- anova(fit)
maxval <- 500
barplot(c$"F value"[-7],names.arg=rownames(b)[-7],main="Anova F score, Combat",ylim=c(0,maxval))
print(c)
maxval <- 500
barplot(c$"F value"[-7],names.arg=rownames(c)[-7],main="Anova F score, Combat",ylim=c(0,maxval))
cufflinks <- read.delim("fpkm_table_tophat.txt")
sampleinfo_cufflinks <- read.delim("sample_info_reprocessed.txt")
library(biomaRt)
gene_ids <- as.vector(cufflinks[,1])
ensembl = useMart("ensembl", dataset = "hsapiens_gene_ensembl") #select the ensembl database
gene_type <- getBM(attributes=c("ensembl_gene_id", "gene_biotype"),
filters = "ensembl_gene_id",
values=gene_ids,
mart=ensembl)
pc <- subset(gene_type[,1],gene_type[,2]=="protein_coding")
cufflinks_pc <- cufflinks[match(pc,cufflinks[,1]),]
cufflinks_pc_nozero <- cufflinks_pc[-which(rowSums(cufflinks_pc[,3:16])<=0.01),]
pheatmap(cor(cufflinks_pc_nozero[,3:16], method="spearman"))
pheatmap(cor(published.nozero, method="spearman"))
pheatmap(cor(cufflinks_pc_nozero[,3:16], method="spearman"))
colors <- c(2,1,3,2,1,3,2,1,3,2,1,3,2,1)
p.cufflinks <- prcomp(t(cufflinks_pc_nozero[,3:16]))
plot(p.cufflinks$x[,1],p.cufflinks$x[,2],pch=20,col=colors,xlab=paste("PC1"),ylab=paste("PC2"),main="Reprocessed FPKM values \n n=19475")
textxy(p.cufflinks$x[,1],p.cufflinks$x[,2],labs=rownames(p.log$x))
plot(p.cufflinks$x[,1],p.cufflinks$x[,2],pch=20,col=colors,xlab=paste("PC1"),ylab=paste("PC2"),main="Reprocessed FPKM values \n n=19475")
textxy(p.cufflinks$x[,1],p.cufflinks$x[,2],labs=rownames(p.cufflinks$x))
plot(p.cufflinks$x[,2],p.cufflinks$x[,3],pch=20,col=colors,xlab=paste("PC2"),ylab=paste("PC3"),main="Reprocessed FPKM values \n n=19475")
textxy(p.cufflinks$x[,2],p.cufflinks$x[,3],labs=rownames(p.cufflinks$x))
plot(p.cufflinks$x[,1],p.cufflinks$x[,2],pch=20,col=colors,xlab=paste("PC1"),ylab=paste("PC2"),main="Reprocessed FPKM values \n n=19475")
textxy(p.cufflinks$x[,1],p.cufflinks$x[,2],labs=rownames(p.cufflinks$x))
par(mfrow=c(1,1))
symbol <- read.table("ENSG_Symbol.txt",header=TRUE)
fpkms <- cufflinks_pc_nozero[,3:16]
rownames(fpkms) <- cufflinks_pc_nozero[,1]
p <- prcomp(t(fpkms))
plot(p$x[,1],p$x[,2],pch=20,col=colors,xlab=paste("PC1"),ylab=paste("PC2"))
textxy(p$x[,1],p$x[,2],labs=rownames(p$x))
load.pc1 <- p$rotation[,1][order(p$rotation[,1])]
extreme.pc1 <- c(tail(load.pc1), head(load.pc1))
symbs <- vector()
for (n in names(extreme.pc1)){
temp <- as.character(symbol[symbol[,1] == n,2])
if (length(temp)>1) temp <- temp[1]
symbs <- c(symbs, temp)
}
barplot(extreme.pc1, names.arg=symbs, las=2, main="Genes w highest absolute loadings in PC1 (raw Cufflinks FPKM)")
load.pc2 <- p$rotation[,2][order(p$rotation[,2])]
extreme.pc2 <- c(tail(load.pc2), head(load.pc2))
symbs <- vector()
for (n in names(extreme.pc2)){
temp <- as.character(symbol[symbol[,1] == n,2])
if (length(temp)>1) temp <- temp[1]
symbs <- c(symbs, temp)
}
barplot(extreme.pc2, names.arg=symbs, las=2, main="Genes w highest absolute loadings in PC2 (raw Cufflinks FPKM)")
load.pc3 <- p$rotation[,3][order(p$rotation[,3])]
extreme.pc3 <- c(tail(load.pc3), head(load.pc3))
symbs <- vector()
for (n in names(extreme.pc3)){
temp <- as.character(symbol[symbol[,1] == n,2])
if (length(temp)>1) temp <- temp[1]
symbs <- c(symbs, temp)
}
barplot(extreme.pc3, names.arg=symbs, las=2, main="Genes w highest absolute loadings in PC3 (raw Cufflinks FPKM)")
