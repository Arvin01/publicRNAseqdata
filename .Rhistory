}
plot.loadings.SVD <- function(m, comp=1, cutoff=0.1, gene.ids = rownames(m)){
l <- loadings.SVD(m, comp, gene.ids)
barplot(l[abs(l)>cutoff],las=2,main=paste("PC", comp, "cutoff", cutoff),cex.names=0.6)
}
plotPC <- function(matrix,a,b,desc,colors){
eig <- do.SVD(matrix, a, b)
proj <- project.SVD(matrix, eig)
xminv <- min(proj[,1]) - .2 * abs(min(proj[,1]))
xmaxv <- max(proj[,1]) + .2 * abs(max(proj[,1]))
yminv <- min(proj[,2]) - .2 * abs(min(proj[,2]))
ymaxv <- max(proj[,2]) + .2 * abs(max(proj[,2]))
plot(proj,pch=20,xlim=c(xminv,xmaxv),ylim=c(yminv,ymaxv),xaxt='n',yaxt='n',xlab=paste0("PC",a),ylab=paste("PC",b),col=colors,main=desc)
textxy(proj[,1],proj[,2],labs=rownames(proj))
}
colors <- c(2,1,3,2,1,3,2,1,3,2,1,3,2,1)
plotPC(f_pc_nozero[,3:16], 1, 2, "Reprocessed FPKM values \n SVD \n n=19524", colors=colors)
plotPC(f_pc_nozero[,3:16], 2, 3, "Reprocessed FPKM values \n SVD \n n=19524", colors=colors)
plotPC(fpkms.log, 1, 2, desc="Reprocessed F/RPKM values, log2 \n SVD \n n=13333", colors=colors)
plotPC(fpkms.log, 2, 3, desc="Published FPKM values, log2 \n SVD \n n=13333", colors=colors)
library(sva)
meta <- data.frame(study=c(rep("EoGE",3),rep("Atlas",3),rep("BodyMap",3),rep("HPA",3),rep("AltIso",2)),tissue=c("Brain","Heart","Kidney","Brain","Heart","Kidney","Brain","Heart","Kidney","Brain","Heart","Kidney","Brain","Heart"),prep=c(rep("poly-A",3),rep("rRNA-depl",3),rep("poly-A",8)),layout=c(rep("PE",3),rep("SE",3),rep("PE",6),rep("SE",2)))
batch <- meta$study
design <- model.matrix(~as.factor(tissue),data=meta)
combat <- ComBat(dat=fpkms.log[,],batch=batch,mod=design,numCovs=NULL,par.prior=TRUE)
write.table(combat, file="reprocessed_rpkms_combat_log2.txt", quote=F)
pheatmap(cor(combat))
plotPC(combat,1,2,colors=colors,desc="Reprocessed F/RPKM values, ComBat on log2 values \n SVD \n n=19475")
plotPC(combat,2,3,colors=colors,desc="Published F/RPKM values, ComBat adjusted log2 TMM values \n SVD \n n=13333")
colors <- c(2,1,3,2,1,3,2,1,3,2,1,3,2,1)
plotPC(f_pc_nozero[,3:16], 1, 2, "Reprocessed FPKM values \n SVD \n n=19524", colors=colors)
plotPC(f_pc_nozero[,3:16], 2, 3, "Reprocessed FPKM values \n SVD \n n=19524", colors=colors)
head(f_pc_nozero)
EoGE_b <- rownames(f_pc[order(f$EoGE__brain,decreasing=T),][1:100,])
EoGE_h <- rownames(f[order(f$EoGE_heart,decreasing=T),][1:100,])
EoGE_k <- rownames(f[order(f$EoGE_kidney,decreasing=T),][1:100,])
Atlas_b <- rownames(f[order(f_pc$Atlas_brain,decreasing=T),][1:100,])
Atlas_h <- rownames(f[order(f_pc$Atlas_heart,decreasing=T),][1:100,])
Atlas_k <- rownames(f[order(f_pc$Atlas_kidney,decreasing=T),][1:100,])
BodyMap_b <- rownames(f[order(f_pc$BodyMap_brain,decreasing=T),][1:100,])
BodyMap_h <- rownames(f[order(f_pc$BodyMap_heart,decreasing=T),][1:100,])
BodyMap_k <- rownames(f[order(f_pc$BodyMap_kidney,decreasing=T),][1:100,])
EoGE_b <- rownames(f_pc[order(f$EoGE_brain,decreasing=T),][1:100,])
library(VennDiagram)
EoGE_b <- rownames(f_pc[order(f_pc$EoGE_brain,decreasing=T),][1:100,])
EoGE_h <- rownames(f_pc[order(f_pc$EoGE_heart,decreasing=T),][1:100,])
EoGE_k <- rownames(f_pc[order(f_pc$EoGE_kidney,decreasing=T),][1:100,])
Atlas_b <- rownames(f_pc[order(f_pc$Atlas_brain,decreasing=T),][1:100,])
Atlas_h <- rownames(f_pc[order(f_pc$Atlas_heart,decreasing=T),][1:100,])
Atlas_k <- rownames(f_pc[order(f_pc$Atlas_kidney,decreasing=T),][1:100,])
BodyMap_b <- rownames(f_pc[order(f_pc$BodyMap_brain,decreasing=T),][1:100,])
BodyMap_h <- rownames(f_pc[order(f_pc$BodyMap_heart,decreasing=T),][1:100,])
BodyMap_k <- rownames(f_pc[order(f_pc$BodyMap_kidney,decreasing=T),][1:100,])
HPA_b <- rownames(f_pc[order(f_pc$HPA_brain,decreasing=T),][1:100,])
HPA_h <- rownames(f_pc[order(f_pc$HPA_heart,decreasing=T),][1:100,])
HPA_k <- rownames(f_pc[order(f_pc$HPA_kidney,decreasing=T),][1:100,])
AltIso_b <- rownames(f_pc[order(f_pc$AltIso_brain,decreasing=T),][1:100,])
AltIso_h <- rownames(f_pc[order(f_pc$AltIso_heart,decreasing=T),][1:100,])
f <- read.delim("/Users/fridadanielsson/Documents/Projekt/Publika_dataset/manuscript/PCA/data/published_rpkms.txt",sep=" ")
f <- read.delim("/Users/fridadanielsson/Documents/Projekt/Publika_dataset/manuscript/PCA/data/published_rpkms.txt",sep=" ")
library(edgeR)
library(pheatmap)
library(gplots)
library(ops)
library(calibrate)
library(VennDiagram)
HPA_b <- rownames(f[order(f$HPA_brain,decreasing=T),][1:100,])
HPA_h <- rownames(f[order(f$HPA_heart,decreasing=T),][1:100,])
HPA_k <- rownames(f[order(f$HPA_kidney,decreasing=T),][1:100,])
AltIso_b <- rownames(f[order(f$AltIso_brain,decreasing=T),][1:100,])
AltIso_h <- rownames(f[order(f$AltIso_heart,decreasing=T),][1:100,])
GTEx_b <- rownames(f[order(f$GTEx_brain,decreasing=T),][1:100,])
GTEx_h <- rownames(f[order(f$GTEx_heart,decreasing=T),][1:100,])
GTEx_k <- rownames(f[order(f$GTEx_kidney,decreasing=T),][1:100,])
Atlas_b <- rownames(f[order(f$Atlas_brain,decreasing=T),][1:100,])
Atlas_h <- rownames(f[order(f$Atlas_heart,decreasing=T),][1:100,])
Atlas_k <- rownames(f[order(f$Atlas_kidney,decreasing=T),][1:100,])
b_Ids <- list(HPA_b,AltIso_b,GTEx_b,Atlas_b)
draw.quad.venn(100, 100, 100, 100,
length(intersect(HPA_b,AltIso_b)),
length(intersect(HPA_b,GTEx_b)),
length(intersect(HPA_b,Atlas_b)),
length(intersect(AltIso_b,GTEx_b)),
length(intersect(AltIso_b,Atlas_b)),
length(intersect(GTEx_b,Atlas_b)),
length(intersect(intersect(HPA_b,AltIso_b),GTEx_b)),
length(intersect(intersect(HPA_b,AltIso_b),Atlas_b)),
length(intersect(intersect(HPA_b,GTEx_b),Atlas_b)),
length(intersect(intersect(AltIso_b,GTEx_b),Atlas_b)),
length(intersect(intersect(HPA_b,AltIso_b),intersect(Atlas_b,GTEx_b))),
category = c("HPA","AltIso","GTEx","Atlas"), lwd = rep(0, 4), lty = rep("solid", 4),
fill = c("mistyrose","steelblue","lightgoldenrod","darkseagreen")
)
length(intersect(EoGE_b,Atlas_b))
EoGE_b <- rownames(f_pc[order(f_pc$EoGE_brain,decreasing=T),][1:100,])
EoGE_h <- rownames(f_pc[order(f_pc$EoGE_heart,decreasing=T),][1:100,])
EoGE_k <- rownames(f_pc[order(f_pc$EoGE_kidney,decreasing=T),][1:100,])
Atlas_b <- rownames(f_pc[order(f_pc$Atlas_brain,decreasing=T),][1:100,])
Atlas_h <- rownames(f_pc[order(f_pc$Atlas_heart,decreasing=T),][1:100,])
Atlas_k <- rownames(f_pc[order(f_pc$Atlas_kidney,decreasing=T),][1:100,])
length(intersect(EoGE_b,Atlas_b))
library(pheatmap)
library(edgeR)
library(calibrate)
f <- read.delim("fpkm_table_tophat.txt")
do.SVD = function(m, comp.1=1, comp.2=2){ # returns eig.cell
s <- svd(m)
ev <- s$d^2 / sum(s$d^2)
return(s$u[,c(comp.1, comp.2)])
}
project.SVD <- function(m, eig.cell){
return(t(m) %*% eig.cell)
}
plot.SVD <- function(m, comp.1=1, comp.2=2, groups=rep("blue", ncol(m)), title=""){
eig <- do.SVD(m, comp.1, comp.2)
proj <- project.SVD(m, eig)
xminv <- min(proj[,1]) # - .2 * abs(min(proj[,1]))
xmaxv <- max(proj[,1]) # + .2 * abs(max(proj[,1]))
yminv <- min(proj[,2]) # - .2 * abs(min(proj[,2]))
ymaxv <- max(proj[,2]) # + .2 * abs(max(proj[,2]))
plot(proj,pch=20,col="white",xlim=c(xminv,xmaxv),ylim=c(yminv,ymaxv),xaxt='n',yaxt='n',xlab="PC1",ylab="PC2",main=title)
points(proj, col=as.character(groups),pch=20) # , #pch=c(rep(15,3),rep(17,3),rep(19,3),rep(18,3),rep(20,2)), cex=2)
textxy(proj[,1],proj[,2],labs=colnames(m))
}
loadings.SVD <- function(m, comp=1, gene.ids = rownames(m)){
s <- svd(m)
l <- s$u[,comp]
names(l) <- gene.ids
l.s <- l[order(l)]
return(l.s)
}
plotPC <- function(matrix,a,b,desc,colors){
eig <- do.SVD(matrix, a, b)
proj <- project.SVD(matrix, eig)
xminv <- min(proj[,1]) - .2 * abs(min(proj[,1]))
xmaxv <- max(proj[,1]) + .2 * abs(max(proj[,1]))
yminv <- min(proj[,2]) - .2 * abs(min(proj[,2]))
ymaxv <- max(proj[,2]) + .2 * abs(max(proj[,2]))
plot(proj,pch=20,xlim=c(xminv,xmaxv),ylim=c(yminv,ymaxv),xaxt='n',yaxt='n',xlab=paste0("PC",a),ylab=paste("PC",b),col=colors,main=desc)
textxy(proj[,1],proj[,2],labs=rownames(proj))
}
library(biomaRt)
f_ids <- as.vector(f[,1])
ensembl = useMart("ensembl", dataset = "hsapiens_gene_ensembl") #select the ensembl database
gene_type <- getBM(attributes=c("ensembl_gene_id", "gene_biotype"),
filters = "ensembl_gene_id",
values=f_ids,
mart=ensembl)
pc <- subset(gene_type[,1],gene_type[,2]=="protein_coding")
f_pc <- f[match(pc,f[,1]),]
f_pc_nozero <- f_pc[-which(rowSums(f_pc[,3:16])<=0.01),]
pheatmap(cor(f_pc_nozero[,3:16], method="spearman"))
pheatmap(cor(f_pc_nozero[,3:16]))
pseudo <- 1
fpkms.log <- log2(f_pc_nozero[,3:16] + pseudo)
pheatmap(cor(fpkms.log[,]))
pheatmap(cor(f_pc_nozero[,3:16], method="spearman"))
f.nolow <- f_pc_nozero[-which(rowMeans(f_pc_nozero[,3:16])<1),]
pheatmap(cor(log2(f.nolow[,3:16] + pseudo)))
colors <- c(2,1,3,2,1,3,2,1,3,2,1,3,2,1)
plotPC(f_pc_nozero[,3:16], 1, 2, "Reprocessed FPKM values \n SVD \n n=19524", colors=colors)
plotPC(f_pc_nozero[,3:16], 2, 3, "Reprocessed FPKM values \n SVD \n n=19524", colors=colors)
colors <- c(2,1,3,2,1,3,2,1,3,2,1,3,2,1)
par(mfrow=c(4,4))
for (i in 1:6){
for(j in 1:6){
if (i<j){
plotPC(f_pc_nozero[,3:16],i,j,desc="",colors=colors)
}
}
}
plotPC(fpkms.log, 1, 2, desc="Reprocessed F/RPKM values, log2 \n SVD \n n=19475", colors=colors)
plotPC(fpkms.log, 2, 3, desc="Reprocessed FPKM values, log2 \n SVD \n n=19475", colors=colors)
library(sva)
meta <- data.frame(study=c(rep("EoGE",3),rep("Atlas",3),rep("BodyMap",3),rep("HPA",3),rep("AltIso",2)),tissue=c("Brain","Heart","Kidney","Brain","Heart","Kidney","Brain","Heart","Kidney","Brain","Heart","Kidney","Brain","Heart"),prep=c(rep("poly-A",3),rep("rRNA-depl",3),rep("poly-A",8)),layout=c(rep("PE",3),rep("SE",3),rep("PE",6),rep("SE",2)))
batch <- meta$study
design <- model.matrix(~as.factor(tissue),data=meta)
combat <- ComBat(dat=fpkms.log[,],batch=batch,mod=design,numCovs=NULL,par.prior=TRUE)
pheatmap(cor(combat))
library(reshape)
m <- melt(f)
colnames(m) <- c("sample_ID","Cuff_FPKM")
meta <- data.frame(tissue=c("brain","heart","kidney","brain","heart","kidney","brain","heart","kidney","brain","heart","kidney","brain","heart"),study=c("EoGE","EoGE","EoGE","Atlas","Atlas","Atlas","BodyMap","BodyMap","BodyMap","HPA","HPA","HPA","AltIso","AltIso"),prep=c(rep("poly-A",3),rep("rRNA-depl",3),rep("poly-A",8)),layout=c(rep("PE",3),rep("SE",3),rep("PE",6),rep("SE",2)))
rownames(meta) <- colnames(f)
tissue <- rep(meta$tissue, each=nrow(f))
study <- rep(meta$study, each=nrow(f))
prep <- rep(meta$prep, each=nrow(f))
layout <- rep(meta$layout, each=nrow(f))
data <- data.frame(m, tissue=tissue, study=study, prep=prep, layout=layout)
#subset <- data[sample(1:nrow(data), 1000),]
fit <- lm(Cuff_FPKM ~ prep + layout + study + tissue, data=data)
a <- anova(fit)
maxval = 100
barplot(a$"F value"[-5],names.arg=rownames(a)[-5],main="Anova F score, Cufflinks FPKM",ylim=c(0,maxval))
a <- anova(fit)
fit <- lm(Cuff_FPKM ~ prep + layout + study + tissue, data=data)
plotPC(combat,1,2,colors=colors,desc="Reprocessed F/RPKM values, ComBat on log2 values \n SVD \n n=19475")
plotPC(combat,2,3,colors=colors,desc="Reprocessed F/RPKM values, ComBat on log2 values \n SVD \n n=19475")
head(f)
?melt
head(m)
head(meta)
head(data)
?lm
library(reshape)
m <- melt(f)
colnames(m) <- c("sample_ID","Cuff_FPKM")
meta <- data.frame(tissue=c("brain","heart","kidney","brain","heart","kidney","brain","heart","kidney","brain","heart","kidney","brain","heart"),study=c("EoGE","EoGE","EoGE","Atlas","Atlas","Atlas","BodyMap","BodyMap","BodyMap","HPA","HPA","HPA","AltIso","AltIso"),prep=c(rep("poly-A",3),rep("rRNA-depl",3),rep("poly-A",8)),layout=c(rep("PE",3),rep("SE",3),rep("PE",6),rep("SE",2)))
rownames(meta) <- colnames(f)
tissue <- rep(meta$tissue, each=nrow(f))
study <- rep(meta$study, each=nrow(f))
prep <- rep(meta$prep, each=nrow(f))
layout <- rep(meta$layout, each=nrow(f))
data <- data.frame(m, tissue=tissue, study=study, prep=prep, layout=layout)
#subset <- data[sample(1:nrow(data), 1000),]
fit <- lm(Cuff_FPKM ~ prep + layout + study + tissue, data=data)
a <- anova(fit)
maxval = 100
head(a)
m <- melt(f)
library(reshape)
m <- melt(f)
View(m)
colnames(m) <- c("sample_ID","Cuff_FPKM")
View(m)
colnames(m) <- c("sample_ID","Cuff_FPKM")
meta <- data.frame(tissue=c("brain","heart","kidney","brain","heart","kidney","brain","heart","kidney","brain","heart","kidney","brain","heart"),study=c("EoGE","EoGE","EoGE","Atlas","Atlas","Atlas","BodyMap","BodyMap","BodyMap","HPA","HPA","HPA","AltIso","AltIso"),prep=c(rep("poly-A",3),rep("rRNA-depl",3),rep("poly-A",8)),layout=c(rep("PE",3),rep("SE",3),rep("PE",6),rep("SE",2)))
rownames(meta) <- colnames(f)
rownames(meta) <- colnames(f)
m <- melt(f)
barplot(a$"F value"[-5],names.arg=rownames(a)[-5],main="Anova F score, Cufflinks FPKM",ylim=c(0,maxval))
library(reshape2)
m <- melt(f)
colnames(m) <- c("sample_ID","Cuff_FPKM")
meta <- data.frame(tissue=c("brain","heart","kidney","brain","heart","kidney","brain","heart","kidney","brain","heart","kidney","brain","heart"),study=c("EoGE","EoGE","EoGE","Atlas","Atlas","Atlas","BodyMap","BodyMap","BodyMap","HPA","HPA","HPA","AltIso","AltIso"),prep=c(rep("poly-A",3),rep("rRNA-depl",3),rep("poly-A",8)),layout=c(rep("PE",3),rep("SE",3),rep("PE",6),rep("SE",2)))
rownames(meta) <- colnames(f)
tissue <- rep(meta$tissue, each=nrow(f))
study <- rep(meta$study, each=nrow(f))
prep <- rep(meta$prep, each=nrow(f))
layout <- rep(meta$layout, each=nrow(f))
data <- data.frame(m, tissue=tissue, study=study, prep=prep, layout=layout)
#subset <- data[sample(1:nrow(data), 1000),]
fit <- lm(Cuff_FPKM ~ prep + layout + study + tissue, data=data)
a <- anova(fit)
maxval = 100
```
f
str(f)
head(m)
m <- melt(f)
colnames(m) <- c("sample_ID","Cuff_FPKM")
head(m)
dim(m)
meta <- data.frame(tissue=c("brain","heart","kidney","brain","heart","kidney","brain","heart","kidney","brain","heart","kidney","brain","heart"),study=c("EoGE","EoGE","EoGE","Atlas","Atlas","Atlas","BodyMap","BodyMap","BodyMap","HPA","HPA","HPA","AltIso","AltIso"),prep=c(rep("poly-A",3),rep("rRNA-depl",3),rep("poly-A",8)),layout=c(rep("PE",3),rep("SE",3),rep("PE",6),rep("SE",2)))
head(meta)
dim(meta)
meta
colnames(f)
rownames(meta) <- colnames(f)
head(f)
rownames(meta) <- colnames(f)[3:16]
tissue <- rep(meta$tissue, each=nrow(f))
study <- rep(meta$study, each=nrow(f))
prep <- rep(meta$prep, each=nrow(f))
layout <- rep(meta$layout, each=nrow(f))
fit <- lm(Cuff_FPKM ~ prep + layout + study + tissue, data=data)
data <- data.frame(m, tissue=tissue, study=study, prep=prep, layout=layout)
#subset <- data[sample(1:nrow(data), 1000),]
fit <- lm(Cuff_FPKM ~ prep + layout + study + tissue, data=data)
a <- anova(fit)
str(data)
head(data)
head(m)
m <- melt(f)
colnames(m) <- c("ENSG","Gene","sample_ID","Cuff_FPKM")
meta <- data.frame(tissue=c("brain","heart","kidney","brain","heart","kidney","brain","heart","kidney","brain","heart","kidney","brain","heart"),study=c("EoGE","EoGE","EoGE","Atlas","Atlas","Atlas","BodyMap","BodyMap","BodyMap","HPA","HPA","HPA","AltIso","AltIso"),prep=c(rep("poly-A",3),rep("rRNA-depl",3),rep("poly-A",8)),layout=c(rep("PE",3),rep("SE",3),rep("PE",6),rep("SE",2)))
rownames(meta) <- colnames(f)[3:16]
tissue <- rep(meta$tissue, each=nrow(f))
study <- rep(meta$study, each=nrow(f))
prep <- rep(meta$prep, each=nrow(f))
layout <- rep(meta$layout, each=nrow(f))
data <- data.frame(m, tissue=tissue, study=study, prep=prep, layout=layout)
#subset <- data[sample(1:nrow(data), 1000),]
fit <- lm(Cuff_FPKM ~ prep + layout + study + tissue, data=data)
a <- anova(fit)
maxval = 100
barplot(a$"F value"[-5],names.arg=rownames(a)[-5],main="Anova F score, Cufflinks FPKM",ylim=c(0,maxval))
plot(a)
a
anova
anova()
?nova
?anova
library(reshape)
m <- melt(f)
colnames(m) <- c("ENSG","Gene","sample_ID","Cuff_FPKM")
meta <- data.frame(tissue=c("brain","heart","kidney","brain","heart","kidney","brain","heart","kidney","brain","heart","kidney","brain","heart"),study=c("EoGE","EoGE","EoGE","Atlas","Atlas","Atlas","BodyMap","BodyMap","BodyMap","HPA","HPA","HPA","AltIso","AltIso"),prep=c(rep("poly-A",3),rep("rRNA-depl",3),rep("poly-A",8)),layout=c(rep("PE",3),rep("SE",3),rep("PE",6),rep("SE",2)))
rownames(meta) <- colnames(f)[3:16]
tissue <- rep(meta$tissue, each=nrow(f))
study <- rep(meta$study, each=nrow(f))
prep <- rep(meta$prep, each=nrow(f))
layout <- rep(meta$layout, each=nrow(f))
data <- data.frame(m, tissue=tissue, study=study, prep=prep, layout=layout)
#subset <- data[sample(1:nrow(data), 1000),]
fit <- lm(Cuff_FPKM ~ prep + layout + study + tissue, data=data)
a <- anova(fit)
maxval = 100
barplot(a$"F value"[-5],names.arg=rownames(a)[-5],main="Anova F score, Cufflinks FPKM",ylim=c(0,maxval))
barplot(a$"F value"[-5],names.arg=rownames(a)[-5],main="Anova F score, Cufflinks FPKM",ylim=c(0,maxval))
plotPC(fpkms.log, 1, 2, desc="Reprocessed F/RPKM values, log2 \n SVD \n n=19475", colors=colors)
plotPC(fpkms.log, 2, 3, desc="Reprocessed FPKM values, log2 \n SVD \n n=19475", colors=colors)
meta
m <- melt(fpkms.log[,])
m <- melt(f)
head(f)
head(m)
m <- melt(fpkms.log[,])
head(m)
colnames(m) <- c("sample_ID","log2FPKM")
data <- data.frame(m, tissue=tissue, study=study, prep=prep, layout=layout)
m <- melt(fpkms.log[,])
colnames(m) <- c("sample_ID","log2FPKM")
data <- data.frame(m, tissue=tissue, study=study, prep=prep, layout=layout)
#subset <- data[sample(1:nrow(data), 1000),]
fit <- lm(log2FPKM ~ + prep + layout + study + tissue, data=data)
b <- anova(fit)
m <- melt(fpkms.log[,])
colnames(m) <- c("sample_ID","log2FPKM")
data <- data.frame(m, tissue=tissue, study=study, prep=prep, layout=layout)
data <- data.frame(tissue=c("brain","heart","kidney","brain","heart","kidney","brain","heart","kidney","brain","heart","kidney","brain","heart"),study=c("EoGE","EoGE","EoGE","Atlas","Atlas","Atlas","BodyMap","BodyMap","BodyMap","HPA","HPA","HPA","AltIso","AltIso"),
prep=c(rep("poly-A",3),rep("rRNA-depl",3),rep("poly-A",8)),
layout=c(rep("PE",3),rep("SE",3),rep("PE",6),rep("SE",2)))
fit <- lm(log2FPKM ~ + prep + layout + study + tissue, data=data)
m <- melt(fpkms.log[,])
colnames(m) <- c("sample_ID","log2FPKM")
data <- data.frame(tissue=c("brain","heart","kidney","brain","heart","kidney","brain","heart","kidney","brain","heart","kidney","brain","heart"),
study=c("EoGE","EoGE","EoGE","Atlas","Atlas","Atlas","BodyMap","BodyMap","BodyMap","HPA","HPA","HPA","AltIso","AltIso"),
prep=c(rep("poly-A",3),rep("rRNA-depl",3),rep("poly-A",8)),
layout=c(rep("PE",3),rep("SE",3),rep("PE",6),rep("SE",2)))
fit <- lm(log2FPKM ~ + prep + layout + study + tissue, data=data)
rownames(meta) <- colnames(fpkms.log)
m <- melt(fpkms.log[,])
colnames(m) <- c("sample_ID","log2FPKM")
meta <- data.frame(tissue=c("brain","heart","kidney","brain","heart","kidney","brain","heart","kidney","brain","heart","kidney","brain","heart"),study=c("EoGE","EoGE","EoGE","Atlas","Atlas","Atlas","BodyMap","BodyMap","BodyMap","HPA","HPA","HPA","AltIso","AltIso"),prep=c(rep("poly-A",3),rep("rRNA-depl",3),rep("poly-A",8)),layout=c(rep("PE",3),rep("SE",3),rep("PE",6),rep("SE",2)))
rownames(meta) <- colnames(fpkms.log)
tissue <- rep(meta$tissue, each=nrow(fpkms.log))
study <- rep(meta$study, each=nrow(fpkms.log))
prep <- rep(meta$prep, each=nrow(fpkms.log))
layout <- rep(meta$layout, each=nrow(fpkms.log))
data <- data.frame(m, tissue=tissue, study=study, prep=prep, layout=layout)
#subset <- data[sample(1:nrow(data), 1000),]
fit <- lm(log2FPKM ~ + prep + layout + study + tissue, data=data)
b <- anova(fit)
barplot(b$"F value"[-5],names.arg=rownames(b)[-5],main="Anova F score, log2-RPKM",ylim=c(0,3000))
head(f_pc_nozero)
library(reshape)
m <- melt(f_pc_nozero)
colnames(m) <- c("ENSG","Gene","sample_ID","Cuff_FPKM")
meta <- data.frame(tissue=c("brain","heart","kidney","brain","heart","kidney","brain","heart","kidney","brain","heart","kidney","brain","heart"),study=c("EoGE","EoGE","EoGE","Atlas","Atlas","Atlas","BodyMap","BodyMap","BodyMap","HPA","HPA","HPA","AltIso","AltIso"),prep=c(rep("poly-A",3),rep("rRNA-depl",3),rep("poly-A",8)),layout=c(rep("PE",3),rep("SE",3),rep("PE",6),rep("SE",2)))
rownames(meta) <- colnames(f_pc_nozero)[3:16]
tissue <- rep(meta$tissue, each=nrow(f_pc_nozero))
study <- rep(meta$study, each=nrow(f_pc_nozero))
prep <- rep(meta$prep, each=nrow(f_pc_nozero))
layout <- rep(meta$layout, each=nrow(f_pc_nozero))
data <- data.frame(m, tissue=tissue, study=study, prep=prep, layout=layout)
fit <- lm(Cuff_FPKM ~ prep + layout + study + tissue, data=data)
a <- anova(fit)
maxval = 100
barplot(a$"F value"[-5],names.arg=rownames(a)[-5],main="Anova F score, Cufflinks FPKM",ylim=c(0,maxval))
library(reshape)
m <- melt(f_pc_nozero)
colnames(m) <- c("ENSG","Gene","sample_ID","Cuff_FPKM")
meta <- data.frame(tissue=c("brain","heart","kidney","brain","heart","kidney","brain","heart","kidney","brain","heart","kidney","brain","heart"),study=c("EoGE","EoGE","EoGE","Atlas","Atlas","Atlas","BodyMap","BodyMap","BodyMap","HPA","HPA","HPA","AltIso","AltIso"),prep=c(rep("poly-A",3),rep("rRNA-depl",3),rep("poly-A",8)),layout=c(rep("PE",3),rep("SE",3),rep("PE",6),rep("SE",2)))
rownames(meta) <- colnames(f_pc_nozero)[3:16]
tissue <- rep(meta$tissue, each=nrow(f_pc_nozero))
study <- rep(meta$study, each=nrow(f_pc_nozero))
prep <- rep(meta$prep, each=nrow(f_pc_nozero))
layout <- rep(meta$layout, each=nrow(f_pc_nozero))
data <- data.frame(m, tissue=tissue, study=study, prep=prep, layout=layout)
m <- melt(fpkms.log[,])
colnames(m) <- c("sample_ID","log2FPKM")
data <- data.frame(m, tissue=tissue, study=study, prep=prep, layout=layout)
fit <- lm(log2FPKM ~ + prep + layout + study + tissue, data=data)
b <- anova(fit)
barplot(b$"F value"[-5],names.arg=rownames(b)[-5],main="Anova F score, log2-RPKM",ylim=c(0,3000))
head(combat)
colnames(m) <- c("sample_ID","combat")
data <- data.frame(m, tissue=tissue, study=study, prep=prep, layout=layout)
fit <- lm(combat ~ + prep + layout + study + tissue, data=data)
c <- anova(fit)
barplot(c$"F value"[-5],names.arg=rownames(b)[-5],main="Anova F score, log2-TMM-FPKM",ylim=c(0,5000))
?draw.quintuple.venn
draw.quintuple.venn(100, 100, 100, 100, 100,
length(intersect(EoGE_b,Atlas_b)),
length(intersect(EoGE_b,BodyMap_b)),
length(intersect(EoGE_b,HPA_b)),
length(intersect(EoGE_b,AltIso_b)),
length(intersect(Atlas_b,BodyMap_b)),
length(intersect(Atlas_b,HPA_b)),
length(intersect(Atlas_b,AltIso_b)),
length(intersect(BodyMap_b,HPA_b)),
length(intersect(BodyMap_b,AltIso_b)),
length(intersect(HPA_b,AltIso_b)),
length(intersect(intersect(EoGE_b,Atlas_b),BodyMap_b)),
length(intersect(intersect(EoGE_b,Atlas_b),HPA_b)),
length(intersect(intersect(EoGE_b,Atlas_b),AltIso_b)),
length(intersect(intersect(EoGE_b,BodyMap_b),HPA_b)),
length(intersect(intersect(EoGE_b,BodyMap_b),AltIso_b)),
length(intersect(intersect(EoGE_b,HPA_b),AltIso_b)),
length(intersect(intersect(Atlas_b,BodyMap_b),HPA_b)),
length(intersect(intersect(Atlas_b,BodyMap_b),AltIso_b)),
length(intersect(intersect(Atlas_b,HPA_b),AltIso_b)),
length(intersect(intersect(BodyMap_b,HPA_b),AltIso_b)),
length(intersect(intersect(EoGE_b,Atlas_b),intersect(BodyMap_b,HPA_b))),
length(intersect(intersect(EoGE_b,Atlas_b),intersect(BodyMap_b,AltIso_b))),
length(intersect(intersect(EoGE_b,Atlas_b),intersect(HPA_b,AltIso_b))),
length(intersect(intersect(EoGE_b,BodyMap_b),intersect(HPA_b,AltIso_b))),
length(intersect(intersect(Atlas_b,BodyMap_b),intersect(HPA_b,AltIso_b))),
length(intersect(intersect(intersect(EoGE_b,Atlas_b),intersect(BodyMap_b,HPA_b)),AltIso_b)),
category = c("EoGE","Atlas","BodyMap","HPA","AltIso"), lwd = rep(0, 5), lty = rep("solid", 5),
fill = c("mistyrose","steelblue","lightgoldenrod","darkseagreen","lightblue")
)
library(VennDiagram)
draw.quintuple.venn(100, 100, 100, 100, 100,
length(intersect(EoGE_b,Atlas_b)),
length(intersect(EoGE_b,BodyMap_b)),
length(intersect(EoGE_b,HPA_b)),
length(intersect(EoGE_b,AltIso_b)),
length(intersect(Atlas_b,BodyMap_b)),
length(intersect(Atlas_b,HPA_b)),
length(intersect(Atlas_b,AltIso_b)),
length(intersect(BodyMap_b,HPA_b)),
length(intersect(BodyMap_b,AltIso_b)),
length(intersect(HPA_b,AltIso_b)),
length(intersect(intersect(EoGE_b,Atlas_b),BodyMap_b)),
length(intersect(intersect(EoGE_b,Atlas_b),HPA_b)),
length(intersect(intersect(EoGE_b,Atlas_b),AltIso_b)),
length(intersect(intersect(EoGE_b,BodyMap_b),HPA_b)),
length(intersect(intersect(EoGE_b,BodyMap_b),AltIso_b)),
length(intersect(intersect(EoGE_b,HPA_b),AltIso_b)),
length(intersect(intersect(Atlas_b,BodyMap_b),HPA_b)),
length(intersect(intersect(Atlas_b,BodyMap_b),AltIso_b)),
length(intersect(intersect(Atlas_b,HPA_b),AltIso_b)),
length(intersect(intersect(BodyMap_b,HPA_b),AltIso_b)),
length(intersect(intersect(EoGE_b,Atlas_b),intersect(BodyMap_b,HPA_b))),
length(intersect(intersect(EoGE_b,Atlas_b),intersect(BodyMap_b,AltIso_b))),
length(intersect(intersect(EoGE_b,Atlas_b),intersect(HPA_b,AltIso_b))),
length(intersect(intersect(EoGE_b,BodyMap_b),intersect(HPA_b,AltIso_b))),
length(intersect(intersect(Atlas_b,BodyMap_b),intersect(HPA_b,AltIso_b))),
length(intersect(intersect(intersect(EoGE_b,Atlas_b),intersect(BodyMap_b,HPA_b)),AltIso_b)),
category = c("EoGE","Atlas","BodyMap","HPA","AltIso"), lwd = rep(0, 5), lty = rep("solid", 5),
fill = c("mistyrose","steelblue","lightgoldenrod","darkseagreen","lightblue")
)
EoGE_b <- rownames(f_pc[order(f_pc$EoGE_brain,decreasing=T),][1:100,])
EoGE_h <- rownames(f_pc[order(f_pc$EoGE_heart,decreasing=T),][1:100,])
EoGE_k <- rownames(f_pc[order(f_pc$EoGE_kidney,decreasing=T),][1:100,])
Atlas_b <- rownames(f_pc[order(f_pc$Atlas_brain,decreasing=T),][1:100,])
Atlas_h <- rownames(f_pc[order(f_pc$Atlas_heart,decreasing=T),][1:100,])
Atlas_k <- rownames(f_pc[order(f_pc$Atlas_kidney,decreasing=T),][1:100,])
BodyMap_b <- rownames(f_pc[order(f_pc$BodyMap_brain,decreasing=T),][1:100,])
BodyMap_h <- rownames(f_pc[order(f_pc$BodyMap_heart,decreasing=T),][1:100,])
BodyMap_k <- rownames(f_pc[order(f_pc$BodyMap_kidney,decreasing=T),][1:100,])
HPA_b <- rownames(f_pc[order(f_pc$HPA_brain,decreasing=T),][1:100,])
HPA_h <- rownames(f_pc[order(f_pc$HPA_heart,decreasing=T),][1:100,])
HPA_k <- rownames(f_pc[order(f_pc$HPA_kidney,decreasing=T),][1:100,])
AltIso_b <- rownames(f_pc[order(f_pc$AltIso_brain,decreasing=T),][1:100,])
AltIso_h <- rownames(f_pc[order(f_pc$AltIso_heart,decreasing=T),][1:100,])
draw.quintuple.venn(100, 100, 100, 100, 100,
length(intersect(EoGE_b,Atlas_b)),
length(intersect(EoGE_b,BodyMap_b)),
length(intersect(EoGE_b,HPA_b)),
length(intersect(EoGE_b,AltIso_b)),
length(intersect(Atlas_b,BodyMap_b)),
length(intersect(Atlas_b,HPA_b)),
length(intersect(Atlas_b,AltIso_b)),
length(intersect(BodyMap_b,HPA_b)),
length(intersect(BodyMap_b,AltIso_b)),
length(intersect(HPA_b,AltIso_b)),
length(intersect(intersect(EoGE_b,Atlas_b),BodyMap_b)),
length(intersect(intersect(EoGE_b,Atlas_b),HPA_b)),
length(intersect(intersect(EoGE_b,Atlas_b),AltIso_b)),
length(intersect(intersect(EoGE_b,BodyMap_b),HPA_b)),
length(intersect(intersect(EoGE_b,BodyMap_b),AltIso_b)),
length(intersect(intersect(EoGE_b,HPA_b),AltIso_b)),
length(intersect(intersect(Atlas_b,BodyMap_b),HPA_b)),
length(intersect(intersect(Atlas_b,BodyMap_b),AltIso_b)),
length(intersect(intersect(Atlas_b,HPA_b),AltIso_b)),
length(intersect(intersect(BodyMap_b,HPA_b),AltIso_b)),
length(intersect(intersect(EoGE_b,Atlas_b),intersect(BodyMap_b,HPA_b))),
length(intersect(intersect(EoGE_b,Atlas_b),intersect(BodyMap_b,AltIso_b))),
length(intersect(intersect(EoGE_b,Atlas_b),intersect(HPA_b,AltIso_b))),
length(intersect(intersect(EoGE_b,BodyMap_b),intersect(HPA_b,AltIso_b))),
length(intersect(intersect(Atlas_b,BodyMap_b),intersect(HPA_b,AltIso_b))),
length(intersect(intersect(intersect(EoGE_b,Atlas_b),intersect(BodyMap_b,HPA_b)),AltIso_b)),
category = c("EoGE","Atlas","BodyMap","HPA","AltIso"), lwd = rep(0, 5), lty = rep("solid", 5),
fill = c("mistyrose","steelblue","lightgoldenrod","darkseagreen","lightblue")
)
draw.quad.venn(100, 100, 100, 100,
length(intersect(EoGE_k,Atlas_k)),
length(intersect(EoGE_k,BodyMap_k)),
length(intersect(EoGE_k,HPA_k)),
length(intersect(Atlas_k,BodyMap_k)),
length(intersect(Atlas_k,HPA_k)),
length(intersect(BodyMap_k,HPA_k)),
length(intersect(intersect(EoGE_k,Atlas_k),BodyMap_k)),
length(intersect(intersect(EoGE_k,Atlas_k),HPA_k)),
length(intersect(intersect(EoGE_k,BodyMap_k),HPA_k)),
length(intersect(intersect(Atlas_k,BodyMap_k),HPA_k)),
length(intersect(intersect(EoGE_k,Atlas_k),intersect(BodyMap_k,HPA_k))),
category = c("EoGE","Atlas","BodyMap","HPA"), lwd = rep(0, 4), lty = rep("solid", 4),
fill = c("mistyrose","steelblue","lightgoldenrod","darkseagreen")
)
